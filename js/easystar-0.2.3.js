var EasyStar=EasyStar||{};"function"==typeof define&&define.amd&&define("easystar",[],(function(){return EasyStar})),"undefined"!=typeof module&&module.exports&&(module.exports=EasyStar),EasyStar.Node=function(t,n,e,i,s){this.parent=t,this.x=n,this.y=e,this.costSoFar=i,this.simpleDistanceToTarget=s,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},EasyStar.Node.OPEN_LIST=0,EasyStar.Node.CLOSED_LIST=1,EasyStar.PriorityQueue=function(t,n){this.length=0;var e=[],i=!1;if(n==EasyStar.PriorityQueue.MAX_HEAP)i=!0;else{if(n!=EasyStar.PriorityQueue.MIN_HEAP)throw n+" not supported.";i=!1}this.insert=function(n){if(!n.hasOwnProperty(t))throw"Cannot insert "+n+" because it does not have a property by the name of "+t+".";e.push(n),this.length++,s(this.length-1)},this.getHighestPriorityElement=function(){return e[0]},this.shiftHighestPriorityElement=function(){if(0===this.length)throw"There are no more elements in your priority queue.";if(1===this.length){var t=e[0];return e=[],this.length=0,t}var n=e[0],i=e.pop();return this.length--,e[0]=i,o(0),n};var s=function(t){if(0!==t){var n=u(t);a(t,n)&&(r(t,n),s(n))}},o=function(t){var n=h(t),e=c(t);if(a(n,t))r(t,n),o(n);else if(a(e,t))r(t,e),o(e);else{if(0==t)return;o(0)}},r=function(t,n){var i=e[t];e[t]=e[n],e[n]=i},a=function(n,s){return void 0!==e[s]&&void 0!==e[n]&&("function"==typeof e[n][t]?(o=e[n][t](),r=e[s][t]()):(o=e[n][t],r=e[s][t]),i?o>r:o<r);var o,r},u=function(t){return Math.floor((t-1)/2)},h=function(t){return 2*t+1},c=function(t){return 2*t+2}},EasyStar.PriorityQueue.MAX_HEAP=0,EasyStar.PriorityQueue.MIN_HEAP=1,EasyStar.instance=function(){this.isDoneCalculating=!0,this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},EasyStar.js=function(){var t,n,e,i=1.4,s=!1,o={},r={},a={},u=!0,h=[],c=Number.MAX_VALUE,l=!1;this.setAcceptableTiles=function(t){t instanceof Array?e=t:!isNaN(parseFloat(t))&&isFinite(t)&&(e=[t])},this.enableSync=function(){s=!0},this.disableSync=function(){s=!1},this.enableDiagonals=function(){l=!0},this.disableDiagonals=function(){l=!1},this.setGrid=function(n){t=n;for(var e=0;e<t.length;e++)for(var i=0;i<t[0].length;i++)r[t[e][i]]||(r[t[e][i]]=1)},this.setTileCost=function(t,n){r[t]=n},this.setAdditionalPointCost=function(t,n,e){a[t+"_"+n]=e},this.removeAdditionalPointCost=function(t,n){delete a[t+"_"+n]},this.removeAllAdditionalPointCosts=function(){a={}},this.setIterationsPerCalculation=function(t){c=t},this.avoidAdditionalPoint=function(t,n){o[t+"_"+n]=1},this.stopAvoidingAdditionalPoint=function(t,n){delete o[t+"_"+n]},this.enableCornerCutting=function(){u=!0},this.disableCornerCutting=function(){u=!1},this.stopAvoidingAllAdditionalPoints=function(){o={}},this.findPath=function(n,i,o,r,a){var u=function(t){s?a(t):setTimeout((function(){a(t)}))};if(void 0===e)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===t)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(n<0||i<0||o<0||o<0||n>t[0].length-1||i>t.length-1||o>t[0].length-1||r>t.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(n!==o||i!==r){for(var c=t[r][o],l=!1,f=0;f<e.length;f++)if(c===e[f]){l=!0;break}if(!1!==l){var y=new EasyStar.instance;y.openList=new EasyStar.PriorityQueue("bestGuessDistance",EasyStar.PriorityQueue.MIN_HEAP),y.isDoneCalculating=!1,y.nodeHash={},y.startX=n,y.startY=i,y.endX=o,y.endY=r,y.callback=u,y.openList.insert(v(y,y.startX,y.startY,null,1)),h.push(y)}else u(null)}else u([])},this.calculate=function(){if(0!==h.length&&void 0!==t&&void 0!==e)for(n=0;n<c;n++){if(0===h.length)return;if(s&&(n=0),0!==h[0].openList.length){var o=h[0].openList.shiftHighestPriorityElement(),r=[];o.list=EasyStar.Node.CLOSED_LIST,o.y>0&&r.push({instance:h[0],searchNode:o,x:0,y:-1,cost:1*d(o.x,o.y-1)}),o.x<t[0].length-1&&r.push({instance:h[0],searchNode:o,x:1,y:0,cost:1*d(o.x+1,o.y)}),o.y<t.length-1&&r.push({instance:h[0],searchNode:o,x:0,y:1,cost:1*d(o.x,o.y+1)}),o.x>0&&r.push({instance:h[0],searchNode:o,x:-1,y:0,cost:1*d(o.x-1,o.y)}),l&&(o.x>0&&o.y>0&&(u||y(t,e,o.x,o.y-1)&&y(t,e,o.x-1,o.y))&&r.push({instance:h[0],searchNode:o,x:-1,y:-1,cost:i*d(o.x-1,o.y-1)}),o.x<t[0].length-1&&o.y<t.length-1&&(u||y(t,e,o.x,o.y+1)&&y(t,e,o.x+1,o.y))&&r.push({instance:h[0],searchNode:o,x:1,y:1,cost:i*d(o.x+1,o.y+1)}),o.x<t[0].length-1&&o.y>0&&(u||y(t,e,o.x,o.y-1)&&y(t,e,o.x+1,o.y))&&r.push({instance:h[0],searchNode:o,x:1,y:-1,cost:i*d(o.x+1,o.y-1)}),o.x>0&&o.y<t.length-1&&(u||y(t,e,o.x,o.y+1)&&y(t,e,o.x-1,o.y))&&r.push({instance:h[0],searchNode:o,x:-1,y:1,cost:i*d(o.x-1,o.y+1)})),r.sort((function(t,n){var e=t.cost+p(o.x+t.x,o.y+t.y,h[0].endX,h[0].endY),i=n.cost+p(o.x+n.x,o.y+n.y,h[0].endX,h[0].endY);return e<i?-1:e===i?0:1}));for(var a=!1,v=0;v<r.length;v++)if(f(r[v].instance,r[v].searchNode,r[v].x,r[v].y,r[v].cost),!0===r[v].instance.isDoneCalculating){a=!0;break}a&&h.shift()}else{h[0].callback(null),h.shift()}}};var f=function(n,i,s,r,a){var u=i.x+s,h=i.y+r;if(void 0===o[u+"_"+h]){if(n.endX===u&&n.endY===h){n.isDoneCalculating=!0;var c=[],l=0;c[l]={x:u,y:h},c[++l]={x:i.x,y:i.y},l++;for(var f=i.parent;null!=f;)c[l]={x:f.x,y:f.y},l++,f=f.parent;c.reverse();var d=c;return void n.callback(d)}if(y(t,e,u,h)){var p=v(n,u,h,i,a);void 0===p.list?(p.list=EasyStar.Node.OPEN_LIST,n.openList.insert(p)):p.list===EasyStar.Node.OPEN_LIST&&i.costSoFar+a<p.costSoFar&&(p.costSoFar=i.costSoFar+a,p.parent=i)}}},y=function(t,n,e,i){for(var s=0;s<n.length;s++)if(t[i][e]===n[s])return!0;return!1},d=function(n,e){return a[n+"_"+e]||r[t[e][n]]},v=function(t,n,e,i,s){if(void 0!==t.nodeHash[n+"_"+e])return t.nodeHash[n+"_"+e];var o=p(n,e,t.endX,t.endY);if(null!==i)var r=i.costSoFar+s;else r=o;var a=new EasyStar.Node(i,n,e,r,o);return t.nodeHash[n+"_"+e]=a,a},p=function(t,n,e,i){return Math.sqrt((e-=t)*e+(i-=n)*i)}};