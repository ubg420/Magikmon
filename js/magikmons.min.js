var MagikMons,__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var e in a)a.hasOwnProperty(e)&&(t[e]=a[e])};return function(a,e){function s(){this.constructor=a}t(a,e),a.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}();!function(t){var a=function(a){function e(){var e=a.call(this,t.GameConstants.GAME_WIDTH,t.GameConstants.GAME_HEIGHT,Phaser.AUTO,"content",null,!1,!0)||this;return e.state.add("PreLoader",t.PreLoader,!1),e.state.add("SplashState",t.SplashState,!1),e.state.add("MapState",t.MapState,!1),e.state.add("FightState",t.FightState,!1),e.state.add("AttacksState",t.AttacksState,!1),e.state.add("Boot",t.Boot,!0),e}return __extends(e,a),e}(Phaser.Game);t.Game=a}(MagikMons||(MagikMons={})),window.onload=function(){if(MagikMons.GameConstants.SPONSOR!==MagikMons.GameConstants.GAMEPIX&&"undefined"==typeof GamePix)new MagikMons.Game},function(t){var a=function(){function a(){}return a.init=function(e){a.game=e,t.GameVars.gameData.muted?a.game.sound.mute=!0:a.game.sound.mute=!1,t.GameConstants.SOUND||a.mute(),a.loopPlayingKey=null,a.audioSprite=a.game.add.audioSprite("audio-sprite")},a.mute=function(){t.GameVars.gameData.muted=!0,a.game.sound.mute=!0},a.unmute=function(){t.GameVars.gameData.muted=!1,a.game.sound.mute=!1},a.playSound=function(t,e,s,n){if(e=e||!1){if(a.loopPlayingKey&&a.loopPlayingKey!==t){a.stopSound(a.loopPlayingKey,!0,!0);var i=a.audioSprite.play(t,s);i.onDecoded.add((function(){n&&i.fadeIn(1e3)}),this)}else if(!a.loopPlayingKey){var o=a.audioSprite.play(t,s);o.onDecoded.add((function(){n&&o.fadeIn(1e3)}),this)}a.loopPlayingKey=t}else{var r=a.audioSprite.play(t,s);r.allowMultiple=!0,r.onDecoded.add((function(){n&&r.fadeIn(1e3)}),this)}},a.stopSound=function(t,e,s){if(null!=t){if(s)a.audioSprite.get(t).fadeOut(1e3);else a.audioSprite.stop(t);e&&(a.loopPlayingKey=null)}},a.onAudioStateRetrieved=function(t){a.isMuted=""!==t&&!0===JSON.parse(t),a.game.sound.mute=a.isMuted},a}();t.AudioManager=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return __extends(e,a),e.prototype.init=function(){e.currentInstance=this,this.input.maxPointers=1,this.game.stage.disableVisibilityChange=!1,this.game.stage.backgroundColor="#000000",this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.device.desktop?(t.GameVars.scaleY=1,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0):(this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,t.GameVars.scaleY=4/3/(window.innerHeight/window.innerWidth),t.GameVars.scaleY>1&&(t.GameVars.scaleY=1),this.game.scale.pageAlignHorizontally=!0,this.game.scale.isPortrait=!1,this.game.scale.forceOrientation(!0,!1)),t.GameConstants.FPS&&(this.game.time.advancedTiming=!0)},e.prototype.preload=function(){this.load.path=t.GameConstants.ASSETS_PATH,this.load.image("bus","/bus.png"),this.load.text("area1","/maps/area1.txt"),this.load.text("area2","/maps/area2.txt"),this.load.text("area3","/maps/area3.txt"),this.load.text("area4","/maps/area4.txt"),this.load.text("area5","/maps/area5.txt"),this.load.text("area6","/maps/area6.txt"),this.load.text("area7","/maps/area7.txt"),this.load.text("area8","/maps/area8.txt"),this.load.text("tileset","/maps/tileset.txt")},e.prototype.create=function(){t.GameVars.jsonsMaps=new Array;for(var a=this.game.cache.getText("tileset"),s=JSON.parse(this.decode(a)),n=1;n<=8;n++){var i=this.game.cache.getText("area"+n),o=JSON.parse(this.decode(i));o.tilesets=s.tilesets,t.GameVars.jsonsMaps.push(o)}t.GameManager.init(e.currentInstance.game)},e.prototype.decode=function(t){for(var a=0;a<t.length;a++)if("*"===t.charAt(a)){var e=0;"*"===t.charAt(a+3)?e=1:"*"===t.charAt(a+4)?e=2:"*"===t.charAt(a+5)?e=3:"*"===t.charAt(a+6)?e=4:"*"===t.charAt(a+7)&&(e=5);for(var s="",n=parseInt(t.substring(a+2,a+2+e)),i=0;i<n;i++)s+="A";t=t.substring(0,a)+s+t.substring(a+3+e)}return t},e.prototype.createNormal=function(){var a=new XMLHttpRequest;a.open("GET","assets/maps/maps.zip",!0),a.responseType="blob",a.onload=function(){var s=new FileReader;s.readAsArrayBuffer(a.response),s.onload=function(a){var s=new JSZip;s.loadAsync(a).then((function(a){console.log("DONE!"),s.file("area1.json").async("string").then((function(a){t.GameVars.jsonsMaps.push(JSON.parse(a)),s.file("area2.json").async("string").then((function(a){t.GameVars.jsonsMaps.push(JSON.parse(a)),s.file("area3.json").async("string").then((function(a){t.GameVars.jsonsMaps.push(JSON.parse(a)),s.file("area4.json").async("string").then((function(a){t.GameVars.jsonsMaps.push(JSON.parse(a)),s.file("area5.json").async("string").then((function(a){t.GameVars.jsonsMaps.push(JSON.parse(a)),s.file("area6.json").async("string").then((function(a){t.GameVars.jsonsMaps.push(JSON.parse(a)),s.file("area7.json").async("string").then((function(a){t.GameVars.jsonsMaps.push(JSON.parse(a)),s.file("area8.json").async("string").then((function(a){t.GameVars.jsonsMaps.push(JSON.parse(a)),t.GameManager.init(e.currentInstance.game)}))}))}))}))}))}))}))}))}),(function(t){console.log(t)}))}},a.send()},e.prototype.shutdown=function(){e.currentInstance=null,a.prototype.shutdown.call(this)},e.prototype.mute=function(){this.game.sound.mute=!0},e.prototype.unmute=function(){t.GameVars.gameData.muted||(this.game.sound.mute=!1)},e}(Phaser.State);t.Boot=a}(MagikMons||(MagikMons={})),function(t){var a=function(){function t(){}return t.VERSION="0.0",t.ASSETS_PATH="assets",t.DEVELOPMENT=!1,t.FPS=!1,t.SHOW_COLLISIONS=!1,t.REPELENTE=!1,t.COLLISIONS=!0,t.ANIMATIONS=!0,t.VERBOSE=!1,t.SOUND=!0,t.NONE="sponsor",t.GAMEPIX="gamepix",t.POKI="poki",t.SPONSOR=t.POKI,t.GAME_WIDTH=480,t.GAME_HEIGHT=640,t.START_STATE="SplashState",t.BITMAP_SIZE=64,t.TILES_SIZE=32,t.TILES_SIZE_HALF=t.TILES_SIZE/2,t.PLAYER="player",t.ADVERSARY="adversary",t.ELEMENT_CLASSIC="classic",t.ELEMENT_TECH="tech",t.ELEMENT_SPECTRE="spectre",t.ELEMENT_COMMON="common",t.SPECIAL_NONE="none",t.SPECIAL_ATTACK="attack",t.SPECIAL_DEFENSE="defense",t.SPECIAL_HACK="hack",t.SPECIAL_POISON="poison",t.SPECIAL_AIM="aim",t.SPECIAL_RAGE="rage",t.INITIAL_BUS=1,t.TUTORIAL_ESCAPE=2,t.TUTORIAL_WAND=3,t.TUTORIAL_ATTACK=4,t.TUTORIAL_HEAL=5,t.TUTORIAL_CRAFT=6,t.TUTORIAL_CAPTURE=7,t.TUTORIAL_SWAP=8,t.TUTORIAL_SWAP_2=9,t.TUTORIAL_NO_CAPTURE=10,t.TUTORIAL_MAP=11,t.TUTORIAL_FINISHED=12,t.START_MKM_CLASSIC="002",t.START_MKM_TECH="007",t.START_MKM_SPECTRE="011",t.X_IN_PLAYER=-130,t.X_OUT_PLAYER=-430,t.X_IN_ADVERSARY=110,t.X_OUT_ADVERSARY=410,t.Y_PLAYER=220,t.Y_ADVERSARY=0,t.CHANGE_TIME=500,t.ACTIONS_NUMBER=16,t.FIGHT_ACTIONS=4,t.MAX_ATTACK=100,t.MAX_DEFENSE=100,t.MAX_AIM=100,t.INCREMENT_STATS=8,t.CRITICAL_MULTIPLIER=1.5,t.STRONG_MULTIPLIER=1.5,t.WEAK_MULTIPLIER=.5,t.RAGE_MULTIPLIER=3,t.XP=100,t.ITEM_PRICES=[100,200,200,200,150,150,150],t.TRAINER_FIGHT="trainer fight",t.MONSTER_FIGHT="magikmon fight",t.ATTACK_NORMAL="normal",t.ATTACK_WEAK="weak",t.ATTACK_STRONG="strong",t.LEVEL_ATTACK_1=3,t.LEVEL_ATTACK_2=7,t.LEVEL_ATTACK_3=12,t.MAX_LEVEL=20,t.NO_CHANGE="no change",t.PLAYER_CHANGE="player change",t.ADVERSARY_CHANGE="adversary change",t.MINIMUM_STEPS=10,t.BITMAPDATA_SIZE=64,t.RED_SQUARE="red square",t.WHITE_SQUARE="white square",t.BLACK_SQUARE="black square",t.BLUE_SQUARE="blue square",t.DARK_BLUE_SQUARE="dark blue square",t.GREEN_SQUARE="green square",t.ORANGE_SQUARE="orange square",t.GRAY_SQUARE="gray square",t.LILAC_SQUARE="lilac square",t.GRADIENT_TEAM_1="gradient team 1",t.GRADIENT_TEAM_2="gradient team 2",t.GRADIENT_TEAM_3="gradient team 3",t.GRADIENT_ITEMS_1="gradient items 1",t.GRADIENT_ITEMS_2="gradient items 2",t.GRADIENT_CLASSIC="classic",t.GRADIENT_SPECTRE="spectre",t.GRADIENT_TECH="tech",t.GRADIENT_TECH_1="gradient fight 1",t.GRADIENT_TECH_2="gradient fight 2",t.GRADIENT_TECH_3="gradient fight 3",t.GRADIENT_SPECTRE_1="gradient spectre 1",t.GRADIENT_SPECTRE_2="gradient spectre 2",t.GRADIENT_SPECTRE_3="gradient spectre 3",t.GRADIENT_CLASSIC_1="gradient classic 1",t.GRADIENT_CLASSIC_2="gradient classic 2",t.GRADIENT_CLASSIC_3="gradient classic 3",t.GRADIENT_NEUTRAL_1="gradient neutral 1",t.GRADIENT_NEUTRAL_2="gradient neutral 2",t.GRADIENT_NEUTRAL_3="gradient neutral 3",t.GRADIENT_BLACK="gradient black",t.ENGLISH="en",t.SPANISH="es",t.CATALAN="cat",t.AUDIO_STATE_KEY="lights-on-audio",t.SAVED_GAME_DATA_KEY="mm-game-data-key",t}();t.GameConstants=a}(MagikMons||(MagikMons={})),function(t){var a=function(){function a(){}return a.init=function(e){"undefined"!=typeof GamePix?(GamePix.pause=function(){a.game.paused=!0},GamePix.resume=function(){a.game.paused=!1},GamePix.soundOn=function(){a.game.sound.mute=!0},GamePix.soundOff=function(){t.GameVars.gameData.muted||(a.game.sound.mute=!1)},GamePix.CONT&&GamePix.ping(GamePix.CONT.START_PLAY)):t.GameConstants.SPONSOR===t.GameConstants.POKI?(a.checkPoki(),a.correctUrl(e)):t.GameConstants.SPONSOR===t.GameConstants.GAMEPIX?a.correctUrl(e):console.log("WRONG URL")},a.checkPoki=function(){var t=["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=","","charCodeAt","charAt","_keyStr","length","replace","indexOf","fromCharCode","n","aHR0cDovL2xvY2FsaG9zdC8=","aHR0cHM6Ly9xYS1maWxlcy5wb2tpLmNvbQ==","aHR0cHM6Ly81ZGQzMDA5MS0wMTVmLTExZWEtYWQ1Ni05Y2I2ZDBkOTk1ZjcucG9raS1nZG4uY29t","aHR0cDovL2xvY2FsaG9zdDo=","decode","href","location","substr","aHR0cDovL3BvLmtpL3NpdGVsb2NrcmVkaXJlY3Q=","top"];!function(){for(var a={_keyStr:t[0],encode:function(e){var s,n,i,o,r,m,h,l=t[1],c=0;for(e=a._utf8_encode(e);c<e[t[5]];)o=(s=e[t[2]](c++))>>2,r=(3&s)<<4|(n=e[t[2]](c++))>>4,m=(15&n)<<2|(i=e[t[2]](c++))>>6,h=63&i,isNaN(n)?m=h=64:isNaN(i)&&(h=64),l=l+this[t[4]][t[3]](o)+this[t[4]][t[3]](r)+this[t[4]][t[3]](m)+this[t[4]][t[3]](h);return l},decode:function(e){var s,n,i,o,r,m,h=t[1],l=0;for(e=e[t[6]](/[^A-Za-z0-9+/=]/g,t[1]);l<e[t[5]];)s=this[t[4]][t[7]](e[t[3]](l++))<<2|(o=this[t[4]][t[7]](e[t[3]](l++)))>>4,n=(15&o)<<4|(r=this[t[4]][t[7]](e[t[3]](l++)))>>2,i=(3&r)<<6|(m=this[t[4]][t[7]](e[t[3]](l++))),h+=String[t[8]](s),64!=r&&(h+=String[t[8]](n)),64!=m&&(h+=String[t[8]](i));return h=a._utf8_decode(h)},_utf8_encode:function(a){a=a[t[6]](/rn/g,t[9]);for(var e=t[1],s=0;s<a[t[5]];s++){var n=a[t[2]](s);n<128?e+=String[t[8]](n):n>127&&n<2048?(e+=String[t[8]](n>>6|192),e+=String[t[8]](63&n|128)):(e+=String[t[8]](n>>12|224),e+=String[t[8]](n>>6&63|128),e+=String[t[8]](63&n|128))}return e},_utf8_decode:function(a){for(var e=t[1],s=0,n=c1=c2=0;s<a[t[5]];)(n=a[t[2]](s))<128?(e+=String[t[8]](n),s++):n>191&&n<224?(c2=a[t[2]](s+1),e+=String[t[8]]((31&n)<<6|63&c2),s+=2):(c2=a[t[2]](s+1),c3=a[t[2]](s+2),e+=String[t[8]]((15&n)<<12|(63&c2)<<6|63&c3),s+=3);return e}},e=[t[10],t[11],t[12],t[13]],s=!1,n=0;n<e[t[5]];n++){var i=a[t[14]](e[n]),o=window[t[16]][t[15]];if(o[t[5]]>i[t[5]]&&(o=o[t[17]](0,i[t[5]])),i===o){s=!0;break}}if(s){var r=t[18],m=a[t[14]](r);window[t[16]][t[15]]=m,this[t[19]][t[16]]!==this[t[16]]&&(this[t[19]][t[16]]=this[t[16]])}}()},a.correctUrl=function(e){a.game=e,a.resetVars(),a.readGameData(),t.GameVars.slotData=t.GameVars.gameData.slotsData[t.GameVars.gameData.currentSlot]},a.resetMapVars=function(){t.GameVars.needWalk=null,t.GameVars.needChangeMkm=null,t.GameVars.currentTrainer=null,t.GameVars.needRemoveTrainer=null,t.GameVars.needDialogueTrainer=null,t.GameVars.currentSpawn=null,t.GameVars.typeFight=null,t.GameVars.monsterNumber=null,t.GameVars.specialAttack=null,t.GameVars.playerMonstersFighting=null,t.GameVars.adversaryMonstersFighting=null,t.GameVars.xpDistribution=null,t.GameVars.xpEarned=null,t.GameVars.needChangeMonster=null,t.GameVars.countWins=0},a.defaultCursor=function(){"default"!==a.game.canvas.style.cursor&&(a.game.canvas.style.cursor="default")},a.readGameData=function(){a.getGameStorageData(t.GameConstants.SAVED_GAME_DATA_KEY,(function(e){e&&(t.GameVars.gameData=JSON.parse(e)),a.startGame()}),(function(t){a.log("error retriving saved game data.",t)}))},a.writeGameData=function(){t.GameVars.gameData.slotsData[t.GameVars.gameData.currentSlot]=t.GameVars.slotData,a.setGameStorageData(t.GameConstants.SAVED_GAME_DATA_KEY,t.GameVars.gameData,(function(){a.log("game data successfully saved")}),(function(t){a.log("error saving game data",t)}))},a.onGameAssetsLoaded=function(){t.AudioManager.init(this.game),a.setTexts(),t.GameVars.monstersStats=this.game.cache.getJSON("levels"),t.GameVars.monstersInfo=this.game.cache.getJSON("names"),t.GameVars.monstersActions=this.game.cache.getJSON("actions"),a.parseMonstersActions(),t.GameVars.animations=this.game.cache.getJSON("animations"),t.GameVars.slotData.monsters||a.createDefaultPlayerMonsters(),a.game.state.start(t.GameConstants.START_STATE,!0,!1)},a.setTexts=function(){t.GameVars.gameText=this.game.cache.getJSON("game-text")[t.GameVars.gameData.language],t.GameVars.dialoguesText=t.GameVars.gameText.DIALOGUES,t.GameVars.names=t.GameVars.gameText.NAMES,t.GameVars.itemsTexts=t.GameVars.gameText.ITEMS_TEXTS,t.GameVars.bestiaryTexts=t.GameVars.gameText.BESTIARY,t.GameVars.tutorialTexts=t.GameVars.gameText.TUTORIAL,t.GameVars.trainersTexts=t.GameVars.gameText.TRAINERS_TEXT,t.GameVars.trainersNames=t.GameVars.gameText.TRAINERS_NAMES,t.GameVars.chaptersTexts=t.GameVars.gameText.CHAPTER_NAMES},a.parseMonstersActions=function(){for(var e=1;e<=t.GameConstants.ACTIONS_NUMBER;e++){var s=("000"+e).substr(-3),n=t.GameVars.monstersActions[s];n.fx=a.parseAction(n.fx),n.frames=a.parseAction(n.frames),n.delay=a.parseAction(n.delay),n.front=a.parseAction(n.front),n.adversary=a.parseAction(n.adversary),n.movement_player=a.parseAction(n.movement_player),n.movement_adversary=a.parseAction(n.movement_adversary)}},a.parseAction=function(t){return t&&(t=JSON.parse(""+t)),t},a.updateMonsters=function(){for(var e=0;e<t.GameVars.playerMonstersFighting.length;e++)for(var s=t.GameVars.playerMonstersFighting[e],n=0;n<t.GameVars.slotData.monsters.length;n++){var i=t.GameVars.slotData.monsters[n];if(i.healTime=Math.round(Date.now()/1e3),i&&s.uniqueId===i.uniqueId){i.life=s.life,i.xp=s.xp,i.level!==s.level&&(i.level=s.level,a.updateMonsterLevelUp(i,!0));break}}},a.setInitialHealTime=function(t){0===t.healTime&&(t.healTime=Math.round(Date.now()/1e3)),a.setHealTime(t)},a.setHealTime=function(e){t.GameVars.slotData.state<=t.GameConstants.TUTORIAL_HEAL||(e.life<e.maxLife&&(e.life+=(Math.round(Date.now()/1e3)-e.healTime)/2,e.life>e.maxLife&&(e.life=e.maxLife)),e.healTime=Math.round(Date.now()/1e3),a.writeGameData())},a.fightToMap=function(e){e?(t.GameVars.currentSpawn&&(t.GameVars.currentSpawn.solvable&&t.MapManager.deleteSpawn(t.GameVars.currentSpawn),t.GameVars.currentSpawn=null),t.GameVars.currentTrainer&&(t.GameVars.needRemoveTrainer=t.GameVars.currentTrainer),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_SWAP&&a.endSwapTutorial()):t.GameVars.currentTrainer&&(t.GameVars.needDialogueTrainer=t.GameVars.currentTrainer),t.GameVars.currentTrainer&&(t.GameVars.currentTrainer.first_time=!1),t.GameVars.currentTrainer=null,t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ESCAPE&&(t.MapManager.deleteSpawn(t.GameVars.currentSpawn),t.GameVars.slotData.state=t.GameConstants.TUTORIAL_WAND),a.updateMonsters(),a.goMapState(t.GameVars.slotData.mapName)},a.goMapState=function(e){t.GameVars.slotData.mapName=e,a.game.camera.onFadeComplete.removeAll(),a.game.camera.onFadeComplete.add((function(){t.GameVars.paused=!1,a.game.state.start("MapState",!0,!1)}),this),a.game.camera.fade(0,500,!1)},a.backHome=function(){t.GameConstants.SPONSOR,t.GameConstants.POKI,t.GameConstants.SPONSOR===t.GameConstants.POKI?(PokiSDK.gameplayStop(),PokiSDK.commercialBreak().then((function(){t.GameVars.paused=!1,a.game.state.start("SplashState",!0,!1)}))):(t.GameVars.paused=!1,a.game.state.start("SplashState",!0,!1))},a.goAttacksState=function(){a.game.state.start("AttacksState",!0,!1)},a.saveHeroPosition=function(e){var s=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPosition,n=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPrevPosition;s.x===n.x&&s.y===n.y||(t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPrevPosition.x=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPosition.x,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPrevPosition.y=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPosition.y),t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPosition=e,a.writeGameData()},a.createAdversayMonster=function(e,s,n){t.GameVars.adversaryMonstersFighting=new Array;for(var i=0;i<e.length;i++){var o=t.Utils.randomIntFromInterval(n[i],s[i]),r=e[i];t.GameVars.slotData.state===t.GameConstants.TUTORIAL_CAPTURE?t.GameVars.slotData.monsters[0].class===t.GameConstants.ELEMENT_CLASSIC?r=t.GameConstants.START_MKM_SPECTRE:t.GameVars.slotData.monsters[0].class===t.GameConstants.ELEMENT_TECH?r=t.GameConstants.START_MKM_CLASSIC:t.GameVars.slotData.monsters[0].class===t.GameConstants.ELEMENT_SPECTRE&&(r=t.GameConstants.START_MKM_TECH):t.GameVars.slotData.state===t.GameConstants.TUTORIAL_SWAP&&(t.GameVars.slotData.monsters[0].class===t.GameConstants.ELEMENT_CLASSIC?r=t.GameConstants.START_MKM_TECH:t.GameVars.slotData.monsters[0].class===t.GameConstants.ELEMENT_TECH?r=t.GameConstants.START_MKM_SPECTRE:t.GameVars.slotData.monsters[0].class===t.GameConstants.ELEMENT_SPECTRE&&(r=t.GameConstants.START_MKM_CLASSIC)),t.GameVars.adversaryMonstersFighting.push(a.createMonsterFromId(r,o,t.GameVars.slotData.uniqueId)),t.GameVars.slotData.uniqueId++}},a.manageNewMagikmons=function(e){a.updateMonsters(),e.sort(t.Utils.compareMkms);var s=new Array,n=e.length;n>6&&(n=6);for(var i=0;i<n;i++){var o=e[i].monsterData,r=!0;if(o){for(var m=0;m<t.GameVars.slotData.monsters.length;m++){var h=t.GameVars.slotData.monsters[m];if(h&&o.uniqueId===h.uniqueId){var l=h;s.push(l),r=!1}}if(r)(l=o).hypno=!1,l.poison=!1,l.rage=!1,a.updateMonsterLevelUp(l,!1),s.push(l)}else s.push(null)}t.GameVars.slotData.monsters=s,t.GameVars.slotData.state===t.GameConstants.TUTORIAL_CAPTURE&&a.endCaptureTutorial(),t.GameConstants.SPONSOR===t.GameConstants.POKI?PokiSDK.commercialBreak().then((function(){a.goMapState(t.GameVars.slotData.mapName)})):a.goMapState(t.GameVars.slotData.mapName)},a.createMonsterFromId=function(e,s,n,i){t.GameVars.slotData.bestiary[parseInt(e)-1]=!0;var o=a.generateActions(t.GameVars.monstersInfo[e].class,i);return{id:e,uniqueId:n,class:t.GameVars.monstersInfo[e].class,name:t.GameVars.monstersInfo[e].name,level:s,xp:0,attack:a.formulaStats(t.GameVars.monstersStats[e].attack,s),defense:a.formulaStats(t.GameVars.monstersStats[e].defense,s),aiming:t.GameVars.monstersStats[e].aiming,life:a.formulaLife(t.GameVars.monstersStats[e].hp,s),maxLife:a.formulaLife(t.GameVars.monstersStats[e].hp,s),hypno:!1,poison:!1,rage:!1,actions:o,healTime:0}},a.updateMonsterLevelUp=function(e,s){var n=e.id,i=e.level;e.attack=a.formulaStats(t.GameVars.monstersStats[n].attack,i),e.defense=a.formulaStats(t.GameVars.monstersStats[n].defense,i),e.aiming=t.GameVars.monstersStats[n].aiming,s&&(e.life=a.formulaLife(t.GameVars.monstersStats[n].hp,i),e.maxLife=a.formulaLife(t.GameVars.monstersStats[n].hp,i))},a.formulaLife=function(t,a){return Math.floor(t*a/10)+a+10},a.formulaStats=function(t,a){return Math.floor(t*a/10)+5},a.generateActions=function(a,e){for(var s=new Array,n=new Array,i=new Array,o=new Array,r=new Array,m=1;m<=t.GameConstants.ACTIONS_NUMBER;m++){var h=("000"+m).substr(-3),l=t.GameVars.monstersActions[h];l.class===t.GameConstants.ELEMENT_COMMON&&(1===l.rank||2===l.rank?(0!==l.damage&&1===l.cooldown&&t.GameVars.slotData.state!==t.GameConstants.TUTORIAL_CAPTURE&&t.GameVars.slotData.state!==t.GameConstants.TUTORIAL_SWAP&&n.push(h),i.push(h)):(3===l.rank||4===l.rank)&&(o.push(h),r.push(h))),l.class===a&&(1===l.rank||2===l.rank?(0!==l.damage&&1===l.cooldown&&n.push(h,h,h),i.push(h,h,h)):(3===l.rank||4===l.rank)&&(o.push(h,h,h),r.push(h,h,h)))}var c=n[Math.floor(Math.random()*n.length)];t.GameVars.slotData.state===t.GameConstants.TUTORIAL_WAND?c="001":t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ATTACK&&(c="002");var d={id:c,cooldown:0};s.push(d);for(var p=i.indexOf(c);p>-1;)i.splice(p,1),p=i.indexOf(c);var u=i[Math.floor(Math.random()*i.length)],g={id:u,cooldown:0};for(s.push(g),p=o.indexOf(u);p>-1;)o.splice(p,1),p=o.indexOf(u);var G=o[Math.floor(Math.random()*o.length)],f={id:G,cooldown:0};for(s.push(f),p=r.indexOf(G);p>-1;)r.splice(p,1),p=r.indexOf(G);var C={id:r[Math.floor(Math.random()*r.length)],cooldown:0};return s.push(C),"FightState"===t.GameConstants.START_STATE&&(s=new Array,e?(s.push({id:"004",cooldown:0}),s.push({id:"008",cooldown:0}),s.push({id:"012",cooldown:0}),s.push({id:"016",cooldown:0})):(s.push({id:"001",cooldown:0}),s.push({id:"010",cooldown:0}),s.push({id:"011",cooldown:0}),s.push({id:"012",cooldown:0}))),s},a.generatePlayerMonsters=function(t){t.push(a.createMonsterFromId("003",20,1,!0)),t.push(a.createMonsterFromId("001",20,2,!0)),t.push(a.createMonsterFromId("002",20,4,!0)),t.push(null),t.push(null),t.push(null)},a.generateAdversaryMonsters=function(t){t.push(a.createMonsterFromId("008",1,0)),t.push(a.createMonsterFromId("004",1,0)),t.push(a.createMonsterFromId("003",1,0))},a.endWandTutorial=function(){t.Hero.canMove=!0,t.GameVars.slotData.state=t.GameConstants.TUTORIAL_ATTACK,a.writeGameData()},a.endAttackTutorial=function(){t.GameVars.slotData.state=t.GameConstants.TUTORIAL_CRAFT,a.writeGameData()},a.endHealTutorial=function(){t.GameVars.slotData.state=t.GameConstants.TUTORIAL_CRAFT,a.writeGameData(),t.MapState.currentInstance.startCraftTutorial()},a.endCraftTutorial=function(){t.GameVars.slotData.state=t.GameConstants.TUTORIAL_CAPTURE,a.writeGameData()},a.endCaptureTutorial=function(){t.GameVars.slotData.state=t.GameConstants.TUTORIAL_SWAP_2,a.writeGameData()},a.endSwapTutorial=function(){t.GameVars.slotData.state=t.GameConstants.TUTORIAL_SWAP_2,a.writeGameData()},a.endSwap2Tutorial=function(){t.GameVars.slotData.state=t.GameConstants.TUTORIAL_NO_CAPTURE,a.writeGameData()},a.endNoCaptureTutorial=function(){t.GameVars.slotData.state=t.GameConstants.TUTORIAL_MAP,a.writeGameData()},a.endMapTutorial=function(){t.GameVars.slotData.state=t.GameConstants.TUTORIAL_FINISHED,a.writeGameData()},a.reorderMonsters=function(a){var e=new Array;a.sort(t.Utils.compareMkms);for(var s=0;s<a.length;s++)e.push(a[s].monsterData);t.GameVars.slotData.monsters=e},a.setLanguage=function(e){t.GameVars.gameData.language=e,a.setTexts(),a.writeGameData()},a.log=function(a,e){t.GameConstants.VERBOSE&&(e?console.error(a+":",e):console.log(a))},a.slotSelected=function(e){t.GameVars.gameData.currentSlot=e,t.GameVars.gameData.slotsData[e]||(t.GameVars.gameData.slotsData[e]=a.createSlot()),t.GameVars.slotData=t.GameVars.gameData.slotsData[e],t.GameVars.slotData.monsters||a.createDefaultPlayerMonsters(),a.writeGameData(),t.SplashState.currentInstance.hide(e)},a.eraseSlot=function(e){t.GameVars.gameData.slotsData[e]=a.createSlot(),t.GameVars.gameData.currentSlot===e&&(t.GameVars.slotData=t.GameVars.gameData.slotsData[e]),a.writeGameData(),this.game.state.start("SplashState",!0,!1)},a.startGame=function(){t.GameConstants.SPONSOR===t.GameConstants.POKI&&(PokiSDK.init().then((function(){console.log("PokiSDK initialized")})).catch((function(){console.log("Adblock enabled")})),PokiSDK.setDebug(!1)),a.game.state.start("PreLoader",!0,!1)},a.createSlot=function(){var a=((s={}).map1={tilemapName:"map1",imageName:"tileset_32",dimensions:{x:63,y:107},heroPosition:{x:70,y:81.5},heroPrevPosition:{x:70,y:81.5},minimapPosition:{x:8,y:448},spawns:null,dialogues:null,trainers:null,exits:null,paths:null},s.map2={tilemapName:"map2",imageName:"tileset_32",dimensions:{x:70,y:68},heroPosition:{x:1,y:64},heroPrevPosition:{x:1,y:64},minimapPosition:{x:147,y:320},spawns:null,dialogues:null,trainers:null,exits:null,paths:null},s.map3={tilemapName:"map3",imageName:"tileset_32",dimensions:{x:91,y:61},heroPosition:{x:74,y:61},heroPrevPosition:{x:74,y:61},minimapPosition:{x:17,y:188},spawns:null,dialogues:null,trainers:null,exits:null,paths:null},s.map4={tilemapName:"map4",imageName:"tileset_32",dimensions:{x:78,y:69},heroPosition:{x:13,y:69},heroPrevPosition:{x:13,y:69},minimapPosition:{x:0,y:42},spawns:null,dialogues:null,trainers:null,exits:null,paths:null},s.map5={tilemapName:"map5",imageName:"tileset_32",dimensions:{x:132,y:88},heroPosition:{x:12,y:18},heroPrevPosition:{x:12,y:18},minimapPosition:{x:0,y:0},spawns:null,dialogues:null,trainers:null,exits:null,paths:null},s.map6={tilemapName:"map6",imageName:"tileset_32",dimensions:{x:87,y:105},heroPosition:{x:25,y:36},heroPrevPosition:{x:25,y:36},minimapPosition:{x:242,y:85},spawns:null,dialogues:null,trainers:null,exits:null,paths:null},s.map7={tilemapName:"map7",imageName:"tileset_32",dimensions:{x:59,y:147},heroPosition:{x:27,y:4},heroPrevPosition:{x:27,y:4},minimapPosition:{x:319,y:320},spawns:null,dialogues:null,trainers:null,exits:null,paths:null},s.map8={tilemapName:"map8",imageName:"tileset_32",dimensions:{x:78,y:79},heroPosition:{x:76,y:62},heroPrevPosition:{x:76,y:62},minimapPosition:{x:147,y:463},spawns:null,dialogues:null,trainers:null,exits:null,paths:null},s),e={healing:0,antidote:0,hypnoCure:0,defenseIncrease:0,attackIncrease:0,aimingIncrease:0,ball:0};"FightState"===t.GameConstants.START_STATE&&(e.healing=10,e.antidote=20,e.hypnoCure=30,e.defenseIncrease=40,e.attackIncrease=50,e.aimingIncrease=60,e.ball=1);var s,n={state:t.GameConstants.INITIAL_BUS,mapName:"map1",mapsData:a,monsters:null,bestiary:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],items:e,wisp:74,uniqueId:0,needMaxMkmTutorial:!0,winLastTrainer:!1};return"FightState"!==t.GameConstants.START_STATE&&"MapState"!==t.GameConstants.START_STATE||(n.state=t.GameConstants.TUTORIAL_FINISHED,n.needMaxMkmTutorial=!1,n.mapName="map2"),n},a.resetVars=function(){var e=t.GameConstants.ENGLISH;"es-ES"===navigator.language||"es"===navigator.language?e=t.GameConstants.SPANISH:"ca"===navigator.language&&(e=t.GameConstants.CATALAN),t.GameVars.gameData={muted:!1,language:e,currentSlot:0,slotsData:[a.createSlot(),a.createSlot(),a.createSlot()]},t.GameVars.typeFight=t.GameConstants.MONSTER_FIGHT,t.GameVars.currentTrainer=null,t.GameVars.needRemoveTrainer=null,t.GameVars.paused=!1,t.GameVars.needChangeMkm=!1,t.GameVars.countWins=0},a.getGameStorageData=function(t,a,e){a(localStorage.getItem(t))},a.setGameStorageData=function(t,a,e,s){localStorage.setItem(t,JSON.stringify(a)),e()},a.createDefaultPlayerMonsters=function(){var e=new Array;"FightState"===t.GameConstants.START_STATE?a.generatePlayerMonsters(e):(e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null)),t.GameVars.slotData.uniqueId=2,t.GameVars.slotData.monsters=e},a}();t.GameManager=a}(MagikMons||(MagikMons={})),function(t){var a=function(){function t(){}return t.getLocalStorageData=function(t){var a=localStorage.getItem(t);return null!==a?a:""},t.setLocalStorageData=function(t,a){localStorage.setItem(t,a)},t}();t.GameVars=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return __extends(e,a),e.prototype.init=function(){e.currentInstance=this,this.load.path=t.GameConstants.ASSETS_PATH,this.allLoaded=!1,this.animFinished=!1},e.prototype.preload=function(){t.GameConstants.SPONSOR===t.GameConstants.POKI&&PokiSDK.gameLoadingStart(),this.generateBitmapData(),this.composeScene(),this.loadAssets()},e.prototype.create=function(){t.GameConstants.SPONSOR===t.GameConstants.POKI&&PokiSDK.gameLoadingFinished(),this.game.time.events.add(500,(function(){this.animFinished?this.startGame():this.allLoaded=!0}),this)},e.prototype.updateLoadedPercentage=function(a,e){if("texture_atlas_3"===e){var s=this.add.image(-100,-100,"texture_atlas_3","smoke_generic_01.png");s.anchor.set(.5);var n=s.animations.add("explosion",Phaser.Animation.generateFrameNames("smoke_generic_",1,21,".png",2));s.play("explosion"),n.onComplete.add((function(){this.allLoaded?this.startGame():this.animFinished=!0}),this)}this.preloadBar.scale.x=this.load.progress/100*3.925,this.bus.x=t.GameConstants.GAME_WIDTH/2-126+this.load.progress/100*3.925*t.GameConstants.BITMAP_SIZE,t.GameConstants.SPONSOR===t.GameConstants.GAMEPIX?GamePix.loading(this.load.progress):t.GameConstants.SPONSOR===t.GameConstants.POKI&&PokiSDK.gameLoadingProgress({percentageDone:this.load.progress})},e.prototype.startGame=function(){t.GameConstants.SPONSOR===t.GameConstants.GAMEPIX?GamePix.loaded().then((function(){t.GameManager.onGameAssetsLoaded()})).catch((function(a){t.GameManager.log("error initialising game",a)})):t.GameManager.onGameAssetsLoaded()},e.prototype.composeScene=function(){this.add.text(0,0,"ABCDE",{font:"60px Adineue",fill:"#FFFFFF"}),this.add.text(0,0,"ABCDE",{font:"60px Goonies",fill:"#FFFFFF"}),this.add.text(0,0,"ABCDE",{font:"60px Pythia",fill:"#FFFFFF"}),this.add.text(0,0,"ABCDE",{font:"60px Exo Light",fill:"#FFFFFF"}),this.add.text(0,0,"ABCDE",{font:"60px Chewy",fill:"#FFFFFF"}),this.add.text(0,0,"ABCDE",{font:"60px DosisBold",fill:"#FFFFFF"}),this.add.sprite(0,0,this.game.cache.getBitmapData(t.GameConstants.DARK_BLUE_SQUARE)).scale.set(t.GameConstants.GAME_WIDTH/t.GameConstants.BITMAPDATA_SIZE,t.GameConstants.GAME_HEIGHT/t.GameConstants.BITMAPDATA_SIZE),this.add.sprite(0,0,this.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_1)).scale.set(t.GameConstants.GAME_WIDTH/16,2.5),this.add.sprite(0,320,this.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_2)).scale.set(t.GameConstants.GAME_WIDTH/16,2.5),this.loadingItemsContainer=this.add.group(),this.loadingItemsContainer.y=t.GameConstants.GAME_HEIGHT/2,this.loadingItemsContainer.scale.y=t.GameVars.scaleY;var a=new Phaser.Sprite(this.game,t.GameConstants.GAME_WIDTH/2+2,2,this.game.cache.getBitmapData(t.GameConstants.BLACK_SQUARE));a.scale.set(4,.25),a.anchor.set(.5),a.alpha=.45,this.loadingItemsContainer.add(a);var e=new Phaser.Sprite(this.game,t.GameConstants.GAME_WIDTH/2,0,this.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));e.scale.setTo(4,.25),e.anchor.set(.5),this.loadingItemsContainer.add(e),this.preloadBar=new Phaser.Sprite(this.game,t.GameConstants.GAME_WIDTH/2-126,0,this.game.cache.getBitmapData(t.GameConstants.RED_SQUARE)),this.preloadBar.scale.setTo(0,.2),this.preloadBar.anchor.set(0,.5),this.loadingItemsContainer.add(this.preloadBar),this.bus=new Phaser.Image(this.game,t.GameConstants.GAME_WIDTH/2-126,-60,"bus"),this.bus.scale.set(-.75,.75),this.bus.anchor.set(.5),this.loadingItemsContainer.add(this.bus)},e.prototype.loadAssets=function(){this.load.tilemap("map1",null,t.GameVars.jsonsMaps[0],Phaser.Tilemap.TILED_JSON),this.load.tilemap("map2",null,t.GameVars.jsonsMaps[1],Phaser.Tilemap.TILED_JSON),this.load.tilemap("map3",null,t.GameVars.jsonsMaps[2],Phaser.Tilemap.TILED_JSON),this.load.tilemap("map4",null,t.GameVars.jsonsMaps[3],Phaser.Tilemap.TILED_JSON),this.load.tilemap("map5",null,t.GameVars.jsonsMaps[4],Phaser.Tilemap.TILED_JSON),this.load.tilemap("map6",null,t.GameVars.jsonsMaps[5],Phaser.Tilemap.TILED_JSON),this.load.tilemap("map7",null,t.GameVars.jsonsMaps[6],Phaser.Tilemap.TILED_JSON),this.load.tilemap("map8",null,t.GameVars.jsonsMaps[7],Phaser.Tilemap.TILED_JSON),this.load.image("tileset_32","/images/tileset_32.png"),this.load.spritesheet("tiles","/images/tileset_32.png",t.GameConstants.TILES_SIZE,t.GameConstants.TILES_SIZE),this.load.atlas("texture_atlas_1","/texture_atlas_1.png","/texture_atlas_1.json"),this.load.atlas("texture_atlas_2","/texture_atlas_2.png","/texture_atlas_2.json"),this.load.atlas("texture_atlas_3","/texture_atlas_3.png","/texture_atlas_3.json"),this.load.atlas("texture_atlas_4","/texture_atlas_4.png","/texture_atlas_4.json"),this.load.atlas("texture_atlas_es","/texture_atlas_es.png","/texture_atlas_es.json"),this.load.atlas("texture_atlas_en","/texture_atlas_en.png","/texture_atlas_en.json"),this.load.atlas("texture_atlas_cat","/texture_atlas_cat.png","/texture_atlas_cat.json"),this.load.json("game-text","/text/game-text.json"),this.load.json("animations","/animations.json"),this.load.json("levels","/monsters/levels.json"),this.load.json("names","/monsters/names.json"),this.load.json("actions","/monsters/actions.json"),this.load.xml("capture","/capture.xml"),this.load.audiosprite("audio-sprite",["/audio/audiosprite.mp3","/audio/audiosprite.ogg"],"/audio/audiosprite.json"),this.game.load.start(),this.load.onFileComplete.add(this.updateLoadedPercentage,this)},e.prototype.generateBitmapData=function(){var a=this.game.add.bitmapData(64,64,t.GameConstants.RED_SQUARE,!0);a.ctx.beginPath(),a.ctx.rect(0,0,64,64),a.ctx.fillStyle="#FF0000",a.ctx.fill(),(a=this.game.add.bitmapData(64,64,t.GameConstants.GREEN_SQUARE,!0)).ctx.beginPath(),a.ctx.rect(0,0,64,64),a.ctx.fillStyle="#00FF00",a.ctx.fill(),(a=this.game.add.bitmapData(64,64,t.GameConstants.BLUE_SQUARE,!0)).ctx.beginPath(),a.ctx.rect(0,0,64,64),a.ctx.fillStyle="#0000FF",a.ctx.fill(),(a=this.game.add.bitmapData(64,64,t.GameConstants.DARK_BLUE_SQUARE,!0)).ctx.beginPath(),a.ctx.rect(0,0,64,64),a.ctx.fillStyle="#191970",a.ctx.fill(),(a=this.game.add.bitmapData(64,64,t.GameConstants.WHITE_SQUARE,!0)).ctx.beginPath(),a.ctx.rect(0,0,64,64),a.ctx.fillStyle="#FFFFFF",a.ctx.fill(),(a=this.game.add.bitmapData(64,64,t.GameConstants.BLACK_SQUARE,!0)).ctx.beginPath(),a.ctx.rect(0,0,64,64),a.ctx.fillStyle="#000000",a.ctx.fill(),(a=this.game.add.bitmapData(64,64,t.GameConstants.DARK_BLUE_SQUARE,!0)).ctx.beginPath(),a.ctx.rect(0,0,64,64),a.ctx.fillStyle="#171641",a.ctx.fill(),(a=this.game.add.bitmapData(64,64,t.GameConstants.GRAY_SQUARE,!0)).ctx.beginPath(),a.ctx.rect(0,0,64,64),a.ctx.fillStyle="#999999",a.ctx.fill(),(a=this.game.add.bitmapData(64,64,t.GameConstants.ORANGE_SQUARE,!0)).ctx.beginPath(),a.ctx.rect(0,0,64,64),a.ctx.fillStyle="#FF9900",a.ctx.fill(),(a=this.game.add.bitmapData(64,64,t.GameConstants.LILAC_SQUARE,!0)).ctx.beginPath(),a.ctx.rect(0,0,64,64),a.ctx.fillStyle="#b942f4",a.ctx.fill();var e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_TEAM_1,!0)).ctx.createLinearGradient(0,0,0,128);e.addColorStop(0,"#0f1e25"),e.addColorStop(1,"#005c63"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_TEAM_2,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#005c63"),e.addColorStop(1,"#348449"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_TEAM_3,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#348449"),e.addColorStop(1,"#a7da57"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_ITEMS_1,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#0D1C29"),e.addColorStop(1,"#004E8D"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_ITEMS_2,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#004E8D"),e.addColorStop(1,"#0085BF"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_CLASSIC,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#0D2029"),e.addColorStop(1,"#9F4532"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_SPECTRE,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#0D2029"),e.addColorStop(1,"#5E5CC3"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_TECH,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#0D2029"),e.addColorStop(1,"#006A71"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_BLACK,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#00212F"),e.addColorStop(1,"#003745"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_CLASSIC_1,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#111D33"),e.addColorStop(1,"#763213"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_CLASSIC_2,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#763213"),e.addColorStop(1,"#FF872C"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_CLASSIC_3,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#FF872C"),e.addColorStop(1,"#FFE09A"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_TECH_1,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#111D33"),e.addColorStop(1,"#1A606F"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_TECH_2,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#1A606F"),e.addColorStop(1,"#87FFBF"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_TECH_3,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#87FFBF"),e.addColorStop(1,"#F2FFFB"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_SPECTRE_1,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#111D33"),e.addColorStop(1,"#812A9E"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_SPECTRE_2,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#812A9E"),e.addColorStop(1,"#ED5CB6"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_SPECTRE_3,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#ED5CB6"),e.addColorStop(1,"#FFACC7"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_NEUTRAL_1,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#111D33"),e.addColorStop(1,"#3C7CB3"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_NEUTRAL_2,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#3C7CB3"),e.addColorStop(1,"#3AE7FF"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128),(e=(a=this.game.add.bitmapData(16,128,t.GameConstants.GRADIENT_NEUTRAL_3,!0)).ctx.createLinearGradient(0,0,0,128)).addColorStop(0,"#3AE7FF"),e.addColorStop(1,"#E5FFFD"),a.ctx.fillStyle=e,a.ctx.fillRect(0,0,16,128)},e}(Phaser.State);t.PreLoader=a}(MagikMons||(MagikMons={})),function(t){var a=function(){function t(){}return t.inside=function(t,a,e,s){for(var n=t.x,i=t.y,o=!1,r=0,m=a.length-1;r<a.length;m=r++){var h=a[r][0]+e,l=a[r][1]+s,c=a[m][0]+e,d=a[m][1]+s;l>i!=d>i&&n<(c-h)*(i-l)/(d-l)+h&&(o=!o)}return o},t.randomIntFromInterval=function(t,a){return Math.floor(Math.random()*(a-t+1)+t)},t.levelToXp=function(t){return Math.round(100*Math.pow(1.75,t))},t.intersectRect=function(t,a,e,s,n){return!(t-n>e+n||t+n<e-n||a-n>s+n||a+n<s-n)},t.compareMkms=function(t,a){return t.pos<a.pos?-1:t.pos>a.pos?1:0},t.validNumber=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.consecutiveArray=function(t,a){for(var e=new Array,s=t;s<t+a;s++)e.push(s);return e},t.shakeArray=function(t,a){for(var e=[],s=a;s<=t;)e.push(s,-s),s+=a;for(;t>0;)e.push(t,-t),t-=a;return e.push(0),e},t}();t.Utils=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"attacks-gui")||this;s.scale.y=t.GameVars.scaleY,s.x=5,s.y=t.GameConstants.GAME_HEIGHT-110,s.movementButtons=new Array;for(var n=1;n<=16;n++){var i=("000"+n).substr(-3),o=new Phaser.Button(s.game,(n-1)%8*60,60*Math.floor((n-1)/8)-10,"texture_atlas_1",s.onClickButton,s);o.setFrames("btn_attack_"+i+".png","btn_attack_"+i+".png","btn_attack_"+i+".png"),o.forceOut=!0,o.name=i,s.add(o)}return s}return __extends(e,a),e.prototype.onClickButton=function(a){t.AttacksState.currentInstance.animateAttack(a.name)},e}(Phaser.Group);t.AttacksGUI=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return __extends(e,a),e.prototype.init=function(){e.currentInstance=this,t.FightManager.init(this.game)},e.prototype.create=function(){this.game.stage.backgroundColor=0;var a=new t.BackgroundFight(this.game);this.add.existing(a),this.backgroundAttack=new t.BackgroundAttack(this.game),this.backgroundAttack.visible=!1,this.add.existing(this.backgroundAttack);var e=new Phaser.Button(this.game,10,10,"texture_atlas_1",this.onClickBack,this);e.setFrames("btn_back.png","btn_back.png","btn_back.png"),e.scale.y=t.GameVars.scaleY,this.add.existing(e);var s=this.add.group();s.x=t.GameConstants.GAME_WIDTH/2,s.y=t.GameConstants.GAME_HEIGHT/2-50,s.scale.y=t.GameVars.scaleY,this.monstersContainer=new t.MonstersContainer(this.game),s.add(this.monstersContainer),this.attackGUI=new t.AttacksGUI(this.game),this.add.existing(this.attackGUI)},e.prototype.shutdown=function(){t.FightState.currentInstance=null,a.prototype.shutdown.call(this)},e.prototype.render=function(){t.GameConstants.DEVELOPMENT&&this.game.debug.text(this.game.time.fps.toString(),t.GameConstants.GAME_WIDTH-30,30,"#ffffff","20px Arial")},e.prototype.setBackgroundAttack=function(t){"004"!==t&&"008"!==t&&"012"!==t&&"016"!==t||this.backgroundAttack.setBackground(t),this.game.time.events.add(1500,(function(){"004"!==t&&"008"!==t&&"012"!==t&&"016"!==t||this.backgroundAttack.hide()}),this)},e.prototype.animateAttack=function(a){this.setBackgroundAttack(a);var e=t.GameVars.monstersActions[a];this.monstersContainer.animationsContainer1.newAction(e),this.monstersContainer.animationsContainer2.newAction(e);var s=this.monstersContainer.adversary,n=this.monstersContainer.player;e.movement_player&&this.playAnimationAttack(n,1,e.movement_player),e.movement_adversary&&this.playAnimationDefense(s,1,e.movement_adversary)},e.prototype.playAnimationAttack=function(a,e,s){var n=Math.round(60*s[1]);if(1===s[0])this.game.add.tween(a.monsterImage).to({x:-20*e,y:20*e},50,Phaser.Easing.Cubic.Out,!0,n).onComplete.add((function(){this.game.add.tween(a.monsterImage).to({x:50*e,y:-50*e},50,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){this.game.add.tween(a.monsterImage).to({x:0,y:0},400,Phaser.Easing.Quintic.Out,!0)}),this)}),this);else if(2===s[0]){var i=t.Utils.shakeArray(30,3);this.game.add.tween(a.monsterImage).to({x:i},500,Phaser.Easing.Cubic.Out,!0,n)}},e.prototype.playAnimationDefense=function(a,e,s){var n=Math.round(60*s[1]);if(1===s[0])this.game.add.tween(a.monsterImage).to({x:20*e,y:-20*e},50,Phaser.Easing.Cubic.Out,!0,n).onComplete.add((function(){this.game.add.tween(a.monsterImage).to({x:0,y:0},400,Phaser.Easing.Quintic.Out,!0)}),this),this.game.add.tween(a.monsterImage.scale).to({x:.95,y:.95},50,Phaser.Easing.Cubic.Out,!0,n).onComplete.add((function(){this.game.add.tween(a.monsterImage.scale).to({x:1,y:1},400,Phaser.Easing.Quintic.Out,!0)}),this);else if(2===s[0]){var i=t.Utils.shakeArray(30,3);this.game.add.tween(a.monsterImage).to({x:i},500,Phaser.Easing.Cubic.Out,!0,n)}else 3===s[0]&&(this.game.add.tween(a.monsterImage).to({x:20*e,y:-20*e},50,Phaser.Easing.Cubic.Out,!0,n).onComplete.add((function(){this.game.add.tween(a.monsterImage).to({x:0,y:0},500,Phaser.Easing.Quintic.Out,!0).onComplete.add((function(){var e=t.Utils.shakeArray(30,3);this.game.add.tween(a.monsterImage).to({x:e},400,Phaser.Easing.Cubic.Out,!0)}),this)}),this),this.game.add.tween(a.monsterImage.scale).to({x:.95,y:.95},50,Phaser.Easing.Cubic.Out,!0,n).onComplete.add((function(){this.game.add.tween(a.monsterImage.scale).to({x:1,y:1},500,Phaser.Easing.Quintic.Out,!0)}),this))},e.prototype.onClickBack=function(){t.GameManager.goMapState(t.GameVars.slotData.mapName)},e}(Phaser.State);t.AttacksState=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"background-fight")||this,n=new Phaser.Group(s.game);return n.y=t.GameConstants.GAME_HEIGHT,n.angle=37,s.add(n),s.kinetics1=new Phaser.Image(s.game,0,0,"texture_atlas_1","kinetics.png"),s.kinetics1.anchor.set(.5,1),s.kinetics1.scale.set(4),n.add(s.kinetics1),s.kinetics2=new Phaser.Image(s.game,0,-s.kinetics1.height,"texture_atlas_1","kinetics.png"),s.kinetics2.anchor.set(.5,1),s.kinetics2.scale.set(4),n.add(s.kinetics2),s}return __extends(e,a),e.prototype.setBackground=function(a){var e,s,n,i;t.AudioManager.playSound("fx_attack_tocho"),this.visible=!0,"004"===a?(e=t.GameConstants.GRADIENT_NEUTRAL_1,s=t.GameConstants.GRADIENT_NEUTRAL_2,n=t.GameConstants.GRADIENT_NEUTRAL_3,i=3793659):"008"===a?(e=t.GameConstants.GRADIENT_CLASSIC_1,s=t.GameConstants.GRADIENT_CLASSIC_2,n=t.GameConstants.GRADIENT_CLASSIC_3,i=16749113):"012"===a?(e=t.GameConstants.GRADIENT_TECH_1,s=t.GameConstants.GRADIENT_TECH_2,n=t.GameConstants.GRADIENT_TECH_3,i=8253880):"016"===a&&(e=t.GameConstants.GRADIENT_SPECTRE_1,s=t.GameConstants.GRADIENT_SPECTRE_2,n=t.GameConstants.GRADIENT_SPECTRE_3,i=16731036),this.kinetics1.tint=i,this.kinetics2.tint=i,this.container&&this.container.destroy(),this.container=new Phaser.Group(this.game),this.add(this.container),this.sendToBack(this.container);var o=this.create(0,-50,this.game.cache.getBitmapData(e));o.scale.set(6.25,25.1/128),this.container.add(o);var r=this.create(0,-25,this.game.cache.getBitmapData(s));r.scale.set(6.25,20.1/128),this.container.add(r);var m=this.create(0,-5,this.game.cache.getBitmapData(n));m.scale.set(6.25,5.1/128),this.container.add(m);var h=this.create(0,0,this.game.cache.getBitmapData(n));h.scale.set(6.25,-5.1/128),h.anchor.y=1,this.container.add(h);var l=this.create(0,5,this.game.cache.getBitmapData(s));l.scale.set(6.25,-20.1/128),l.anchor.y=1,this.container.add(l);var c=this.create(0,25,this.game.cache.getBitmapData(e));c.scale.set(6.25,-25.1/128),c.anchor.y=1,this.container.add(c),this.container.y=t.GameConstants.GAME_HEIGHT,this.container.scale.set(8),this.container.angle=-53,this.container.scale.y=0,this.kinetics1.alpha=0,this.kinetics2.alpha=0,this.game.add.tween(this.container.scale).to({y:8},500,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.kinetics1).to({alpha:1},500,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.kinetics2).to({alpha:1},500,Phaser.Easing.Cubic.Out,!0)},e.prototype.hide=function(){this.game.add.tween(this.container.scale).to({y:0},250,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.kinetics1).to({alpha:0},250,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.kinetics2).to({alpha:0},250,Phaser.Easing.Cubic.In,!0).onComplete.add((function(){this.visible=!1}),this)},e.prototype.update=function(){this.kinetics1.y+=e.VELOCITY,this.kinetics2.y+=e.VELOCITY,this.kinetics1.y>this.kinetics1.height?this.kinetics1.y-=2*this.kinetics1.height:this.kinetics2.y>this.kinetics2.height&&(this.kinetics2.y-=2*this.kinetics2.height)},e.VELOCITY=10,e}(Phaser.Group);t.BackgroundAttack=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"background-fight")||this,n=s.create(0,0,s.game.cache.getBitmapData(t.GameConstants.GRADIENT_BLACK));n.scale.set(t.GameConstants.GAME_WIDTH/16,t.GameConstants.GAME_HEIGHT/2/128),s.add(n);var i=s.create(0,t.GameConstants.GAME_HEIGHT,s.game.cache.getBitmapData(t.GameConstants.GRADIENT_BLACK));i.scale.set(t.GameConstants.GAME_WIDTH/16,-t.GameConstants.GAME_HEIGHT/2/128),s.add(i);var o=new Phaser.Image(s.game,0,t.GameConstants.GAME_HEIGHT/2,"texture_atlas_2","combat_grid.png");return o.anchor.y=.5,s.add(o),s.constellations2=new Phaser.Image(s.game,0,200,"texture_atlas_1","constellations.png"),s.constellations2.scale.y=t.GameVars.scaleY,s.constellations2.anchor.y=1,s.add(s.constellations2),s.constellations1=new Phaser.Image(s.game,-s.constellations2.width,200,"texture_atlas_1","constellations.png"),s.constellations1.scale.y=t.GameVars.scaleY,s.constellations1.anchor.y=1,s.add(s.constellations1),s}return __extends(e,a),e.prototype.update=function(){this.constellations1.x+=.15,this.constellations2.x+=.15,this.constellations1.x>=this.constellations1.width?this.constellations1.x=-this.constellations1.width:this.constellations2.x>=this.constellations2.width&&(this.constellations2.x=-this.constellations2.width)},e}(Phaser.Group);t.BackgroundFight=a}(MagikMons||(MagikMons={})),function(t){var a=function(){function a(){}return a.init=function(e){a.game=e,t.GameVars.turn=t.GameConstants.PLAYER,t.GameVars.needChangeMonster=t.GameConstants.NO_CHANGE,t.GameVars.monsterNumber=0,t.GameVars.playerMonstersFighting=new Array,a.getMonstersForFight(),t.GameVars.adversaryMonstersFighting||(t.GameVars.adversaryMonstersFighting=new Array,t.GameManager.generateAdversaryMonsters(t.GameVars.adversaryMonstersFighting)),t.GameVars.xpDistribution=new Array;for(var s=0;s<t.GameVars.adversaryMonstersFighting.length;s++){var n={xp:Math.ceil(t.Utils.levelToXp(t.GameVars.adversaryMonstersFighting[s].level)/t.GameVars.adversaryMonstersFighting[s].level)+5,monsters:[]};t.GameVars.xpDistribution.push(n)}},a.getMonstersForFight=function(){for(var e=0;e<t.GameVars.slotData.monsters.length&&!(e>=3);e++){var s=t.GameVars.slotData.monsters[e];s&&t.GameVars.playerMonstersFighting.push(a.copyMonster(s))}if(t.GameVars.slotData.state!==t.GameConstants.TUTORIAL_ESCAPE&&0===t.GameVars.playerMonstersFighting[0].life)if(t.GameVars.playerMonstersFighting[1].life>0){var n=t.GameVars.playerMonstersFighting[0];t.GameVars.playerMonstersFighting[0]=t.GameVars.playerMonstersFighting[1],t.GameVars.playerMonstersFighting[1]=n}else if(t.GameVars.playerMonstersFighting[2].life>0){n=t.GameVars.playerMonstersFighting[0];t.GameVars.playerMonstersFighting[0]=t.GameVars.playerMonstersFighting[2],t.GameVars.playerMonstersFighting[2]=n}},a.copyMonster=function(t){return JSON.parse(JSON.stringify(t))},a.changePlayerMonster=function(e){var s=t.GameVars.playerMonstersFighting[0];t.GameVars.playerMonstersFighting[0]=t.GameVars.playerMonstersFighting[e],t.GameVars.playerMonstersFighting[e]=s,t.GameVars.needChangeMonster!==t.GameConstants.NO_CHANGE&&(t.GameVars.needChangeMonster=t.GameConstants.NO_CHANGE,a.changeTurn(!0)),t.FightState.currentInstance.changePlayerMonster()},a.changeAdversaryMonster=function(){a.updateXpDistribution(),t.GameVars.monsterNumber++;var e=t.GameVars.adversaryMonstersFighting.shift();t.GameVars.adversaryMonstersFighting.push(e),0===t.GameVars.adversaryMonstersFighting[0].life?(a.retireAdversaryMonster(),a.endFight(!0)):(t.GameVars.needChangeMonster=t.GameConstants.NO_CHANGE,t.GameVars.turn=t.GameConstants.ADVERSARY,a.changeTurn(),t.FightState.currentInstance.changeAdversaryMonster())},a.retireAdversaryMonster=function(){t.FightState.currentInstance.retireAdversaryMonster()},a.changeTurn=function(e){if(t.GameVars.needChangeMonster===t.GameConstants.PLAYER_CHANGE)a.changePlayerDeadMonster();else if(t.GameVars.needChangeMonster===t.GameConstants.ADVERSARY_CHANGE)a.changeAdversaryMonster();else{t.GameVars.turn=t.GameVars.turn===t.GameConstants.PLAYER?t.GameConstants.ADVERSARY:t.GameConstants.PLAYER,t.GameVars.turn===t.GameConstants.PLAYER?a.updateCooldowns():a.updateXpDistribution();var s=void 0;e||(s=a.updatePoison()),s===t.GameConstants.PLAYER?this.game.time.events.add(3*t.GameConstants.CHANGE_TIME,(function(){t.GameVars.needChangeMonster=t.GameConstants.PLAYER_CHANGE,a.changePlayerDeadMonster()}),this):s===t.GameConstants.ADVERSARY?this.game.time.events.add(3*t.GameConstants.CHANGE_TIME,(function(){t.GameVars.needChangeMonster=t.GameConstants.ADVERSARY_CHANGE,a.changeAdversaryMonster()}),this):t.FightState.currentInstance.turnChanged()}},a.catchMonster=function(){t.GameVars.extraCapture=0,a.disableGUI(),t.FightState.currentInstance.animationCatch()},a.catchVideoMonster=function(){t.GameVars.extraCapture=.2,a.disableGUI(),t.GameConstants.SPONSOR===t.GameConstants.GAMEPIX&&"undefined"!=typeof GamePix?GamePix.hook({type:"show_video_reward"}).then((function(a){t.FightState.currentInstance.animationCatch()})).catch((function(t){console.log(t)})):t.GameConstants.SPONSOR===t.GameConstants.POKI?PokiSDK.rewardedBreak().then((function(a){console.log("Should the user get a reward? ${withReward}"),t.FightState.currentInstance.animationCatch()})):t.FightState.currentInstance.animationCatch()},a.decisionCatch=function(){var e=t.GameVars.adversaryMonstersFighting[0].life/t.GameVars.adversaryMonstersFighting[0].maxLife;e-=t.GameVars.extraCapture;var s=Math.random();return t.GameVars.slotData.state===t.GameConstants.TUTORIAL_CAPTURE&&(e=0),t.FightState.currentInstance.showCatchAnimation(),this.game.time.events.add(300,(function(){e<s?a.successfulCatch():a.errorCatch()}),this),e<s},a.successfulCatch=function(){t.FightState.currentInstance.successfulCatch()},a.changeSignClass=function(a){t.FightState.currentInstance.changeSignClass(a)},a.errorCatch=function(){t.FightState.currentInstance.animationReturnToFight()},a.updateXpDistribution=function(){var a=t.GameVars.playerMonstersFighting[0];-1===t.GameVars.xpDistribution[t.GameVars.monsterNumber].monsters.indexOf(a.id)&&a.level!==t.GameConstants.MAX_LEVEL&&t.GameVars.xpDistribution[t.GameVars.monsterNumber].monsters.push(a.id)},a.updatePoison=function(){if(t.GameVars.playerMonstersFighting[0].poison&&t.GameVars.turn===t.GameConstants.PLAYER){if((a=t.GameVars.playerMonstersFighting[0]).life-=.1*a.maxLife,a.life<0)return a.life=0,t.FightState.currentInstance.updateLife(t.GameConstants.PLAYER,!0),t.GameConstants.PLAYER;t.FightState.currentInstance.updateLife(t.GameConstants.PLAYER,!0)}else if(t.GameVars.adversaryMonstersFighting[0].poison&&t.GameVars.turn===t.GameConstants.ADVERSARY){var a;if((a=t.GameVars.adversaryMonstersFighting[0]).life-=.1*a.maxLife,a.life<0)return a.life=0,t.FightState.currentInstance.updateLife(t.GameConstants.ADVERSARY,!0),t.GameConstants.ADVERSARY;t.FightState.currentInstance.updateLife(t.GameConstants.ADVERSARY,!0)}return null},a.updateCooldowns=function(){for(var a=0;a<t.GameVars.playerMonstersFighting.length;a++)for(var e=t.GameVars.playerMonstersFighting[a],s=0;s<e.actions.length;s++){(n=e.actions[s]).cooldown>0&&n.cooldown--}for(a=0;a<t.GameVars.adversaryMonstersFighting.length;a++)for(e=t.GameVars.adversaryMonstersFighting[a],s=0;s<e.actions.length;s++){var n;(n=e.actions[s]).cooldown>0&&n.cooldown--}},a.changePlayerDeadMonster=function(){for(var a=!0,e=0;e<t.GameVars.playerMonstersFighting.length;e++)if(0!==t.GameVars.playerMonstersFighting[e].life){a=!1;break}t.FightState.currentInstance.deadPlayerMonster(a)},a.playerAttack=function(e){a.disableGUI();var s=a.manageAttack(!0,e,t.GameVars.playerMonstersFighting[0],t.GameVars.adversaryMonstersFighting[0]);t.FightState.currentInstance.playerAttack(s)},a.adversaryAttack=function(){var e=t.GameVars.adversaryMonstersFighting[0],s=1;e.level>=t.GameConstants.LEVEL_ATTACK_3?s=4:e.level>=t.GameConstants.LEVEL_ATTACK_2?s=3:e.level>=t.GameConstants.LEVEL_ATTACK_1&&(s=2);for(var n=new Array,i=0;i<s;i++)0===e.actions[i].cooldown&&n.push(i);var o=n[Math.floor(Math.random()*n.length)],r=t.GameVars.adversaryMonstersFighting[0].actions[o].id;t.GameVars.adversaryMonstersFighting[0].actions[o].cooldown=t.GameVars.monstersActions[r].cooldown;var m=a.manageAttack(!1,r,t.GameVars.adversaryMonstersFighting[0],t.GameVars.playerMonstersFighting[0]);t.FightState.currentInstance.adversaryAttack(m)},a.manageAttack=function(e,s,n,i){t.GameVars.specialAttack=!1;var o=t.GameVars.monstersActions[s],r={miss:!1,critical:!1,backfired:!1,type:t.GameConstants.ATTACK_NORMAL,id:s,damage:0},m=100*Math.random()>n.aiming;if(t.GameVars.slotData.state<t.GameConstants.TUTORIAL_SWAP_2&&(m=!1),m)return r.miss=!0,n.rage&&(n.rage=!1,a.showMonsterStates(!1,!1)),t.AudioManager.playSound("missed_attack"),{attackData:r,hack:!1};var h=!1;0!==o.damage&&(h=100*Math.random()<10,r.critical=h,t.GameVars.slotData.state<t.GameConstants.TUTORIAL_SWAP_2&&(h=!1)),0!==o.damage&&(o.class===t.GameConstants.ELEMENT_CLASSIC?i.class===t.GameConstants.ELEMENT_SPECTRE?r.type=t.GameConstants.ATTACK_STRONG:i.class===t.GameConstants.ELEMENT_TECH&&(r.type=t.GameConstants.ATTACK_WEAK):o.class===t.GameConstants.ELEMENT_SPECTRE?i.class===t.GameConstants.ELEMENT_TECH?r.type=t.GameConstants.ATTACK_STRONG:i.class===t.GameConstants.ELEMENT_CLASSIC&&(r.type=t.GameConstants.ATTACK_WEAK):o.class===t.GameConstants.ELEMENT_TECH&&(i.class===t.GameConstants.ELEMENT_CLASSIC?r.type=t.GameConstants.ATTACK_STRONG:i.class===t.GameConstants.ELEMENT_SPECTRE&&(r.type=t.GameConstants.ATTACK_WEAK)));var l=2*n.level/5+2,c=l*o.damage*(n.attack/i.defense)/10+1,d=l*o.damage*(n.attack/n.defense)/10+1;0===o.damage&&(c=0,d=0),c<=0&&(c=0,d=0,r.critical=!1),h&&(c*=t.GameConstants.CRITICAL_MULTIPLIER,d*=t.GameConstants.CRITICAL_MULTIPLIER),r.type===t.GameConstants.ATTACK_STRONG?c*=t.GameConstants.STRONG_MULTIPLIER:c*=t.GameConstants.WEAK_MULTIPLIER,n.rage&&(n.rage=!1,c*=t.GameConstants.RAGE_MULTIPLIER,d*=t.GameConstants.RAGE_MULTIPLIER);var p,u,g=i;if(n.hypno&&0!==o.damage&&Math.random()<.5&&t.GameVars.slotData.state>=t.GameConstants.TUTORIAL_SWAP_2&&(r.backfired=!0,r.type=t.GameConstants.ATTACK_NORMAL,g=n),r.backfired?g.life-=d:g.life-=c,g.life<=0&&(g.life=0,t.GameVars.needChangeMonster=e?r.backfired?t.GameConstants.PLAYER_CHANGE:t.GameConstants.ADVERSARY_CHANGE:r.backfired?t.GameConstants.ADVERSARY_CHANGE:t.GameConstants.PLAYER_CHANGE),r.backfired)return{attackData:r,hack:n.hypno};var G=!1,f=!1;if(o.special===t.GameConstants.SPECIAL_ATTACK?o.specialTarget===t.GameConstants.PLAYER?n.life>0&&(p=n.attack,n.attack+=t.GameConstants.INCREMENT_STATS,u=n.attack):i.life>0&&(p=i.attack,i.attack-=t.GameConstants.INCREMENT_STATS,u=i.attack):o.special===t.GameConstants.SPECIAL_DEFENSE?o.specialTarget===t.GameConstants.PLAYER?n.life>0&&(p=n.defense,n.defense+=t.GameConstants.INCREMENT_STATS,u=n.defense):i.life>0&&(p=i.defense,i.defense-=t.GameConstants.INCREMENT_STATS,u=i.defense):o.special===t.GameConstants.SPECIAL_AIM?o.specialTarget===t.GameConstants.PLAYER?n.life>0&&(p=n.aiming,n.aiming+=t.GameConstants.INCREMENT_STATS,u=n.aiming):i.life>0&&(p=i.aiming,i.aiming-=t.GameConstants.INCREMENT_STATS,u=i.aiming):o.special===t.GameConstants.SPECIAL_HACK&&t.GameVars.slotData.state>=t.GameConstants.TUTORIAL_SWAP_2?Math.random()<o.specialFactor&&(o.specialTarget===t.GameConstants.PLAYER&&!n.hypno&&n.life>0?(n.hypno=!0,G=!0):o.specialTarget===t.GameConstants.ADVERSARY&&i.life>0&&!i.hypno&&(i.hypno=!0,G=!0)):o.special===t.GameConstants.SPECIAL_POISON?Math.random()<o.specialFactor&&(o.specialTarget===t.GameConstants.PLAYER&&!n.poison&&n.life>0?(n.poison=!0,f=!0):o.specialTarget===t.GameConstants.ADVERSARY&&i.life>0&&!i.poison&&(i.poison=!0,f=!0)):o.special===t.GameConstants.SPECIAL_RAGE&&(o.specialTarget===t.GameConstants.PLAYER&&!n.rage&&n.life>0?n.rage=!0:o.specialTarget===t.GameConstants.ADVERSARY&&i.life>0&&!i.rage&&(i.rage=!0)),n.hypno?this.game.time.events.add(6*t.GameConstants.CHANGE_TIME,(function(){a.showMonsterStates(G,f)}),this):a.showMonsterStates(G,f),n.attack>t.GameConstants.MAX_ATTACK&&(n.attack=t.GameConstants.MAX_ATTACK,u=n.attack),i.attack>t.GameConstants.MAX_ATTACK&&(i.attack=t.GameConstants.MAX_ATTACK,u=i.attack),n.defense>t.GameConstants.MAX_DEFENSE&&(n.defense=t.GameConstants.MAX_DEFENSE,u=n.defense),i.defense>t.GameConstants.MAX_DEFENSE&&(i.defense=t.GameConstants.MAX_DEFENSE,u=i.defense),n.aiming>t.GameConstants.MAX_AIM&&(n.aiming=t.GameConstants.MAX_AIM,u=n.aiming),i.aiming>t.GameConstants.MAX_AIM&&(i.aiming=t.GameConstants.MAX_AIM,u=i.aiming),p){t.GameVars.specialAttack=!0;var C=o.specialTarget;e||(C=o.specialTarget===t.GameConstants.PLAYER?t.GameConstants.ADVERSARY:t.GameConstants.PLAYER),n.hypno?this.game.time.events.add(8*t.GameConstants.CHANGE_TIME,(function(){a.showSpecialAction(o.special,C,p,u)}),this):a.showSpecialAction(o.special,C,p,u)}return{attackData:r,hack:n.hypno}},a.useItem=function(e,s){switch(a.disableGUI(),e){case 0:t.GameVars.slotData.items.healing--,a.useItemHeal();break;case 1:t.GameVars.slotData.items.hypnoCure--,a.useItemSpecial(t.GameConstants.SPECIAL_HACK);break;case 2:t.GameVars.slotData.items.defenseIncrease--,a.useItemIncrease(t.GameConstants.SPECIAL_DEFENSE);break;case 3:t.GameVars.slotData.items.antidote--,a.useItemSpecial(t.GameConstants.SPECIAL_POISON);break;case 4:t.GameVars.slotData.items.attackIncrease--,a.useItemIncrease(t.GameConstants.SPECIAL_ATTACK);break;case 5:t.GameVars.slotData.items.aimingIncrease--,a.useItemIncrease(t.GameConstants.SPECIAL_AIM)}t.FightState.currentInstance.showUseItem(s),a.actualizeItemsMenu(),this.game.time.events.add(9*t.GameConstants.CHANGE_TIME,a.changeTurn,this)},a.useItemHeal=function(){var a=t.GameVars.playerMonstersFighting[0];a.life=a.maxLife,this.game.time.events.add(2*t.GameConstants.CHANGE_TIME,(function(){t.FightState.currentInstance.updateLife(t.GameConstants.PLAYER)}),this)},a.useItemSpecial=function(e){var s=t.GameVars.playerMonstersFighting[0];e===t.GameConstants.SPECIAL_POISON?s.poison=!1:e===t.GameConstants.SPECIAL_HACK&&(s.hypno=!1),this.game.time.events.add(4*t.GameConstants.CHANGE_TIME,a.showMonsterStates,this)},a.useItemIncrease=function(e){var s,n,i=t.GameVars.playerMonstersFighting[0];e===t.GameConstants.SPECIAL_DEFENSE?(s=i.defense,i.defense+=t.GameConstants.INCREMENT_STATS,n=i.defense):e===t.GameConstants.SPECIAL_ATTACK?(s=i.attack,i.attack+=t.GameConstants.INCREMENT_STATS,n=i.attack):e===t.GameConstants.SPECIAL_AIM&&(s=i.aiming,i.aiming+=t.GameConstants.INCREMENT_STATS,n=i.aiming),i.attack>t.GameConstants.MAX_ATTACK&&(i.attack=t.GameConstants.MAX_ATTACK,n=i.attack),i.defense>t.GameConstants.MAX_DEFENSE&&(i.defense=t.GameConstants.MAX_DEFENSE,n=i.defense),i.aiming>t.GameConstants.MAX_AIM&&(i.aiming=t.GameConstants.MAX_AIM,n=i.aiming),a.showSpecialAction(e,t.GameConstants.PLAYER,s,n)},a.actualizeItemsMenu=function(){t.FightState.currentInstance.actualizeItemsMenu()},a.showMonsterStates=function(a,e){t.FightState.currentInstance.showMonsterStates(a,e)},a.showSpecialAction=function(a,e,s,n){t.FightState.currentInstance.showSpecialAction(a,e,s,n)},a.endFight=function(a){t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ATTACK&&t.GameManager.endAttackTutorial(),t.GameVars.xpEarned=new Array;for(var e=0;e<t.GameVars.playerMonstersFighting.length;e++){var s=t.GameVars.playerMonstersFighting[e],n=0;if(0===s.life)t.GameVars.xpEarned.push(n);else{for(var i=0;i<t.GameVars.xpDistribution.length;i++){var o=t.GameVars.xpDistribution[i];-1!==o.monsters.indexOf(s.id)&&(n+=o.xp/o.monsters.length)}t.GameVars.xpEarned.push(n)}}t.FightState.currentInstance.removeStates(),t.FightState.currentInstance.showEndFight(a)},a.enableGUI=function(){t.FightState.currentInstance.enableGUI()},a.disableGUI=function(){t.FightState.currentInstance.disableGUI()},a.hideMenuLayer=function(){t.FightState.currentInstance.hideMenuLayer()},a}();t.FightManager=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return __extends(e,a),e.prototype.init=function(){e.currentInstance=this,t.FightManager.init(this.game),t.AudioManager.stopSound("music_map",!0,!0),t.AudioManager.stopSound("music_dialogue",!0,!0)},e.prototype.create=function(){this.game.stage.backgroundColor=1123628;var a=new t.BackgroundFight(this.game);this.add.existing(a),this.backgroundAttack=new t.BackgroundAttack(this.game),this.backgroundAttack.visible=!1,this.add.existing(this.backgroundAttack);var e=this.add.group();e.x=t.GameConstants.GAME_WIDTH/2,e.y=t.GameConstants.GAME_HEIGHT/2,e.scale.y=t.GameVars.scaleY,this.monstersContainer=new t.MonstersContainer(this.game),e.add(this.monstersContainer),this.hud=new t.FightHUD(this.game),e.add(this.hud),this.gui=new t.FightGUI(this.game),this.add.existing(this.gui),this.managementLayer=new t.ManagementLayer(this.game),this.add.existing(this.managementLayer),t.AudioManager.playSound("music_fight",!0,1,!0),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_SWAP&&this.gui.enableMoreOnly(),t.GameManager.defaultCursor()},e.prototype.shutdown=function(){e.currentInstance=null,a.prototype.shutdown.call(this)},e.prototype.render=function(){t.GameConstants.FPS&&this.game.debug.text(this.game.time.fps.toString(),t.GameConstants.GAME_WIDTH-30,30,"#ffffff","20px Arial")},e.prototype.animationTutorialAttack=function(){this.monstersContainer.animationAttack(this.monstersContainer.player,null),this.disableGUI(),this.monstersContainer.changeAuraTutorial(),t.GameVars.turn=t.GameConstants.ADVERSARY,this.game.time.events.add(3e3,(function(){this.monstersContainer.animationAttack(this.monstersContainer.adversary,null)}),this),this.game.time.events.add(5500,(function(){t.GameVars.turn=t.GameConstants.PLAYER,this.gui.showMoreButton()}),this)},e.prototype.animationCatch=function(){this.monstersContainer.animationCatch(),this.hud.animationCatch(),this.gui.hideMovementsContainer()},e.prototype.animationReturnToFight=function(){this.game.time.events.add(5*t.GameConstants.CHANGE_TIME,(function(){this.monstersContainer.animationReturnToFight(),this.game.time.events.add(7*t.GameConstants.CHANGE_TIME,(function(){this.hud.animationReturnToFight(),this.gui.showMovementsContainer()}),this),this.game.time.events.add(7*t.GameConstants.CHANGE_TIME,(function(){t.FightManager.changeTurn()}),this)}),this)},e.prototype.successfulCatch=function(){this.monstersContainer.adversary.monsterToIcon(),this.game.time.events.add(4*t.GameConstants.CHANGE_TIME,(function(){this.monstersContainer.hideAdversary(),this.managementLayer.show(),t.AudioManager.playSound("musica_victory")}),this)},e.prototype.showCatchAnimation=function(){this.monstersContainer.adversary.showCatchAnimation()},e.prototype.changeSignClass=function(t){this.monstersContainer.changeSignClass(t)},e.prototype.actualizeItemsMenu=function(){this.gui.actualizeItemsMenu()},e.prototype.showUseItem=function(t){this.monstersContainer.showUseItem(t)},e.prototype.updateLife=function(a,e){this.hud.updateLife(a),a===t.GameConstants.PLAYER?this.monstersContainer.player.poisonAnimation():this.monstersContainer.adversary.poisonAnimation()},e.prototype.showMonsterStates=function(t,a){this.hud.showMonsterStates(t,a),this.monstersContainer.showMonsterStates()},e.prototype.showSpecialAction=function(t,a,e,s){this.hud.showSpecialAction(t,a,e,s)},e.prototype.changePlayerMonster=function(){this.monstersContainer.changePlayerMonster(),this.hud.changePlayerMonster(),this.gui.changePlayerMonster()},e.prototype.changeAdversaryMonster=function(){this.monstersContainer.changeAdversaryMonster(),this.hud.changeAdversaryMonster()},e.prototype.retireAdversaryMonster=function(){this.monstersContainer.retireAdversaryMonster(),this.hud.retireAdversaryMonster()},e.prototype.turnChanged=function(){this.monstersContainer.turnChanged(),this.gui.turnChanged()},e.prototype.playerAttack=function(a){a.hack?this.hud.animationBackfired(a.attackData,t.GameConstants.PLAYER):this.playerAttackAnimation(a.attackData)},e.prototype.playerAttackAnimation=function(a){"004"===a.id||"008"===a.id||"012"===a.id||"016"===a.id?(a.miss||a.backfired||this.setBackgroundAttack(a.id),this.game.time.events.add(1e3,(function(){this.monstersContainer.playerAttack(a),this.hud.newAttack(a,a.backfired?t.GameConstants.PLAYER:t.GameConstants.ADVERSARY)}),this)):(this.monstersContainer.playerAttack(a),this.hud.newAttack(a,a.backfired?t.GameConstants.PLAYER:t.GameConstants.ADVERSARY))},e.prototype.adversaryAttack=function(a){a.hack?this.hud.animationBackfired(a.attackData,t.GameConstants.ADVERSARY):this.adversaryAttackAnimation(a.attackData)},e.prototype.adversaryAttackAnimation=function(a){"004"===a.id||"008"===a.id||"012"===a.id||"016"===a.id?(a.miss||a.backfired||this.setBackgroundAttack(a.id),this.game.time.events.add(1e3,(function(){this.monstersContainer.adversaryAttack(a),this.hud.newAttack(a,a.backfired?t.GameConstants.ADVERSARY:t.GameConstants.PLAYER)}),this)):(this.monstersContainer.adversaryAttack(a),this.hud.newAttack(a,a.backfired?t.GameConstants.ADVERSARY:t.GameConstants.PLAYER))},e.prototype.setBackgroundAttack=function(t){this.backgroundAttack.setBackground(t),this.game.time.events.add(2750,(function(){this.backgroundAttack.hide()}),this)},e.prototype.removeStates=function(){this.monstersContainer.player.monsterData.hypno=!1,this.monstersContainer.player.monsterData.poison=!1,this.monstersContainer.adversary.monsterData.hypno=!1,this.monstersContainer.adversary.monsterData.poison=!1},e.prototype.showEndFight=function(a){this.endFightLayer=new t.EndFightLayer(this.game,a),this.add.existing(this.endFightLayer)},e.prototype.enableGUI=function(){this.gui.enable()},e.prototype.disableGUI=function(){this.gui.disable()},e.prototype.hideMenuLayer=function(){this.gui.hideMenuLayer()},e.prototype.deadPlayerMonster=function(a){a?t.FightManager.endFight(!1):this.gui.onClickMore(),this.monstersContainer.deadPlayerMonster()},e}(Phaser.State);t.FightState=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(s,n){var i=a.call(this,s,null,"end-fight-layer")||this;e.currentInstance=i,i.animationNumber=-1,i.winBool=n,i.previousWisp=0,i.updateWisp=!1;var o=i.create(0,0,i.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));o.alpha=.95,o.tint=1123628,o.inputEnabled=!0,o.events.onInputDown.add(i.onClickDarkLayer,i),o.scale.set(t.GameConstants.GAME_WIDTH/t.GameConstants.BITMAP_SIZE,t.GameConstants.GAME_HEIGHT/t.GameConstants.BITMAP_SIZE),i.add(o);var r=i.create(10,10,i.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));r.tint=62207,r.scale.set((t.GameConstants.GAME_WIDTH-20)/t.GameConstants.BITMAP_SIZE,2*t.GameVars.scaleY/t.GameConstants.BITMAP_SIZE),i.add(r);var m=i.create(10,t.GameConstants.GAME_HEIGHT-10,i.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));m.tint=62207,m.scale.set((t.GameConstants.GAME_WIDTH-20)/t.GameConstants.BITMAP_SIZE,2*t.GameVars.scaleY/t.GameConstants.BITMAP_SIZE),i.add(m);var h=i.create(10,10,i.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));h.tint=62207,h.scale.set(2/t.GameConstants.BITMAP_SIZE,(t.GameConstants.GAME_HEIGHT-20)/t.GameConstants.BITMAP_SIZE),i.add(h);var l=i.create(t.GameConstants.GAME_WIDTH-10-2,10,i.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));l.tint=62207,l.scale.set(2/t.GameConstants.BITMAP_SIZE,(t.GameConstants.GAME_HEIGHT-20)/t.GameConstants.BITMAP_SIZE),i.add(l);var c=new Phaser.Group(i.game);c.y=5,c.alpha=0,c.scale.y=t.GameVars.scaleY,i.add(c);var d=new Phaser.Image(i.game,120,0,"texture_atlas_1","tab_area_big.png");d.anchor.set(.5,0),c.add(d);var p=new Phaser.Text(i.game,120,12,"",{font:"27px Chewy",fontWeight:"400",fill:"#ffb63b"});p.anchor.set(.5,0),c.add(p),p.text=n?t.GameVars.names.VICTORY:t.GameVars.names.DEFEAT;var u=new Phaser.Image(i.game,t.GameConstants.GAME_WIDTH-5,0,"texture_atlas_1","tab_wisps.png");u.anchor.set(1,0),c.add(u),i.wisp=new Phaser.Text(i.game,t.GameConstants.GAME_WIDTH-50,30,t.Utils.validNumber(t.GameVars.slotData.wisp),{font:"25px Chewy",fill:"#59ffff"}),i.wisp.anchor.set(1,.5),c.add(i.wisp);var g=new Phaser.Group(i.game);g.x=t.GameConstants.GAME_WIDTH/2,g.y=t.GameConstants.GAME_HEIGHT/2,g.scale.y=t.GameVars.scaleY,g.alpha=0,i.add(g),i.monstersEndFight=new Array;var G=new Array;1===t.GameVars.playerMonstersFighting.length?G.push({x:0,y:-20,top:!1}):2===t.GameVars.playerMonstersFighting.length?(G.push({x:-110,y:-20,top:!1}),G.push({x:110,y:-20,top:!1})):3===t.GameVars.playerMonstersFighting.length&&(G.push({x:0,y:-80,top:!0}),G.push({x:-110,y:80,top:!1}),G.push({x:110,y:80,top:!1}));for(var f=0;f<t.GameVars.playerMonstersFighting.length;f++){var C=new t.MonsterEndFight(i.game,t.GameVars.playerMonstersFighting[f],G[f].x,G[f].y,G[f].top);g.add(C),i.monstersEndFight.push(C)}return i.continueButton=new Phaser.Button(i.game,t.GameConstants.GAME_WIDTH/2,t.GameConstants.GAME_HEIGHT-5,"texture_atlas_"+t.GameVars.gameData.language,i.onClickContinue,i),i.continueButton.setFrames("btn_continue_over.png","btn_continue.png","btn_continue_over.png"),i.continueButton.events.onInputDown.add(i.onButtonDown,i),i.continueButton.scale.y=t.GameVars.scaleY,i.continueButton.visible=!1,i.continueButton.alpha=0,i.continueButton.anchor.set(.5,1),i.add(i.continueButton),i.newActionEndFight=new t.NewActionEndFight(i.game),i.add(i.newActionEndFight),i.alpha=0,i.game.add.tween(i).to({alpha:1},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),i.game.add.tween(c).to({alpha:1},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),i.game.add.tween(g).to({alpha:1},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0).onComplete.add(i.nextAnimationMonster,i),t.AudioManager.stopSound("music_fight",!0,!0),n?t.AudioManager.playSound("musica_victory"):t.AudioManager.playSound("musica_defeat"),t.GameConstants.SPONSOR===t.GameConstants.POKI&&n&&t.GameVars.typeFight===t.GameConstants.TRAINER_FIGHT&&PokiSDK.happyTime(1),i}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this),this.updateWisp&&(this.previousWisp<t.GameVars.slotData.wisp?(this.previousWisp+=this.wispEarned/10,this.previousWisp>t.GameVars.slotData.wisp&&(this.previousWisp=t.GameVars.slotData.wisp),this.wisp.text=t.Utils.validNumber(Math.round(this.previousWisp))):this.updateWisp=!1)},e.prototype.nextAnimationMonster=function(){if(this.animationNumber++,this.animationNumber<this.monstersEndFight.length){for(var a=0;a<this.monstersEndFight.length;a++)this.monstersEndFight[a].hideMonster();var e=0;t.GameVars.xpEarned&&(e=t.GameVars.xpEarned[this.animationNumber]),this.monstersEndFight[this.animationNumber].animationXp(e)}else this.showContinue()},e.prototype.showNewAction=function(t,a){this.restExp=a,this.newActionEndFight.show(t.id)},e.prototype.hideNewAction=function(){this.game.time.events.add(250,(function(){this.monstersEndFight[this.animationNumber].animationXp(this.restExp)}),this)},e.prototype.showContinue=function(){this.continueButton.visible=!0,this.game.add.tween(this.continueButton).to({alpha:1},200,Phaser.Easing.Linear.None,!0),this.manageWisp();for(var t=0;t<this.monstersEndFight.length;t++)this.monstersEndFight[t].monsterData.life>0?this.monstersEndFight[t].showMonster(!1):this.monstersEndFight[t].hideMonster()},e.prototype.manageWisp=function(){if(this.winBool){this.updateWisp=!0,this.previousWisp=t.GameVars.slotData.wisp,this.wispEarned=0;for(var a=0;a<t.GameVars.adversaryMonstersFighting.length;a++)this.wispEarned+=Math.round(25+t.GameVars.adversaryMonstersFighting[a].level);t.GameVars.slotData.wisp+=this.wispEarned}},e.prototype.onClickContinue=function(){var a=this;this.continueButton.scale.set(1,t.GameVars.scaleY),t.GameConstants.SPONSOR===t.GameConstants.POKI?PokiSDK.commercialBreak().then((function(){t.GameManager.fightToMap(a.winBool)})):t.GameManager.fightToMap(this.winBool)},e.prototype.onButtonDown=function(a){a.scale.set(1.1,1.1*t.GameVars.scaleY)},e.prototype.onClickDarkLayer=function(){},e}(Phaser.Group);t.EndFightLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(s,n,i,o,r){var m=a.call(this,s,null,"monster-end-fight")||this;m.x=i,m.y=o,m.monsterData=n,m.rays=new Phaser.Image(m.game,0,0,"texture_atlas_1","fx_radial_rays.png"),m.rays.anchor.set(.5),m.rays.alpha=0,m.rays.scale.set(.5),m.add(m.rays),m.mkm=new Phaser.Image(m.game,0,0,"texture_atlas_2","current_mkm_"+m.monsterData.class+".png"),m.mkm.anchor.set(.5),m.mkm.alpha=.5,m.mkm.scale.set(.6),m.add(m.mkm),m.monster=new Phaser.Image(m.game,0,0,"texture_atlas_4","mkm_"+m.monsterData.id+"_front.png"),m.monster.anchor.set(.5,.6),m.monster.scale.set(.6),m.monster.alpha=.5,m.add(m.monster),m.level=new Phaser.Text(m.game,50,55,m.monsterData.level+"",{font:"45px Chewy",fontWeight:"400",fill:"#000000"}),m.level.anchor.set(0,.5),m.level.stroke="#11252c",m.level.strokeThickness=8,m.level.alpha=.5,m.add(m.level);var h=new Phaser.Group(m.game);h.y=r?-130:110,m.add(h);var l=new Phaser.Image(m.game,0,0,"texture_atlas_1","monster-capsule-"+m.monsterData.class+".png");l.anchor.set(.5),l.scale.set(.72),h.add(l);var c=new Phaser.Text(m.game,-17,6,m.monsterData.name,{font:"20px Chewy",fontWeight:"400",fill:"#000000"});c.anchor.set(.5),h.add(c);var d=-50,p=new Phaser.Image(m.game,-83,36,"texture_atlas_1","icon_xp.png");p.anchor.set(0,.5),p.scale.set(.8),h.add(p);var u=new Phaser.Sprite(m.game,d,30,m.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));u.scale.set((e.LEVEL_BAR_LENGTH+6)/64,11/64),u.tint=11030019,h.add(u);var g=t.Utils.levelToXp(m.monsterData.level),G=m.monsterData.xp/g*e.LEVEL_BAR_LENGTH,f=new Phaser.Sprite(m.game,-47,33,m.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));return f.scale.set(e.LEVEL_BAR_LENGTH/64,5/64),f.tint=10123320,h.add(f),m.levelBar=new Phaser.Sprite(m.game,-47,33,m.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),m.levelBar.scale.set(G/64,5/64),m.levelBar.tint=16646025,h.add(m.levelBar),m.monsterData.class===t.GameConstants.ELEMENT_CLASSIC?(m.level.fill="#ff9c50",m.level.stroke="#40241D",c.font="Pythia",c.fontSize="20px",c.fill="#5b473c",m.rays.tint=16751696):m.monsterData.class===t.GameConstants.ELEMENT_SPECTRE?(m.level.fill="#b9a8ff",m.level.stroke="#300949",c.font="Goonies",c.fontSize="20px",c.fill="#2a3147",m.rays.tint=12167423):m.monsterData.class===t.GameConstants.ELEMENT_TECH&&(m.level.fill="#00dfa9",m.level.stroke="#102932",c.font="Adineue",c.fontSize="22px",c.fill="#ffffff",m.rays.tint=57257),m}return __extends(e,a),e.prototype.animationXp=function(a){if(0!==a){var s=!1,n=0;this.monsterData.xp+=a,this.monsterData.xp>t.Utils.levelToXp(this.monsterData.level)&&(n=this.monsterData.xp-t.Utils.levelToXp(this.monsterData.level),this.monsterData.xp=t.Utils.levelToXp(this.monsterData.level),s=!0);var i=t.Utils.levelToXp(this.monsterData.level),o=this.monsterData.xp/i*e.LEVEL_BAR_LENGTH,r=400*(o/64-this.levelBar.scale.x)+250;this.showMonster(!0,r),this.game.add.tween(this.levelBar.scale).to({x:o/64},r,Phaser.Easing.Linear.None,!0,250).onComplete.add((function(){s?this.levelUpMonster(n):t.EndFightLayer.currentInstance.nextAnimationMonster()}),this)}else t.EndFightLayer.currentInstance.nextAnimationMonster()},e.prototype.hideMonster=function(){this.game.add.tween(this.mkm).to({alpha:.5},250,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.monster).to({alpha:.5},250,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.level).to({alpha:.5},250,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.rays).to({alpha:0},250,Phaser.Easing.Linear.None,!0)},e.prototype.showMonster=function(t,a){this.game.add.tween(this.mkm).to({alpha:1},250,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.monster).to({alpha:1},250,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.level).to({alpha:1},250,Phaser.Easing.Linear.None,!0),a<20&&(a=20),t?(this.game.add.tween(this.rays).to({alpha:1},a-10,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.rays.scale).to({x:1,y:1},a-10,Phaser.Easing.Cubic.Out,!0)):this.game.add.tween(this.rays).to({alpha:0},a-10,Phaser.Easing.Linear.None,!0)},e.prototype.levelUpMonster=function(a){this.monsterData.xp=0,this.monsterData.level++,this.showLevelUp(),this.game.add.tween(this.level.scale).to({y:0},100,Phaser.Easing.Linear.None,!0).onComplete.add((function(){this.level.text=this.monsterData.level+"",this.game.add.tween(this.level.scale).to({y:1},300,Phaser.Easing.Elastic.Out,!0)}),this);var e=0;this.monsterData.level===t.GameConstants.LEVEL_ATTACK_1?e=1:this.monsterData.level===t.GameConstants.LEVEL_ATTACK_2?e=2:this.monsterData.level===t.GameConstants.LEVEL_ATTACK_3&&(e=3),0!==e?this.game.time.events.add(500,(function(){this.levelBar.scale.x=0,t.EndFightLayer.currentInstance.showNewAction(this.monsterData.actions[e],a)}),this):this.game.time.events.add(1e3,(function(){this.levelBar.scale.x=0,this.animationXp(a)}),this)},e.prototype.showLevelUp=function(){var a=new Phaser.Text(this.game,0,-50,t.GameVars.names["LEVEL UP"],{font:"30px Chewy",fontWeight:"400",fill:"#000000"});a.stroke="#11252c",a.anchor.set(.5),a.strokeThickness=6,a.alpha=0,this.add(a),this.monsterData.class===t.GameConstants.ELEMENT_CLASSIC?a.fill="#ff9c50":this.monsterData.class===t.GameConstants.ELEMENT_SPECTRE?a.fill="#b9a8ff":this.monsterData.class===t.GameConstants.ELEMENT_TECH&&(a.fill="#00dfa9"),this.game.add.tween(a).to({alpha:1},200,Phaser.Easing.Linear.None,!0).onComplete.add((function(){this.game.add.tween(a).to({alpha:0},200,Phaser.Easing.Linear.None,!0,500).onComplete.add((function(){a.destroy()}),this)}),this)},e.LEVEL_BAR_LENGTH=125,e}(Phaser.Group);t.MonsterEndFight=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"new-action-end-fight")||this;s.visible=!1,s.scale.y=t.GameVars.scaleY;var n=s.create(0,0,s.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));n.alpha=.5,n.tint=1059122,n.inputEnabled=!0,n.events.onInputDown.add(s.onClickDarkLayer,s),n.scale.set(t.GameConstants.GAME_WIDTH/t.GameConstants.BITMAP_SIZE,t.GameConstants.GAME_HEIGHT/t.GameConstants.BITMAP_SIZE),s.add(n),s.midContainer=new Phaser.Group(s.game),s.midContainer.x=t.GameConstants.GAME_WIDTH/2,s.midContainer.y=t.GameConstants.GAME_HEIGHT/2,s.midContainer.scale.y=t.GameVars.scaleY,s.add(s.midContainer),s.layer=s.create(0,0,s.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),s.layer.tint=1059122,s.layer.anchor.set(.5),s.layer.scale.set(220/t.GameConstants.BITMAP_SIZE,220/t.GameConstants.BITMAP_SIZE),s.midContainer.add(s.layer);var i=new Phaser.Image(s.game,0,0,"texture_atlas_1","frame_new_attack.png");return i.anchor.set(.5),s.midContainer.add(i),s.newAttack=new Phaser.Text(s.game,0,-105,t.GameVars.names["NEW ATTACK"],{font:"36px Chewy",fontWeight:"400",fill:"#00dfa9"}),s.newAttack.anchor.set(.5),s.newAttack.stroke="#102932",s.newAttack.strokeThickness=8,s.midContainer.add(s.newAttack),s.image=new Phaser.Image(s.game,0,-50,"texture_atlas_1","btn_attack_001.png"),s.image.anchor.set(.5),s.midContainer.add(s.image),s.actionName=new Phaser.Text(s.game,0,0,"",{font:"26px Chewy",fontWeight:"400",fill:"#00dfa9"}),s.actionName.anchor.set(.5),s.midContainer.add(s.actionName),s.damage=new Phaser.Text(s.game,0,40,"",{font:"18px Chewy",fontWeight:"400",fill:"#00dfa9"}),s.damage.anchor.set(.5),s.midContainer.add(s.damage),s.cooldown=new Phaser.Text(s.game,0,65,"",{font:"18px Chewy",fontWeight:"400",fill:"#00dfa9"}),s.cooldown.anchor.set(.5),s.midContainer.add(s.cooldown),s.special1=new Phaser.Text(s.game,0,90,"",{font:"18px Chewy",fontWeight:"400",fill:"#00dfa9"}),s.special1.anchor.set(1,.5),s.midContainer.add(s.special1),s.specialImg1=new Phaser.Image(s.game,32,80,"texture_atlas_1","icon_buff.png"),s.specialImg1.anchor.set(.5),s.specialImg1.scale.set(.8),s.midContainer.add(s.specialImg1),s.specialImg2=new Phaser.Image(s.game,15,88,"texture_atlas_1","icon_attack.png"),s.specialImg2.anchor.set(.5),s.specialImg2.scale.set(.75),s.midContainer.add(s.specialImg2),s.special2=new Phaser.Text(s.game,45,90,"",{font:"18px Chewy",fontWeight:"400",fill:"#00dfa9"}),s.special2.anchor.set(0,.5),s.midContainer.add(s.special2),s}return __extends(e,a),e.prototype.show=function(a){this.visible=!0,this.alpha=0,this.midContainer.scale.set(0),this.game.add.tween(this).to({alpha:1},250,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.midContainer.scale).to({x:1,y:1},1e3,Phaser.Easing.Elastic.Out,!0);var e=t.GameVars.monstersActions[a];this.image.frameName="btn_attack_"+a+".png",this.actionName.text=e.name.toUpperCase(),this.damage.text=t.GameVars.names.DAMAGE+": "+Math.round(10*e.damage),1===e.cooldown?this.cooldown.text=t.GameVars.names.COOLDOWN+": "+e.cooldown+" "+t.GameVars.names.TURN:this.cooldown.text=t.GameVars.names.COOLDOWN+": "+e.cooldown+" "+t.GameVars.names.TURNS,e.special!==t.GameConstants.SPECIAL_NONE?(this.special1.text=t.GameVars.names.SPECIAL+": ",e.specialTarget===t.GameConstants.PLAYER?this.special2.text=t.GameVars.names.SELF:this.special2.text=t.GameVars.names.RIVAL,e.specialFactor>1?this.specialImg1.frameName="icon_buff.png":this.specialImg1.frameName="icon_nerf.png",this.specialImg2.frameName="icon_"+e.special+".png",this.specialImg2.visible=!0,e.special!==t.GameConstants.SPECIAL_POISON&&e.special!==t.GameConstants.SPECIAL_HACK&&e.special!==t.GameConstants.SPECIAL_RAGE?(this.specialImg1.visible=!0,this.special2.x=45):(this.specialImg1.visible=!1,this.special2.x=38)):(this.special1.text="",this.special2.text="",this.specialImg1.visible=!1,this.specialImg2.visible=!1),e.class===t.GameConstants.ELEMENT_CLASSIC?(this.newAttack.text=t.GameVars.names["NEW ATTACK"]+" "+t.GameVars.names.CLASSIC.replace("Á","A")+"!",this.layer.tint=4203549,this.newAttack.fill="#ff9c50",this.newAttack.stroke="#40241D",this.actionName.fill="#ff9c50",this.damage.fill="#ff9c50",this.special1.fill="#ff9c50",this.special2.fill="#ff9c50",this.cooldown.fill="#ff9c50",t.AudioManager.playSound("new_attack_classic")):e.class===t.GameConstants.ELEMENT_SPECTRE?(this.newAttack.text=t.GameVars.names["NEW ATTACK"]+" "+t.GameVars.names.SPECTRE+"!",this.layer.tint=2759229,this.newAttack.fill="#b9a8ff",this.newAttack.stroke="#2A1A3D",this.actionName.fill="#b9a8ff",this.damage.fill="#b9a8ff",this.special1.fill="#b9a8ff",this.special2.fill="#b9a8ff",this.cooldown.fill="#b9a8ff",t.AudioManager.playSound("new_attack_spectre")):e.class===t.GameConstants.ELEMENT_TECH?(this.newAttack.text=t.GameVars.names["NEW ATTACK"]+" "+t.GameVars.names.TECH+"!",this.layer.tint=1059122,this.newAttack.fill="#00dfa9",this.newAttack.stroke="#102932",this.actionName.fill="#00dfa9",this.damage.fill="#00dfa9",this.special1.fill="#00dfa9",this.special2.fill="#00dfa9",this.cooldown.fill="#00dfa9",t.AudioManager.playSound("new_attack_tech")):(this.newAttack.text=t.GameVars.names["NEW ATTACK"]+" "+t.GameVars.names.GENERIC+"!",this.layer.tint=797512,this.newAttack.fill="#59ffff",this.newAttack.stroke="#0c2b48",this.actionName.fill="#59ffff",this.damage.fill="#59ffff",this.special1.fill="#59ffff",this.special2.fill="#59ffff",this.cooldown.fill="#59ffff",t.AudioManager.playSound("new_attack_generic"))},e.prototype.onClickDarkLayer=function(){this.visible=!1,t.EndFightLayer.currentInstance.hideNewAction()},e}(Phaser.Group);t.NewActionEndFight=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"gui")||this;s.tutorialCounter=0,s.extraCatchUsed=!1,s.container=new Phaser.Group(s.game),s.container.y=t.GameConstants.GAME_HEIGHT,s.container.scale.y=t.GameVars.scaleY,s.add(s.container),s.moreButton=new Phaser.Button(s.game,2,-2,"texture_atlas_1",s.onClickMore,s),s.moreButton.setFrames("btn_more.png","btn_more.png","btn_more.png"),s.moreButton.events.onInputDown.add(s.onButtonDown,s),s.moreButton.input.useHandCursor=!0,s.moreButton.anchor.set(0,1),s.moreButton.forceOut=!0,s.container.add(s.moreButton),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ESCAPE&&(s.tutorialAnim=new Phaser.Image(s.game,2+s.moreButton.width/2,-2-s.moreButton.height/2,"texture_atlas_1","resalte_btn_tutorial.png"),s.tutorialAnim.anchor.set(.5),s.tutorialAnim.scale.set(1.1),s.tutorialAnim.visible=!1,s.container.add(s.tutorialAnim)),s.captureContainer=new Phaser.Group(s.game),s.captureContainer.x=s.moreButton.x+s.moreButton.width+2,s.captureContainer.y=-2,s.container.add(s.captureContainer),s.captureButton=new Phaser.Button(s.game,0,0,"texture_atlas_"+t.GameVars.gameData.language,s.onClickCatch,s),s.captureButton.setFrames("btn_capture.png","btn_capture.png","btn_capture.png"),s.captureButton.anchor.set(0,1),s.captureButton.forceOut=!0,s.captureButton.input.useHandCursor=!0,t.GameVars.slotData.state===t.GameConstants.TUTORIAL_CAPTURE&&(s.tutorialAnim=new Phaser.Image(s.game,0+s.captureButton.width/2,2-s.captureButton.height/2,"texture_atlas_1","resalte_btn_tutorial.png"),s.tutorialAnim.anchor.set(.5),s.tutorialAnim.scale.set(1.1),s.tutorialAnim.visible=!1,s.captureContainer.add(s.tutorialAnim)),s.captureContainer.add(s.captureButton);var n=new Phaser.Image(s.game,0,0,"texture_atlas_1","btn_capture_circle.png");if(n.anchor.set(0,1),s.captureContainer.add(n),s.numberCapture=new Phaser.Text(s.game,58,-58,t.GameVars.slotData.items.ball+"",{font:"22px Chewy",fontWeight:"400",fill:"#00427f"}),s.numberCapture.anchor.set(.5),s.captureContainer.add(s.numberCapture),t.GameVars.typeFight===t.GameConstants.TRAINER_FIGHT){s.captureButton.inputEnabled=!1,s.captureButton.alpha=.75;var i=new Phaser.Image(s.game,s.moreButton.x+s.moreButton.width+2,-2,"texture_atlas_1","icon_forbidden.png");i.anchor.set(0,1),s.container.add(i)}return s.captureVideoButton=new Phaser.Button(s.game,s.captureContainer.x+s.captureButton.width-2,-2,"texture_atlas_"+t.GameVars.gameData.language,s.onClickVideo,s),s.captureVideoButton.setFrames("btn_capture_crit.png","btn_capture_crit.png","btn_capture_crit.png"),s.captureVideoButton.anchor.set(0,1),s.captureVideoButton.forceOut=!0,s.captureVideoButton.input.useHandCursor=!0,s.container.add(s.captureVideoButton),(t.GameVars.slotData.items.ball>0||t.GameVars.typeFight===t.GameConstants.TRAINER_FIGHT)&&(s.captureVideoButton.visible=!1),s.movementsContainer=new t.MovementsContainer(s.game),s.movementsContainer.x=t.GameConstants.GAME_WIDTH-35,s.movementsContainer.y=t.GameConstants.GAME_HEIGHT-5,s.movementsContainer.scale.y=t.GameVars.scaleY,s.add(s.movementsContainer),s.menuFightLayer=new t.MenuFightLayer(s.game),s.add(s.menuFightLayer),s.checkCaptureNumber(),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ESCAPE&&(s.captureButton.visible=!1,s.numberCapture.visible=!1,s.moreButton.visible=!1,s.captureVideoButton.visible=!1,n.visible=!1),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_CAPTURE&&(s.captureButton.inputEnabled=!1,s.captureButton.alpha=.5,s.captureVideoButton.visible=!1),t.GameVars.slotData.state<=t.GameConstants.TUTORIAL_CAPTURE&&(s.captureVideoButton.visible=!1),s}return __extends(e,a),e.prototype.enable=function(){t.GameVars.typeFight!==t.GameConstants.TRAINER_FIGHT&&(this.captureButton.inputEnabled=!0,this.captureButton.alpha=1,this.captureVideoButton.inputEnabled=!0,this.captureVideoButton.alpha=1),this.checkCaptureNumber(),t.GameVars.slotData.state!==t.GameConstants.TUTORIAL_CAPTURE?(this.moreButton.inputEnabled=!0,this.moreButton.alpha=1,this.movementsContainer.enable()):2===this.tutorialCounter?(this.tutorialAnim&&(this.tutorialAnim.visible=!0,this.game.add.tween(this.tutorialAnim.scale).to({x:[1,1.1],y:[1,1.1]},500,Phaser.Easing.Linear.None,!0,0,-1)),this.game.add.tween(this.captureContainer.scale).to({x:[1.05,1],y:[1.05,1]},500,Phaser.Easing.Linear.None,!0,0,-1)):(this.tutorialCounter++,this.moreButton.inputEnabled=!0,this.moreButton.alpha=1,this.captureButton.alpha=.5,this.captureButton.inputEnabled=!1,this.movementsContainer.enable()),this.moreTween&&this.moreTween.stop()},e.prototype.disable=function(){this.moreButton.inputEnabled=!1,this.moreButton.alpha=.5,this.captureButton.inputEnabled=!1,this.captureButton.alpha=.5,this.captureVideoButton.inputEnabled=!1,this.captureVideoButton.alpha=.5,this.movementsContainer.disable()},e.prototype.enableMoreOnly=function(){this.captureButton.inputEnabled=!1,this.captureButton.alpha=.5,this.movementsContainer.disable(),this.moreTween=this.game.add.tween(this.moreButton.scale).to({x:[1.05,1],y:[1.05,1]},500,Phaser.Easing.Linear.None,!0,0,-1)},e.prototype.showMoreButton=function(){this.moreButton.visible=!0,this.moreButton.alpha=0,this.moreButton.inputEnabled=!0,this.game.add.tween(this.moreButton).to({alpha:1},150,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.moreButton.scale).to({x:[1.05,1],y:[1.05,1]},500,Phaser.Easing.Linear.None,!0,0,-1),this.tutorialAnim&&(this.tutorialAnim.visible=!0,this.game.add.tween(this.tutorialAnim.scale).to({x:[1,1.1],y:[1,1.1]},500,Phaser.Easing.Linear.None,!0,0,-1))},e.prototype.actualizeItemsMenu=function(){this.menuFightLayer.actualizeItemsMenu()},e.prototype.hideMenuLayer=function(){this.menuFightLayer.hideMenuLayer()},e.prototype.changePlayerMonster=function(){this.menuFightLayer.changePlayerMonster(),this.movementsContainer.changePlayerMonster(),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_SWAP&&this.enable()},e.prototype.onClickMore=function(){this.moreButton.scale.set(1),this.menuFightLayer.show()},e.prototype.onClickCatch=function(){t.GameVars.slotData.items.ball--,this.numberCapture.text=t.GameVars.slotData.items.ball+"",this.checkCaptureNumber(),0!==t.GameVars.slotData.items.ball||this.extraCatchUsed||(this.captureVideoButton.visible=!0),t.FightManager.catchMonster()},e.prototype.onClickVideo=function(){this.extraCatchUsed=!0,this.captureVideoButton.visible=!1,t.FightManager.catchVideoMonster()},e.prototype.turnChanged=function(){t.GameVars.turn===t.GameConstants.PLAYER&&this.movementsContainer.turnChanged()},e.prototype.hideMovementsContainer=function(){this.game.add.tween(this.container).to({y:this.container.y+200},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),this.movementsContainer.hide()},e.prototype.showMovementsContainer=function(){this.game.add.tween(this.container).to({y:this.container.y-200},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),this.movementsContainer.show()},e.prototype.checkCaptureNumber=function(){0===t.GameVars.slotData.items.ball&&(this.captureButton.alpha=.5,this.captureButton.inputEnabled=!1)},e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),a.scale.set(1.1)},e}(Phaser.Group);t.FightGUI=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i){var o=a.call(this,e,null,"items-button")||this;o.x=n,o.y=i,o.i=s,o.createNameNum();var r="btn_use_"+o.name+".png";o.button=new Phaser.Button(o.game,0,0,"texture_atlas_"+t.GameVars.gameData.language,o.selectItem,o),o.button.setFrames(r,r,r),o.button.events.onInputDown.add(o.onButtonDown,o),o.button.events.onInputOut.add(o.onOut,o),o.button.events.onInputOver.add(o.onOver,o),o.button.anchor.set(.5),o.add(o.button);var m=new Phaser.Image(o.game,0,0,"texture_atlas_1","circle_use_item.png");return m.anchor.set(.5),o.add(m),o.numberText=new Phaser.Text(o.game,40,-20,o.num+"",{font:"22px Chewy",fontWeight:"400",fill:"#00427f"}),o.numberText.anchor.set(.5),o.add(o.numberText),0===o.num&&(o.button.alpha=.5,o.button.inputEnabled=!1),o}return __extends(e,a),e.prototype.createNameNum=function(){switch(this.i){case 0:this.name="heal",this.num=t.GameVars.slotData.items.healing;break;case 1:this.name="focus",this.num=t.GameVars.slotData.items.hypnoCure;break;case 2:this.name="defense",this.num=t.GameVars.slotData.items.defenseIncrease;break;case 3:this.name="antidote",this.num=t.GameVars.slotData.items.antidote;break;case 4:this.name="attack",this.num=t.GameVars.slotData.items.attackIncrease;break;case 5:this.name="aim",this.num=t.GameVars.slotData.items.aimingIncrease}},e.prototype.enable=function(){this.button.alpha=1,this.button.inputEnabled=!0,0===this.num&&(this.button.alpha=.5,this.button.inputEnabled=!1)},e.prototype.disable=function(){this.button.alpha=.5,this.button.inputEnabled=!1},e.prototype.disableButton=function(){this.button.alpha=.5,this.button.inputEnabled=!1},e.prototype.canSelect=function(){return 0!==this.num},e.prototype.selectItem=function(){this.scale.set(1.1),t.FightManager.useItem(this.i,this.name),t.FightManager.hideMenuLayer()},e.prototype.actualizeItem=function(){this.createNameNum(),this.numberText.text=this.num+""},e.prototype.onButtonDown=function(){t.AudioManager.playSound("click_btn"),this.scale.set(1.1)},e.prototype.onOut=function(t){this.scale.set(1)},e.prototype.onOver=function(t){this.scale.set(1.05)},e}(Phaser.Group);t.ItemsButton=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"menu-fight-layer")||this,n=s.create(0,0,s.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_1));n.inputEnabled=!0,n.events.onInputDown.add(s.onClickDarkLayer,s),n.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),s.add(n);var i=s.create(0,320,s.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_2));i.inputEnabled=!0,i.events.onInputDown.add(s.onClickDarkLayer,s),i.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),s.add(i);var o=new Phaser.Group(s.game);o.scale.y=t.GameVars.scaleY,s.add(o),s.backButton=new Phaser.Button(s.game,10,10,"texture_atlas_1",s.hide,s),s.backButton.setFrames("btn_back.png","btn_back.png","btn_back.png"),s.backButton.anchor.set(.5),s.backButton.x+=s.backButton.width/2,s.backButton.y+=s.backButton.height/2,s.backButton.events.onInputDown.add(s.onButtonDown,s),s.backButton.events.onInputOut.add(s.onOut,s),s.backButton.events.onInputOver.add(s.onOver,s),o.add(s.backButton);var r=new Phaser.Group(s.game);r.scale.y=t.GameVars.scaleY,r.x=t.GameConstants.GAME_WIDTH/2,r.y=90;var m=new Phaser.Image(s.game,0,-40,"texture_atlas_1","tab_area.png");m.anchor.set(.5),m.scale.x=-1,r.add(m);var h=new Phaser.Text(s.game,0,-50,t.GameVars.names.ESCAPE,{font:"14px Chewy",fontWeight:"400",fill:"#ffb63b"});h.anchor.set(.5),r.add(h),s.escapeButton=new Phaser.Button(s.game,0,24,"texture_atlas_"+t.GameVars.gameData.language,s.onEscapeClicked,s),s.escapeButton.setFrames("btn_escape.png","btn_escape.png","btn_escape.png"),s.escapeButton.events.onInputDown.add(s.onButtonDown,s),s.escapeButton.events.onInputOut.add(s.onOut,s),s.escapeButton.events.onInputOver.add(s.onOver,s),s.escapeButton.anchor.set(.5),s.escapeButton.forceOut=!0,s.darkLayer=s.create(-t.GameConstants.GAME_WIDTH/2,-90/t.GameVars.scaleY,s.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),s.darkLayer.alpha=.7,s.darkLayer.visible=!1,s.darkLayer.tint=859177,s.darkLayer.inputEnabled=!0,s.darkLayer.events.onInputDown.add(s.onClickDarkLayer,s),s.darkLayer.scale.set(t.GameConstants.GAME_WIDTH/t.GameConstants.BITMAP_SIZE,t.GameConstants.GAME_HEIGHT/t.GameConstants.BITMAP_SIZE/t.GameVars.scaleY),r.add(s.darkLayer),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ESCAPE&&(s.tutorialAnim=new Phaser.Image(s.game,0,24,"texture_atlas_1","resalte_btn_tutorial.png"),s.tutorialAnim.anchor.set(.5),s.tutorialAnim.scale.set(1.1),r.add(s.tutorialAnim),s.game.add.tween(s.escapeButton.scale).to({x:[1.05,1],y:[1.05,1]},500,Phaser.Easing.Linear.None,!0,0,-1),s.game.add.tween(s.tutorialAnim.scale).to({x:[1,1.1],y:[1,1.1]},500,Phaser.Easing.Linear.None,!0,0,-1)),r.add(s.escapeButton);var l=new Phaser.Group(s.game);if(l.scale.y=t.GameVars.scaleY,l.x=t.GameConstants.GAME_WIDTH/2,l.y=290,t.GameVars.slotData.state>t.GameConstants.TUTORIAL_ESCAPE){var c=new Phaser.Image(s.game,0,-40,"texture_atlas_1","tab_area.png");c.anchor.set(.5),c.scale.x=-1,l.add(c);var d=new Phaser.Text(s.game,0,-50,t.GameVars.names.REPLACE,{font:"14px Chewy",fontWeight:"400",fill:"#ffb63b"});d.anchor.set(.5),l.add(d),s.monsterButtons=new Array;var p=-100;1===t.GameVars.playerMonstersFighting.length?p=0:2===t.GameVars.playerMonstersFighting.length&&(p=-50);for(var u=0;u<t.GameVars.playerMonstersFighting.length;u++){var g=new t.MonsterButton(s.game,u);g.x=p+100*u,g.y=20,l.add(g),s.monsterButtons.push(g)}for(u=0;u<s.monsterButtons.length;u++)s.monsterButtons[u].setMonster();t.GameVars.slotData.state===t.GameConstants.TUTORIAL_SWAP&&(s.tween=s.game.add.tween(s.monsterButtons[1].scale).to({x:[1.05,1],y:[1.05,1]},500,Phaser.Easing.Linear.None,!0,0,-1));var G=new Phaser.Group(s.game);G.x=t.GameConstants.GAME_WIDTH/2,G.y=520,G.scale.y=t.GameVars.scaleY,s.add(G);var f=new Phaser.Image(s.game,0,-80,"texture_atlas_1","tab_area.png");f.anchor.set(.5),f.scale.x=-1,G.add(f);var C=new Phaser.Text(s.game,0,-90,t.GameVars.names["USE ITEM"],{font:"14px Chewy",fontWeight:"400",fill:"#ffb63b"});C.anchor.set(.5),G.add(C),s.itemButtons=new Array;for(u=0;u<3;u++)for(var _=0;_<2;_++){var E=new t.ItemsButton(s.game,_+2*u,140*u-135,80*_-10);G.add(E),s.itemButtons.push(E)}}return s.add(r),s.add(l),s.visible=!1,s.alpha=0,s}return __extends(e,a),e.prototype.actualizeItemsMenu=function(){for(var t=0;t<this.itemButtons.length;t++)this.itemButtons[t].actualizeItem()},e.prototype.changePlayerMonster=function(){for(var a=0;a<this.monsterButtons.length;a++)this.monsterButtons[a].setMonster();t.GameVars.slotData.state===t.GameConstants.TUTORIAL_SWAP&&(this.tween.stop(),this.monsterButtons[1].scale.set(1)),this.hide()},e.prototype.show=function(){if(t.GameVars.slotData.state>t.GameConstants.TUTORIAL_ESCAPE)for(var a=0;a<this.monsterButtons.length;a++)this.monsterButtons[a].setMonster();this.visible=!0,this.game.add.tween(this).to({alpha:1},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),t.GameVars.needChangeMonster!==t.GameConstants.NO_CHANGE?this.darkLayer.visible=!0:this.darkLayer.visible=!1,t.GameVars.slotData.state>t.GameConstants.TUTORIAL_ESCAPE&&this.enableItems(),t.GameVars.playerMonstersFighting[0]&&t.GameVars.playerMonstersFighting[0].life===t.GameVars.playerMonstersFighting[0].maxLife&&this.itemButtons[0].disableButton()},e.prototype.enableItems=function(){for(var t=0;t<this.itemButtons.length;t++)this.itemButtons[t].enable()},e.prototype.disableItems=function(){for(var t=0;t<this.itemButtons.length;t++)this.itemButtons[t].disable()},e.prototype.hide=function(a){a&&a.scale.set(1),t.FightManager.hideMenuLayer()},e.prototype.hideMenuLayer=function(){this.alpha=0,this.visible=!1},e.prototype.onEscapeClicked=function(){this.escapeButton.scale.set(1),t.GameVars.slotData.state>t.GameConstants.TUTORIAL_ESCAPE&&(t.GameVars.currentSpawn=null),t.GameConstants.SPONSOR===t.GameConstants.POKI?PokiSDK.commercialBreak().then((function(){t.GameManager.fightToMap()})):t.GameManager.fightToMap()},e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),a.scale.set(1.1)},e.prototype.onClickDarkLayer=function(){},e.prototype.onOut=function(t){t.scale.set(1)},e.prototype.onOver=function(t){t.scale.set(1.05)},e}(Phaser.Group);t.MenuFightLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(s,n){var i=a.call(this,s,null,"monster-button")||this;i.id=n;var o=t.GameVars.playerMonstersFighting[i.id],r="icon_"+o.id+".png";i.button=new Phaser.Button(i.game,0,0,"texture_atlas_4",i.changeMonster,i),i.button.setFrames(r,r,r),i.button.events.onInputDown.add(i.onButtonDown,i),i.button.anchor.set(.5),i.button.forceOut=!0,i.add(i.button),i.level=new Phaser.Text(i.game,-32,-33,o.level+"",{font:"18px Chewy",fontWeight:"400",fill:"#000000"}),i.level.stroke="#11252c",i.level.strokeThickness=5,i.add(i.level),o.class===t.GameConstants.ELEMENT_CLASSIC?i.level.fill="#ff9c50":o.class===t.GameConstants.ELEMENT_SPECTRE?i.level.fill="#b9a8ff":o.class===t.GameConstants.ELEMENT_TECH&&(i.level.fill="#00dfa9"),0===i.id&&(i.text=new Phaser.Text(i.game,0,55,t.GameVars.names.FIGHTING,{font:"16px Chewy",fontWeight:"400",fill:"#ffffff"}),i.text.anchor.set(.5),i.text.stroke="#0066cc",i.text.strokeThickness=4,i.add(i.text)),i.barContainer=new Phaser.Group(i.game),i.barContainer.x=38,i.barContainer.y=32,i.add(i.barContainer);var m=new Phaser.Sprite(i.game,0,0,i.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));m.scale.set(14/64,(e.BAR_LENGTH+6)/64),m.anchor.set(0,1),m.tint=1136974,i.barContainer.add(m);var h=new Phaser.Sprite(i.game,3,-3,i.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));return h.scale.set(8/64,e.BAR_LENGTH/64),h.anchor.set(0,1),h.tint=161120,i.barContainer.add(h),i.bar=new Phaser.Sprite(i.game,3,-3,i.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),i.bar.scale.set(8/64,e.BAR_LENGTH/64),i.bar.anchor.set(0,1),i.bar.tint=4114513,i.barContainer.add(i.bar),i}return __extends(e,a),e.prototype.setMonster=function(){var a=t.GameVars.playerMonstersFighting[this.id];0===a.life?(this.alpha=.3,this.button.inputEnabled=!1):0===this.id&&(this.button.alpha=.5,this.level.alpha=.5,this.barContainer.alpha=.5,this.button.inputEnabled=!1);var s="icon_"+a.id+".png";this.button.setFrames(s,s,s),this.level.text=a.level+"",a.class===t.GameConstants.ELEMENT_CLASSIC?this.level.fill="#ff9c50":a.class===t.GameConstants.ELEMENT_SPECTRE?this.level.fill="#b9a8ff":a.class===t.GameConstants.ELEMENT_TECH&&(this.level.fill="#00dfa9");var n=a.life/a.maxLife*e.BAR_LENGTH;this.bar.scale.y=n/64,t.GameVars.needChangeMonster!==t.GameConstants.NO_CHANGE&&0===this.id?this.text.text=" DEFEATED ":this.text&&(this.text.text=" NOW FIGHTING ")},e.prototype.changeMonster=function(){this.scale.set(1),t.FightManager.changePlayerMonster(this.id)},e.prototype.onButtonDown=function(){this.scale.set(1.1)},e.BAR_LENGTH=58,e}(Phaser.Group);t.MonsterButton=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s){var n,i,o,r=a.call(this,e,null,"movement-button")||this;r.id=s,t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ESCAPE?(n=0===s?"ander_01":"ander_02",i=1,o=t.GameConstants.ELEMENT_COMMON):(n=t.GameVars.playerMonstersFighting[0].actions[r.id].id,i=t.GameVars.monstersActions[n].cooldown,o=t.GameVars.monstersActions[n].class),r.button=new Phaser.Button(r.game,0,0,"texture_atlas_1",r.onClickButton,r),r.button.setFrames("btn_attack_"+n+".png","btn_attack_"+n+".png","btn_attack_"+n+".png"),r.button.events.onInputDown.add(r.onButtonDown,r),r.button.input.useHandCursor=!0,r.button.anchor.set(.5,1),r.button.forceOut=!0,r.add(r.button),r.frameButton=new Phaser.Image(r.game,0,0,"texture_atlas_1","frame_atk.png"),r.frameButton.anchor.set(.5,1),r.add(r.frameButton),r.cooldownBalls=new Array;for(var m=0;m<i;m++){var h=.5*-(i-1)*15,l=new Phaser.Image(r.game,h+15*m,-3,"texture_atlas_1","cooldown_"+o+".png");l.anchor.set(.5),r.add(l),r.cooldownBalls.push(l)}return r.tween||(r.tween=r.game.add.tween(r.scale).to({x:[.95,1],y:[.95,1]},500,Phaser.Easing.Linear.None,!0,0,-1)),r}return __extends(e,a),e.prototype.enable=function(){0===t.GameVars.playerMonstersFighting[0].actions[this.id].cooldown?(this.button.inputEnabled=!0,this.alpha=1,this.tween||(this.tween=this.game.add.tween(this.scale).to({x:[.95,1],y:[.95,1]},500,Phaser.Easing.Linear.None,!0,0,-1))):(this.button.inputEnabled=!1,this.alpha=.5,this.tween&&(this.tween.stop(),this.tween=null,this.scale.set(1)))},e.prototype.disable=function(){this.button.inputEnabled=!1,this.tween&&(this.tween.stop(),this.tween=null,this.scale.set(1))},e.prototype.turnChanged=function(){var a=t.GameVars.playerMonstersFighting[0].actions[this.id].id;this.tweenCooldown(t.GameVars.monstersActions[a].cooldown-t.GameVars.playerMonstersFighting[0].actions[this.id].cooldown)},e.prototype.changeMonster=function(){var a=t.GameVars.playerMonstersFighting[0].actions[this.id].id;this.button.setFrames("btn_attack_"+a+".png","btn_attack_"+a+".png","btn_attack_"+a+".png"),this.turnChanged(),this.enable()},e.prototype.onClickButton=function(){if(this.scale.set(1),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ESCAPE)t.FightState.currentInstance.animationTutorialAttack();else{var a=t.GameVars.playerMonstersFighting[0].actions[this.id].id;t.GameVars.playerMonstersFighting[0].actions[this.id].cooldown=t.GameVars.monstersActions[a].cooldown,this.tweenCooldown(0),t.FightManager.playerAttack(t.GameVars.playerMonstersFighting[0].actions[this.id].id)}},e.prototype.tweenCooldown=function(a){for(var e=t.GameVars.playerMonstersFighting[0].actions[this.id].id,s=t.GameVars.monstersActions[e].cooldown,n=t.GameVars.monstersActions[e].class,i=0;i<s;i++)this.cooldownBalls[i]&&this.cooldownBalls[i].destroy();this.cooldownBalls=new Array;for(i=0;i<s;i++){var o=.5*-(s-1)*15,r=new Phaser.Image(this.game,o+15*i,-3,"texture_atlas_1","cooldown_void.png");r.anchor.set(.5),this.add(r),this.cooldownBalls.push(r);var m=new Phaser.Image(this.game,o+15*i,-3,"texture_atlas_1","cooldown_"+n+".png");m.anchor.set(.5),this.add(m),this.cooldownBalls.push(m),a<=i&&this.game.add.tween(this.cooldownBalls[this.cooldownBalls.length-1]).to({alpha:[.3,1]},4e3,Phaser.Easing.Cubic.InOut,!0,0,-1)}},e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),this.scale.set(1.1)},e}(Phaser.Group);t.MovementButton=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(t){var e=a.call(this,t,null,"movements-container")||this;return e.createNewButtons(),e}return __extends(e,a),e.prototype.enable=function(){this.alpha=1;for(var t=0;t<this.movementButtons.length;t++)this.movementButtons[t].enable()},e.prototype.disable=function(){this.alpha=.5;for(var a=0;a<this.movementButtons.length;a++)this.movementButtons[a].disable();t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ATTACK?(this.tween.stop(),this.movementButtons[0].scale.set(1),this.finger&&this.finger.destroy()):t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ESCAPE&&this.finger&&this.finger.destroy()},e.prototype.hide=function(){this.game.add.tween(this).to({y:this.y+200},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0)},e.prototype.show=function(){this.game.add.tween(this).to({y:this.y-200},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0)},e.prototype.createNewButtons=function(){var a=0;t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ESCAPE?(a=2,this.finger=new Phaser.Image(this.game,-110,-30,"texture_atlas_1","tutorial_finger.png"),this.finger.scale.set(1,-1),this.finger.angle=-90,this.add(this.finger),this.game.add.tween(this.finger).to({x:[-125,-110]},1e3,Phaser.Easing.Linear.None,!0,0,-1)):a=t.GameVars.playerMonstersFighting[0].level>=t.GameConstants.LEVEL_ATTACK_3?4:t.GameVars.playerMonstersFighting[0].level>=t.GameConstants.LEVEL_ATTACK_2?3:t.GameVars.playerMonstersFighting[0].level>=t.GameConstants.LEVEL_ATTACK_1?2:1,this.movementButtons=new Array;for(var e=66*-(a-0-1),s=0;s<a;s++){var n=new t.MovementButton(this.game,s);n.x=e,this.add(n),this.movementButtons.push(n),e+=66}t.GameVars.slotData.state===t.GameConstants.TUTORIAL_ATTACK&&(this.tween=this.game.add.tween(this.movementButtons[0].scale).to({x:[1.05,1],y:[1.05,1]},500,Phaser.Easing.Linear.None,!0,0,-1),this.finger=new Phaser.Image(this.game,-40,-30,"texture_atlas_1","tutorial_finger.png"),this.finger.scale.set(1,-1),this.finger.angle=-90,this.add(this.finger),this.game.add.tween(this.finger).to({x:[-55,-40]},1e3,Phaser.Easing.Linear.None,!0,0,-1))},e.prototype.changePlayerMonster=function(){this.game.add.tween(this).to({y:this.y+200},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){for(var a=0;a<this.movementButtons.length;a++)this.movementButtons[a].destroy();this.createNewButtons(),this.game.add.tween(this).to({y:this.y-200},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0)}),this)},e.prototype.turnChanged=function(){for(var t=0;t<this.movementButtons.length;t++)this.movementButtons[t].turnChanged()},e.prototype.onClickMovement=function(){},e}(Phaser.Group);t.MovementsContainer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"attack-layer")||this;return s.attackContainer=new Phaser.Group(s.game),s.attackContainer.visible=!1,s.attackContainer.scale.set(0),s.add(s.attackContainer),s.attack=new Phaser.Text(s.game,0,0,"",{font:"22px Chewy",fill:"#7bfff3"}),s.attack.anchor.set(0,.5),s.attackContainer.add(s.attack),s.typeAttack=new Phaser.Text(s.game,0,0,"",{font:"18px Chewy",fill:"#FFFFFF"}),s.typeAttack.anchor.set(0,.5),s.attackContainer.add(s.typeAttack),s.critical=new Phaser.Text(s.game,0,0,"",{font:"18px Chewy",fill:"#fdff94"}),s.critical.anchor.set(0,.5),s.attackContainer.add(s.critical),s.specialBack=new Phaser.Image(s.game,200,100,"texture_atlas_1","fx_radial_rays.png"),s.specialBack.anchor.set(.5),s.specialBack.scale.set(0),s.add(s.specialBack),s.specialImg=new Phaser.Image(s.game,200,100,"texture_atlas_"+t.GameVars.gameData.language,"hacked_text.png"),s.specialImg.anchor.set(.5),s.specialImg.scale.set(0),s.add(s.specialImg),s.hackContainer=new Phaser.Group(s.game),s.hackContainer.visible=!1,s.hackContainer.y=100,s.hackContainer.x=100,s.add(s.hackContainer),s.hackBackground=new Phaser.Image(s.game,0,0,"texture_atlas_1","fx_radial_rays.png"),s.hackBackground.anchor.set(.5),s.hackBackground.scale.set(0),s.hackBackground.tint=57257,s.hackContainer.add(s.hackBackground),s.hackImg=new Phaser.Image(s.game,0,0,"texture_atlas_1","hacked_text_01.png"),s.hackImg.anchor.set(.5),s.hackContainer.add(s.hackImg),s.hackImg2=new Phaser.Image(s.game,0,0,"texture_atlas_"+t.GameVars.gameData.language,"self_attack_text.png"),s.hackImg2.anchor.set(.5),s.hackContainer.add(s.hackImg2),s}return __extends(e,a),e.prototype.show=function(a){var e=0;this.attack.y=0,this.typeAttack.y=0,this.critical.y=0,this.attack.text=t.GameVars.names.MISS,this.typeAttack.text="",this.critical.text="";var s=t.GameVars.monstersActions[a.id];a.miss||(this.attack.text=s.name.toUpperCase(),e+=25,a.type===t.GameConstants.ATTACK_WEAK?(this.typeAttack.text=t.GameVars.names.WEAK,this.typeAttack.fill="#ec3359",this.typeAttack.y=e,e+=25):a.type===t.GameConstants.ATTACK_STRONG&&(this.typeAttack.text=t.GameVars.names.STRONG,this.typeAttack.fill="#94ff98",this.typeAttack.y=e,e+=25),a.critical&&(this.critical.text=t.GameVars.names.CRITICAL,this.critical.y=e,e+=25)),this.attackContainer.visible=!0,this.game.add.tween(this.attackContainer.scale).to({x:1,y:1},t.GameConstants.CHANGE_TIME,Phaser.Easing.Elastic.Out,!0).onComplete.add((function(){this.game.add.tween(this.attackContainer.scale).to({x:0,y:0},t.GameConstants.CHANGE_TIME,Phaser.Easing.Elastic.In,!0,3*t.GameConstants.CHANGE_TIME).onComplete.add((function(){this.attackContainer.visible=!1}),this)}),this)},e.prototype.showHack=function(){this.specialImg.frameName="hacked_text.png",this.specialBack.tint=57257,this.startTween()},e.prototype.showPoison=function(){this.specialImg.frameName="poisoned_text.png",this.specialBack.tint=12167423,this.startTween()},e.prototype.startTween=function(){this.game.add.tween(this.specialImg.scale).to({x:1,y:1},800,Phaser.Easing.Elastic.Out,!0).onComplete.add((function(){this.game.add.tween(this.specialImg.scale).to({x:1.05,y:1.05},1e3,Phaser.Easing.Linear.None,!0)}),this),this.game.add.tween(this.specialBack.scale).to({x:1,y:1},800,Phaser.Easing.Elastic.Out,!0,200).onComplete.add((function(){this.game.add.tween(this.specialBack.scale).to({x:.9,y:.9},1e3,Phaser.Easing.Linear.None,!0).onComplete.add((function(){this.game.add.tween(this.specialImg.scale).to({x:0,y:0},1e3,Phaser.Easing.Elastic.In,!0),this.game.add.tween(this.specialBack.scale).to({x:0,y:0},1e3,Phaser.Easing.Elastic.In,!0)}),this)}),this)},e.prototype.animationBackfired=function(a,e){this.hackContainer.visible=!0,this.hackBackground.scale.set(0),this.hackImg2.scale.set(0),e===t.GameConstants.PLAYER?this.hackContainer.x=100:this.hackContainer.x=t.GameConstants.GAME_WIDTH-150,this.hackImg.visible=!0,this.hackImg.frameName="hacked_text_01.png",this.game.time.events.add(250,(function(){this.hackImg.frameName="hacked_text_02.png",t.AudioManager.playSound("checking_hack_status")}),this),this.game.time.events.add(500,(function(){this.hackImg.frameName="hacked_text_01.png"}),this),this.game.time.events.add(750,(function(){this.hackImg.frameName="hacked_text_02.png",t.AudioManager.playSound("checking_hack_status")}),this),this.game.time.events.add(1e3,(function(){this.hackImg.frameName="hacked_text_01.png"}),this),this.game.time.events.add(1250,(function(){t.AudioManager.playSound("checking_hack_status"),a.backfired?(this.hackImg.frameName="hacked_text_true.png",this.game.add.tween(this.hackBackground.scale).to({x:1,y:1},500,Phaser.Easing.Elastic.Out,!0,500).onComplete.add((function(){e===t.GameConstants.PLAYER?t.FightState.currentInstance.playerAttackAnimation(a):t.FightState.currentInstance.adversaryAttackAnimation(a),this.game.add.tween(this.hackBackground.scale).to({x:0,y:0},500,Phaser.Easing.Elastic.In,!0,500).onComplete.add((function(){this.hackContainer.visible=!1}),this)}),this),this.game.add.tween(this.hackImg2.scale).to({x:1,y:1},500,Phaser.Easing.Elastic.Out,!0,500).onComplete.add((function(){this.game.add.tween(this.hackImg2.scale).to({x:0,y:0},500,Phaser.Easing.Elastic.In,!0,1e3)}),this)):(this.hackImg.frameName="hacked_text_false.png",this.game.time.events.add(1e3,(function(){this.hackContainer.visible=!1,e===t.GameConstants.PLAYER?t.FightState.currentInstance.playerAttackAnimation(a):t.FightState.currentInstance.adversaryAttackAnimation(a)}),this))}),this)},e}(Phaser.Group);t.AttackLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"hud")||this;return s.playerCapsule=new t.MonsterCapsule(s.game,!0,0,130),s.add(s.playerCapsule),s.adversaryCapsule=new t.MonsterCapsule(s.game,!1,-230,-220),s.add(s.adversaryCapsule),s.attackLayer=new t.AttackLayer(s.game),s.attackLayer.x=-215,s.attackLayer.y=-100,s.add(s.attackLayer),t.GameVars.typeFight===t.GameConstants.TRAINER_FIGHT&&(s.trainerLayer=new t.TrainerLayer(s.game),s.add(s.trainerLayer)),s}return __extends(e,a),e.prototype.updateLife=function(a){a===t.GameConstants.PLAYER?this.playerCapsule.updateLife():this.adversaryCapsule.updateLife()},e.prototype.animationCatch=function(){this.playerCapsule.retireMonster(),this.adversaryCapsule.retireMonster()},e.prototype.animationReturnToFight=function(){this.playerCapsule.showMonster(),this.adversaryCapsule.showMonster()},e.prototype.showSpecialAction=function(a,e,s,n){e===t.GameConstants.PLAYER?this.playerCapsule.showSpecialAction(a,s,n):this.adversaryCapsule.showSpecialAction(a,s,n)},e.prototype.showMonsterStates=function(t,a){this.playerCapsule.showMonsterStates(),this.adversaryCapsule.showMonsterStates(),t?this.attackLayer.showHack():a&&this.attackLayer.showPoison()},e.prototype.newAttack=function(t,a){this.attackLayer.show(t),this.updateLife(a)},e.prototype.changePlayerMonster=function(){this.playerCapsule.changeMonster()},e.prototype.changeAdversaryMonster=function(){this.adversaryCapsule.changeMonster(),t.GameVars.typeFight===t.GameConstants.TRAINER_FIGHT&&this.trainerLayer.updateMonsters()},e.prototype.retireAdversaryMonster=function(){this.adversaryCapsule.retireMonster(),t.GameVars.typeFight===t.GameConstants.TRAINER_FIGHT&&this.trainerLayer.updateMonsters()},e.prototype.animationBackfired=function(t,a){this.attackLayer.animationBackfired(t,a)},e}(Phaser.Group);t.FightHUD=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i){var o=a.call(this,e,null,"monster-capsule")||this;if(o.x=n,o.y=i,o.updatingLife=!1,o.isPlayer=s,o.xIn=o.x,o.xOut=o.isPlayer?o.x+300:o.x-300,o.monsterData=o.isPlayer?t.GameVars.playerMonstersFighting[0]:t.GameVars.adversaryMonstersFighting[0],!o.isPlayer||t.GameVars.playerMonstersFighting[0]){var r="monster-capsule-"+o.monsterData.class+".png";o.capsuleBackground=new Phaser.Image(o.game,0,0,"texture_atlas_1",r),o.add(o.capsuleBackground),o.levelText=new Phaser.Text(o.game,142,58,t.GameVars.names.LV,{font:"15px Exo Light",fill:"#000000",align:"center"}),o.levelText.anchor.set(1),o.add(o.levelText),o.levelLabel=new Phaser.Text(o.game,145,59,""+o.monsterData.level,{font:"15px Chewy",fill:"#000000",fontWeight:600,align:"center"}),o.levelLabel.anchor.set(0,1),o.add(o.levelLabel),o.monsterNameLabel=new Phaser.Text(o.game,20,15,o.monsterData.name,{font:"20px Goonies",fill:"#FFFFFF",align:"center"}),o.add(o.monsterNameLabel),o.specialActionCapsule=new t.SpecialActionCapsule(o.game,20,0),o.specialActionCapsule.y=o.isPlayer?-40:110,o.add(o.specialActionCapsule),o.typeNames(),o.addLifeBar()}return o.states=new Array,o.showMonsterStates(),o}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this),this.updatingLife},e.prototype.showMonsterStates=function(){if(this.monsterData){for(var t=0;t<this.states.length;t++)this.states[t].destroy();var a;if(this.states=new Array,this.monsterData.hypno)(a=new Phaser.Image(this.game,0,-15,"texture_atlas_1","icon_hack.png")).scale.set(.75),a.anchor.set(.5),this.add(a),this.states.push(a);if(this.monsterData.poison)(a=new Phaser.Image(this.game,0,-15,"texture_atlas_1","icon_poison.png")).scale.set(.75),a.anchor.set(.5),this.add(a),this.states.push(a);if(this.monsterData.rage)(a=new Phaser.Image(this.game,0,-15,"texture_atlas_1","icon_rage.png")).scale.set(.75),a.anchor.set(.5),this.add(a),this.states.push(a);for(t=0;t<this.states.length;t++)this.states[t].x=100-(this.states.length-1)/2*40+40*t}},e.prototype.showSpecialAction=function(t,a,e){this.specialActionCapsule.show(t,a,e)},e.prototype.changeMonster=function(){this.game.add.tween(this).to({x:this.xOut},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){this.monsterData=this.isPlayer?t.GameVars.playerMonstersFighting[0]:t.GameVars.adversaryMonstersFighting[0];var a="monster-capsule-"+this.monsterData.class+".png";this.capsuleBackground.frameName=a,this.monsterNameLabel.text=this.monsterData.name,this.levelLabel.text=""+this.monsterData.level,this.changeLifeBar(),this.typeNames(),this.showMonsterStates(),this.game.add.tween(this).to({x:this.xIn},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0,t.GameConstants.CHANGE_TIME+200)}),this)},e.prototype.retireMonster=function(){this.game.add.tween(this).to({x:this.xOut},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0)},e.prototype.showMonster=function(){this.game.add.tween(this).to({x:this.xIn},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0)},e.prototype.updateLife=function(){this.game.time.events.add(t.GameConstants.CHANGE_TIME,(function(){this.updateLifeBar()}),this)},e.prototype.changeLifeBar=function(){Math.round(this.monsterData.life/this.monsterData.maxLife*100);var t=this.monsterData.life/this.monsterData.maxLife*e.LIFE_BAR_LENGTH;this.lifeBar.scale.x=t/64,this.lifeBar2.scale.x=t/64},e.prototype.updateLifeBar=function(){Math.round(this.monsterData.life/this.monsterData.maxLife*100);var a=this.monsterData.life/this.monsterData.maxLife*e.LIFE_BAR_LENGTH;this.updatingLife=!0,this.game.add.tween(this.lifeBar.scale).to({x:a/64},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0,t.GameConstants.CHANGE_TIME).onComplete.add((function(){this.updatingLife=!1}),this),this.game.add.tween(this.lifeBar2.scale).to({x:a/64},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0,t.GameConstants.CHANGE_TIME)},e.prototype.addLifeBar=function(){this.lifeBarContainer=new Phaser.Group(this.game),this.add(this.lifeBarContainer);var a,s=new Phaser.Sprite(this.game,10,70,this.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));s.scale.set((e.LIFE_BAR_LENGTH+6)/64,10/64),s.tint=1136974,this.lifeBarContainer.add(s),a=this.monsterData?this.monsterData.life/this.monsterData.maxLife*e.LIFE_BAR_LENGTH:e.LIFE_BAR_LENGTH,this.lifeBarBack=new Phaser.Sprite(this.game,12,72,this.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),this.lifeBarBack.scale.set(e.LIFE_BAR_LENGTH/64,6/64),this.lifeBarBack.tint=161120,this.lifeBarContainer.add(this.lifeBarBack),this.lifeBar=new Phaser.Sprite(this.game,12,72,this.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),this.lifeBar.scale.set(a/64,3/64),this.lifeBar.tint=9043853,this.lifeBarContainer.add(this.lifeBar),this.lifeBar2=new Phaser.Sprite(this.game,12,75,this.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),this.lifeBar2.scale.set(a/64,3/64),this.lifeBar2.tint=4114513,this.lifeBarContainer.add(this.lifeBar2);var n=new Phaser.Image(this.game,200,66,"texture_atlas_1","icon_life_bar.png");n.scale.set(1.3),this.lifeBarContainer.add(n)},e.prototype.setBarColor=function(t){return t>e.ORANGE_BAR_PERCENTAGE||e.RED_BAR_PERCENTAGE,4114513},e.prototype.setBarBackColor=function(t){return t>e.ORANGE_BAR_PERCENTAGE||e.RED_BAR_PERCENTAGE,161120},e.prototype.typeNames=function(){this.monsterData.class===t.GameConstants.ELEMENT_CLASSIC?(this.monsterNameLabel.font="Pythia",this.monsterNameLabel.fontSize="18px",this.monsterNameLabel.fill="#5b473c",this.levelLabel.fill="#5b473c",this.levelText.fill="#5b473c"):this.monsterData.class===t.GameConstants.ELEMENT_SPECTRE?(this.monsterNameLabel.font="Goonies",this.monsterNameLabel.fontSize="18px",this.monsterNameLabel.fill="#2a3147",this.levelLabel.fill="#2a3147",this.levelText.fill="#2a3147"):this.monsterData.class===t.GameConstants.ELEMENT_TECH&&(this.monsterNameLabel.font="Adineue",this.monsterNameLabel.fontSize="23px",this.monsterNameLabel.fill="#ffffff",this.levelLabel.fill="#ffffff",this.levelText.fill="#ffffff")},e.LIFE_BAR_LENGTH=195,e.ORANGE_BAR_PERCENTAGE=50,e.RED_BAR_PERCENTAGE=25,e}(Phaser.Group);t.MonsterCapsule=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(s,n,i){var o=a.call(this,s,null,"special-action-capsule")||this;o.x=n,o.y=i,o.nameLabel=new Phaser.Text(o.game,0,-5,t.GameVars.names.SPECIAL,{font:"18px Chewy",fill:"#FFFFFF"}),o.add(o.nameLabel);var r=new Phaser.Sprite(o.game,0,20,o.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));r.scale.set((e.LIFE_BAR_LENGTH+6)/64,10/64),r.tint=1136974,o.add(r);var m=new Phaser.Sprite(o.game,2,22,o.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));return m.scale.set(e.LIFE_BAR_LENGTH/64,6/64),m.tint=161120,o.add(m),o.specialBar=new Phaser.Sprite(o.game,2,22,o.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),o.specialBar.scale.set(e.LIFE_BAR_LENGTH/64,3/64),o.specialBar.tint=9043853,o.add(o.specialBar),o.specialBar2=new Phaser.Sprite(o.game,2,25,o.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),o.specialBar2.scale.set(e.LIFE_BAR_LENGTH/64,3/64),o.specialBar2.tint=4114513,o.add(o.specialBar2),o.visible=!1,o.alpha=0,o}return __extends(e,a),e.prototype.show=function(a,s,n){var i=0;a===t.GameConstants.SPECIAL_ATTACK?i=t.GameConstants.MAX_ATTACK:a===t.GameConstants.SPECIAL_DEFENSE?i=t.GameConstants.MAX_DEFENSE:a===t.GameConstants.SPECIAL_AIM&&(i=t.GameConstants.MAX_AIM),this.nameLabel.text=a.toUpperCase(),this.specialBar.scale.x=s*e.LIFE_BAR_LENGTH/i/64,this.specialBar2.scale.x=s*e.LIFE_BAR_LENGTH/i/64,this.game.time.events.add(5*t.GameConstants.CHANGE_TIME,(function(){this.visible=!0,this.game.add.tween(this).to({alpha:1},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.specialBar.scale).to({x:n*e.LIFE_BAR_LENGTH/i/64},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0,t.GameConstants.CHANGE_TIME).onComplete.add((function(){this.hide()}),this),this.game.add.tween(this.specialBar2.scale).to({x:n*e.LIFE_BAR_LENGTH/i/64},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0,t.GameConstants.CHANGE_TIME)}),this)},e.prototype.hide=function(){this.game.add.tween(this).to({alpha:0},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0,t.GameConstants.CHANGE_TIME).onComplete.add((function(){this.visible=!1}),this)},e.LIFE_BAR_LENGTH=150,e}(Phaser.Group);t.SpecialActionCapsule=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"trainer-layer")||this;s.x=-t.GameConstants.GAME_WIDTH/2,s.y=-t.GameConstants.GAME_HEIGHT/2/t.GameVars.scaleY,s.avatar=new Phaser.Image(s.game,200,18,"texture_atlas_1","adversary_avatar_000.png"),s.avatar.scale.set(.6),s.add(s.avatar),s.trainerName=new Phaser.Text(s.game,10,10,"Alumno Demo",{font:"20px Chewy",fontWeight:"400",fill:"#FFFFFF"}),s.add(s.trainerName),t.GameVars.currentTrainer&&(s.avatar.frameName="adversary_avatar_"+t.GameVars.currentTrainer.id+".png",s.trainerName.text=t.GameVars.trainersNames[t.GameVars.currentTrainer.id]),s.monsters=new Array;for(var n=0;n<t.GameVars.adversaryMonstersFighting.length;n++){var i=new Phaser.Image(s.game,10+40*n,40,"texture_atlas_4","icon_"+t.GameVars.adversaryMonstersFighting[n].id+".png");i.scale.set(.5),s.add(i),s.monsters.push(i)}return s}return __extends(e,a),e.prototype.updateMonsters=function(){for(var a=0,e=0;e<this.monsters.length;e++)0===t.GameVars.adversaryMonstersFighting[e].life&&a++;for(e=0;e<a;e++)this.monsters[e].alpha=.5},e}(Phaser.Group);t.TrainerLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i,o,r,m){var h=a.call(this,e,null,"icon")||this;if(h.managementLayer=r,h.monsterData=s,h.x=n,h.y=i,h.initialX=n,h.initialY=i,h.pos=o,h.captured=m,h.canMove=!1,h.canDown=!0,m){var l=new Phaser.Image(h.game,0,0,"texture_atlas_1","fx_radial_rays.png");l.anchor.set(.5),l.scale.set(.6),h.add(l),s.class===t.GameConstants.ELEMENT_CLASSIC?l.tint=16751696:s.class===t.GameConstants.ELEMENT_SPECTRE?l.tint=12167423:s.class===t.GameConstants.ELEMENT_TECH&&(l.tint=57257)}if(s){var c=new Phaser.Image(h.game,0,0,"texture_atlas_4","icon_"+s.id+".png");c.inputEnabled=!0,c.events.onInputDown.add(h.onDown,h),c.events.onInputUp.add(h.onUp,h),c.anchor.set(.5),h.add(c);var d=new Phaser.Text(h.game,-33,-34,s.level+"",{font:"22px Chewy",fontWeight:"400",fill:"#000000"});d.stroke="#11252c",d.strokeThickness=5,h.add(d),s.class===t.GameConstants.ELEMENT_CLASSIC?d.fill="#ff9c50":s.class===t.GameConstants.ELEMENT_SPECTRE?d.fill="#b9a8ff":s.class===t.GameConstants.ELEMENT_TECH&&(d.fill="#00dfa9")}return h}return __extends(e,a),e.prototype.update=function(){if(a.prototype.update.call(this),this.canMove){var e=this.game.input.activePointer;this.x=e.x-t.GameConstants.GAME_WIDTH/2,this.y=(e.y-t.GameConstants.GAME_HEIGHT/2)/t.GameVars.scaleY,this.managementLayer.checkIntersection(this)}},e.prototype.moveInitial=function(){this.canDown=!1;var t=Math.sqrt(Math.pow(this.x-this.initialX,2)+Math.pow(this.y-this.initialY,2));this.game.add.tween(this).to({x:this.initialX,y:this.initialY},t,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){this.canDown=!0}),this)},e.prototype.onDown=function(){this.canDown&&(t.GameVars.slotData.state<=t.GameConstants.TUTORIAL_CAPTURE&&6!==this.pos||(this.canMove=!0,this.managementLayer.midContainer.bringToTop(this)))},e.prototype.onUp=function(){this.canDown&&this.canMove&&(t.GameVars.slotData.state<=t.GameConstants.TUTORIAL_CAPTURE&&6!==this.pos||(this.canMove=!1,this.managementLayer.canChange(this),this.managementLayer.hideSlots()))},e}(Phaser.Group);t.Icon=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(s){var n=a.call(this,s,null,"management-layer")||this;if(n.wisp=0,n.previousWisp=0,n.updateWisp=!1,n.title=new Phaser.Text(n.game,t.GameConstants.GAME_WIDTH/2+30,10,t.GameVars.names["FULL MAGIC WAND"],{font:"30px Chewy",fontWeight:"200",fill:"#f9205d",align:"center"}),n.title.stroke="#be0539",n.title.strokeThickness=5,n.title.anchor.set(.5,0),n.title.scale.y=t.GameVars.scaleY,n.add(n.title),n.titleImage=new Phaser.Image(n.game,n.title.x-n.title.width/2-30,10,"texture_atlas_1","icon_attention.png"),n.titleImage.anchor.set(.5,0),n.titleImage.scale.y=t.GameVars.scaleY,n.add(n.titleImage),n.midContainer=new Phaser.Group(n.game),n.midContainer.x=t.GameConstants.GAME_WIDTH/2,n.midContainer.y=t.GameConstants.GAME_HEIGHT/2,n.midContainer.scale.y=t.GameVars.scaleY,n.fxCaptured=new Phaser.Image(n.game,e.POSITIONS[6][0],e.POSITIONS[6][1]+30-50,"texture_atlas_2","fx_captured_01.png"),n.fxCaptured.anchor.set(.5),n.midContainer.add(n.fxCaptured),n.fxCaptured.animations.add("anim",Phaser.Animation.generateFrameNames("fx_captured_",1,12,".png",2)),n.signContainer=new Phaser.Group(n.game),n.signContainer.x=e.POSITIONS[6][0],n.signContainer.y=e.POSITIONS[6][1]+30,n.signContainer.scale.y=.35,n.signContainer.visible=!1,n.midContainer.add(n.signContainer),t.GameVars.playerMonstersFighting[0]){var i="current_mkm_"+t.GameVars.playerMonstersFighting[0].class+".png";n.sign=new Phaser.Image(n.game,0,0,"texture_atlas_2",i),n.sign.anchor.set(.5),n.sign.scale.set(.6),n.signContainer.add(n.sign),n.game.add.tween(n.sign).to({angle:360},3e4,Phaser.Easing.Linear.None,!0,0,-1)}n.slots=new Array;for(var o=0;o<6;o++){var r=new Phaser.Image(n.game,e.POSITIONS[o][0],e.POSITIONS[o][1],"texture_atlas_1","slot_empty.png");r.anchor.set(.5),n.midContainer.add(r),n.slots.push(r)}n.icons=new Array;for(o=0;o<6;o++){var m=void 0;m=t.GameVars.slotData.monsters[o]?new t.Icon(n.game,t.GameVars.slotData.monsters[o],e.POSITIONS[o][0],e.POSITIONS[o][1],o,n,!1):new t.Icon(n.game,null,e.POSITIONS[o][0],e.POSITIONS[o][1],o,n,!1),n.midContainer.add(m),n.icons.push(m)}n.arrow=new Phaser.Image(n.game,t.GameConstants.GAME_WIDTH/2-190,160,"texture_atlas_1","arrow.png"),n.arrow.anchor.set(1,0),n.arrow.visible=!1,n.midContainer.add(n.arrow),n.releasedText=new Phaser.Text(n.game,t.GameConstants.GAME_WIDTH/2-100,170,"",{font:"18px Chewy",fill:"#ffffff",align:"center"}),n.releasedText.anchor.set(.5,1),n.releasedText.wordWrap=!0,n.releasedText.wordWrapWidth=200,n.midContainer.add(n.releasedText),n.okButton=new Phaser.Button(n.game,t.GameConstants.GAME_WIDTH/2-100,240,"texture_atlas_"+t.GameVars.gameData.language,n.onOkDown,n),n.okButton.setFrames("btn_ok_wisps_over.png","btn_ok_wisps.png","btn_ok_wisps_over.png"),n.okButton.events.onInputDown.add(n.onButtonDown,n),n.okButton.anchor.set(.5),n.okButton.y-=n.okButton.height/2,n.okButton.visible=!1,n.midContainer.add(n.okButton),n.earnedWisp=new Phaser.Text(n.game,t.GameConstants.GAME_WIDTH/2-93,213,"",{font:"20px Chewy",fill:"#ffffff",align:"center"}),n.earnedWisp.anchor.set(.5),n.midContainer.add(n.earnedWisp),n.bottomContainer=new Phaser.Group(n.game),n.bottomContainer.y=t.GameConstants.GAME_HEIGHT,n.bottomContainer.scale.y=t.GameVars.scaleY,n.add(n.bottomContainer);var h=new Phaser.Group(n.game);n.bottomContainer.add(h);var l=new Phaser.Image(n.game,t.GameConstants.GAME_WIDTH-20,-10,"texture_atlas_1","tab_wisps.png");return l.anchor.set(1),h.add(l),n.wispText=new Phaser.Text(n.game,t.GameConstants.GAME_WIDTH-70,-33,t.Utils.validNumber(t.GameVars.slotData.wisp),{font:"24px Chewy",fontWeight:"400",fill:"#ffffff",align:"center"}),n.wispText.anchor.set(1,.5),h.add(n.wispText),n.add(n.midContainer),t.GameVars.slotData.state<=t.GameConstants.TUTORIAL_CAPTURE&&(n.fingerMkm=new Phaser.Image(n.game,-200,287,"texture_atlas_1","tutorial_finger.png"),n.fingerMkm.anchor.set(.5),n.fingerMkm.scale.x=-1,n.midContainer.add(n.fingerMkm)),n.visible=!1,n.alpha=0,n}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this),this.updateWisp&&(this.previousWisp<t.GameVars.slotData.wisp?(this.previousWisp+=this.wisp/10,this.previousWisp>t.GameVars.slotData.wisp&&(this.previousWisp=t.GameVars.slotData.wisp),this.wispText.text=t.Utils.validNumber(Math.round(this.previousWisp))):(this.updateWisp=!1,t.GameManager.manageNewMagikmons(this.icons)))},e.prototype.show=function(){this.visible=!0,this.game.add.tween(this).to({alpha:1},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.In,!0);var a=new t.Icon(this.game,t.GameVars.adversaryMonstersFighting[0],e.POSITIONS[6][0],e.POSITIONS[6][1],6,this,!0);a.y-=50,this.midContainer.add(a),this.icons.push(a),this.fxCaptured.play("anim",12,!0),this.game.add.tween(a).to({y:a.y+50},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.fxCaptured).to({y:this.fxCaptured.y+50},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.In,!0),this.showIcons(),this.checkShowButton(),this.changeEarnedWisp(),t.GameVars.slotData.state<=t.GameConstants.TUTORIAL_CAPTURE&&this.game.time.events.add(1e3,(function(){this.game.add.tween(this.fingerMkm).to({y:[-72,287]},2e3,Phaser.Easing.Cubic.In,!0,0,-1)}),this)},e.prototype.showIcons=function(){for(var a=0;a<6;a++){this.icons[a].alpha=0,this.slots[a].alpha=0;var e=5-a;e>3&&e--,this.game.add.tween(this.icons[a]).to({alpha:1},50,Phaser.Easing.Cubic.In,!0,100*e+t.GameConstants.CHANGE_TIME),this.game.add.tween(this.slots[a]).to({alpha:1},50,Phaser.Easing.Cubic.In,!0,100*e+t.GameConstants.CHANGE_TIME)}},e.prototype.checkShowButton=function(){this.releasedText.text="";for(var a=[],e=0;e<this.icons.length;e++)this.icons[e].monsterData||a.push(this.icons[e].pos);if(a.length>1&&-1===a.indexOf(6))this.hideButton();else if(1===a.length&&6!==a[0])this.hideButton();else{for(e=0;e<this.icons.length;e++)if(6===this.icons[e].pos){this.icons[e].monsterData?this.showReleasedText():this.okButton.setFrames("btn_ready_over.png","btn_ready.png","btn_ready_over.png");break}this.showButton()}a.length>0&&(this.title.text=t.GameVars.names["CHOOSE SLOT"],this.title.x=t.GameConstants.GAME_WIDTH/2,this.title.fill="#D9FCFF",this.title.stroke="#007DB5",this.title.fontSize="25px",this.titleImage.visible=!1)},e.prototype.showReleasedText=function(){this.releasedText.text=t.GameVars.names["UNSELECTED MAGIKMON"],this.arrow.visible=!0},e.prototype.showButton=function(){this.okButton.visible=!0},e.prototype.hideButton=function(){this.okButton.visible=!1},e.prototype.checkIntersection=function(a){this.hideSlots();for(var e=0;e<this.icons.length;e++)if(a!==this.icons[e]){var s=this.icons[e];if(t.Utils.intersectRect(a.x,a.y,s.x,s.y,30))return void(s.pos<6&&(this.slots[s.pos].frameName="slot_swap.png"))}a.pos<6&&(this.slots[a.pos].frameName="slot_swap.png")},e.prototype.canChange=function(a){for(var e=0;e<this.icons.length;e++)if(a!==this.icons[e]){var s=this.icons[e];if(t.Utils.intersectRect(a.x,a.y,s.x,s.y,30)){if(6===s.pos&&(!s.monsterData||this.anyEmptySlot()))continue;if(t.GameVars.slotData.state<=t.GameConstants.TUTORIAL_CAPTURE&&1!==s.pos)break;return void this.swapIcons(a,s)}}a.moveInitial(),this.slotsToTop(a)},e.prototype.anyEmptySlot=function(){for(var t=0;t<this.icons.length;t++)if(!this.icons[t].monsterData)return!0;return!1},e.prototype.hideSlots=function(){for(var t=0;t<this.slots.length;t++)this.slots[t].frameName="slot_empty.png"},e.prototype.onOkDown=function(){this.okButton.scale.set(1),0===this.wisp?t.GameManager.manageNewMagikmons(this.icons):(this.previousWisp=t.GameVars.slotData.wisp,t.GameVars.slotData.wisp+=this.wisp,this.updateWisp=!0,this.okButton.visible=!1,this.earnedWisp.visible=!1),t.GameVars.currentSpawn&&(t.GameVars.currentSpawn.solvable&&t.MapManager.deleteSpawn(t.GameVars.currentSpawn),t.GameVars.currentSpawn=null)},e.prototype.swapIcons=function(t,a){var e;if(this.fingerMkm&&(this.fingerMkm.visible=!1),this.slotsToTop(t),6===t.pos)for(var s=0;s<6;s++)if(!this.icons[s].monsterData){e=this.icons[s];break}if(e){var n=t.initialX,i=t.initialY;t.initialX=a.initialX,t.initialY=a.initialY,a.initialX=e.initialX,a.initialY=e.initialY,e.initialX=n,e.initialY=i;var o=t.pos;t.pos=a.pos,a.pos=e.pos,e.pos=o}else{n=t.initialX,i=t.initialY;t.initialX=a.initialX,t.initialY=a.initialY,a.initialX=n,a.initialY=i;o=t.pos;t.pos=a.pos,a.pos=o}this.midContainer.bringToTop(t),this.midContainer.bringToTop(a),t.moveInitial(),a.moveInitial(),e&&e.moveInitial(),this.changeSignClass(),this.changeEarnedWisp(),this.checkShowButton()},e.prototype.changeEarnedWisp=function(){for(var t=-1,a=0;a<this.icons.length;a++)if(6===this.icons[a].pos){if(!this.icons[a].monsterData)break;t=a}else if(!this.icons[a].monsterData)break;-1!==t?(this.wisp=Math.round(1.5*(this.icons[t].monsterData.level+25)),this.earnedWisp.text="+ "+this.wisp):(this.wisp=0,this.earnedWisp.text="")},e.prototype.changeSignClass=function(){for(var t=0;t<this.icons.length;t++)if(6===this.icons[t].pos)if(this.icons[t].captured)this.fxCaptured.visible=!0,this.signContainer.visible=!1;else if(this.icons[t].monsterData){this.fxCaptured.visible=!1,this.signContainer.visible=!0;var a="current_mkm_"+this.icons[t].monsterData.class+".png";this.sign.frameName=a}else this.fxCaptured.visible=!1,this.signContainer.visible=!1},e.prototype.slotsToTop=function(t){for(var a=0;a<this.slots.length;a++)this.midContainer.bringToTop(this.slots[a])},e.prototype.onButtonDown=function(t){t.scale.set(1.1)},e.POSITIONS=[[-82,-203],[-124,-122],[-41,-122],[-82,-33],[-82,47],[-82,127],[-80,237]],e}(Phaser.Group);t.ManagementLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(t,e){var s=a.call(this,t,null,"animations-container")||this;return s.y=30,s.fxs=new Array,s.front=e,s}return __extends(e,a),e.prototype.newAction=function(a,e){this.counter=0,this.action=a;for(var s=0;s<this.fxs.length;s++)this.remove(this.fxs[s]);if(this.fxs=new Array,a.fx)for(s=0;s<a.fx.length;s++){var n={x:t.GameConstants.X_IN_PLAYER,y:t.GameConstants.Y_PLAYER};(a.adversary[s]&&t.GameVars.turn===t.GameConstants.PLAYER||!a.adversary[s]&&t.GameVars.turn===t.GameConstants.ADVERSARY)&&(n={x:t.GameConstants.X_IN_ADVERSARY,y:t.GameConstants.Y_ADVERSARY}),e&&a.adversary[s]&&(n=t.GameVars.turn===t.GameConstants.PLAYER?{x:t.GameConstants.X_IN_PLAYER,y:t.GameConstants.Y_PLAYER}:{x:t.GameConstants.X_IN_ADVERSARY,y:t.GameConstants.Y_ADVERSARY});var i=new Phaser.Image(this.game,n.x,n.y,"texture_atlas_3",a.fx[s]+"_01.png");i.anchor.set(.5,1),i.alpha=0,this.add(i),this.fxs.push(i),t.GameVars.turn===t.GameConstants.ADVERSARY&&(i.scale.x=-1),i.animations.add("anim",Phaser.Animation.generateFrameNames(a.fx[s]+"_",1,a.frames[s],".png",2))}},e.prototype.update=function(){a.prototype.update.call(this);for(var e=0;e<this.fxs.length;e++)(this.front&&this.action.front[e]||!this.front&&!this.action.front[e])&&Math.round(60*this.action.delay[e]/24)===this.counter&&(this.fxs[e].alpha=1,this.fxs[e].play("anim",24,!1,!0),t.AudioManager.playSound(this.action.fx[e]));this.counter++},e}(Phaser.Group);t.AnimationsContainer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s){var n=a.call(this,e,null,"monster")||this;if(n.isPlayer=s,n.x=n.isPlayer?t.GameConstants.X_IN_PLAYER:t.GameConstants.X_IN_ADVERSARY,n.y=n.isPlayer?t.GameConstants.Y_PLAYER:t.GameConstants.Y_ADVERSARY,n.xIn=n.x,n.xOut=n.isPlayer?t.GameConstants.X_OUT_PLAYER:t.GameConstants.X_OUT_ADVERSARY,n.monsterData=n.isPlayer?t.GameVars.playerMonstersFighting[0]:t.GameVars.adversaryMonstersFighting[0],t.GameVars.playerMonstersFighting[0]||!n.isPlayer){var i="mkm_"+(n.isPlayer?t.GameVars.playerMonstersFighting[0].id:t.GameVars.adversaryMonstersFighting[0].id)+"_";i+=n.isPlayer?"back.png":"front.png",n.monsterImage=new Phaser.Image(n.game,0,0,"texture_atlas_4",i),n.startTweenMonster()}else n.monsterImage=new Phaser.Image(n.game,0,0,"texture_atlas_1","hero_back.png");return n.monsterImage.anchor.set(.5,1),n.add(n.monsterImage),n.states=new Array,n.showMonsterStates(),n.addLifeBar(),n.updatingLife=!1,n}return __extends(e,a),e.prototype.update=function(){if(a.prototype.update.call(this),this.updatingLife){var t=this.lifeBar.scale.x/e.LIFE_BAR_LENGTH*64*100;this.lifeBar.tint=this.setBarColor(t),this.lifeBarBack.tint=this.setBarBackColor(t)}},e.prototype.startTweenMonster=function(){if(this.stopTweenMonster(),"015"===this.monsterData.id)this.tweenMonster=this.game.add.tween(this.monsterImage.scale).to({y:[.975,1],x:[1.05,1]},200*Math.random()+1e3,Phaser.Easing.Quadratic.Out,!0,0,-1);else if("001"===this.monsterData.id||"007"===this.monsterData.id||"010"===this.monsterData.id||"013"===this.monsterData.id){var t=500*Math.random()+1500;this.tweenMonster=this.game.add.tween(this.monsterImage).to({y:10},t,Phaser.Easing.Quadratic.InOut),this.tweenMonster2=this.game.add.tween(this.monsterImage).to({y:0},t,Phaser.Easing.Quadratic.InOut),this.tweenMonster.chain(this.tweenMonster2),this.tweenMonster2.chain(this.tweenMonster),this.tweenMonster.start()}else this.tweenMonster=this.game.add.tween(this.monsterImage.scale).to({y:[.975,1]},500*Math.random()+2500,Phaser.Easing.Quadratic.Out,!0,0,-1)},e.prototype.stopTweenMonster=function(){this.tweenMonster&&this.tweenMonster.stop(),this.tweenMonster2&&this.tweenMonster2.stop(),this.monsterImage.scale.set(1),this.monsterImage.y=0},e.prototype.changeFrameName=function(t){this.monsterImage.frameName=t,this.startTweenMonster()},e.prototype.showMonsterStates=function(){if(!this.isPlayer||t.GameVars.slotData.state!==t.GameConstants.TUTORIAL_ESCAPE){for(var a=0;a<this.states.length;a++)this.states[a].destroy();this.states=new Array;var e=this.isPlayer?t.GameVars.playerMonstersFighting[0]:t.GameVars.adversaryMonstersFighting[0];if(e.hypno){var s;(s=new Phaser.Sprite(this.game,0,0,"texture_atlas_4",this.monsterImage.frameName)).anchor.set(.5,1),s.alpha=.6,this.add(s),this.states.push(s);var n=new Phaser.Sprite(this.game,0,-this.monsterImage.height/2,"texture_atlas_1","glitch.png");n.anchor.set(.5),this.add(n),this.states.push(n),this.hackAnimation(s,n,2)}if(e.poison){var i=new Phaser.Sprite(this.game,0,-100,"texture_atlas_3","poisoned_01.png");i.anchor.set(.5,1),i.scale.set(.8),this.add(i),this.sendToBack(i),this.states.push(i);var o=i.animations.add("anim",Phaser.Animation.generateFrameNames("poisoned_",1,25,".png",2));o.onComplete.add((function(){i.visible=!1,this.game.time.events.add(1e3*Math.random()+1e3,(function(){this.monsterData.poison&&(i.visible=!0,i.play("anim",40))}),this)}),this),o.onStart.add((function(){t.AudioManager.playSound("fx_poisoned")}),this),i.play("anim",40)}if(e.rage)(s=new Phaser.Sprite(this.game,0,0,"texture_atlas_3","beam_tech_01.png")).anchor.set(.5,1),this.add(s),this.states.push(s),s.animations.add("anim",Phaser.Animation.generateFrameNames("beam_tech_",1,5,".png",2)),s.play("anim",16,!0)}},e.prototype.hackAnimation=function(a,e,s){this.monsterData.hypno&&(Math.random()<.25?t.AudioManager.playSound("fx_hacked_01"):Math.random()<.5?t.AudioManager.playSound("fx_hacked_02"):Math.random()<.75?t.AudioManager.playSound("fx_hacked_03"):t.AudioManager.playSound("fx_hacked_04"),a.visible=!0,e.visible=!0,a.x=40*Math.random()-20,e.x=160*Math.random()-80,e.y=80*Math.random()-40-this.monsterImage.height/2,5*Math.random()<2?e.visible=!0:e.visible=!1,this.game.time.events.add(50,(function(){a.x=20*Math.random()-10,a.y=20*Math.random()-10,this.game.time.events.add(50,(function(){a.x=40*Math.random()-20,e.x=160*Math.random()-80,e.y=80*Math.random()-40-this.monsterImage.height/2,5*Math.random()<2?e.visible=!0:e.visible=!1,this.game.time.events.add(50,(function(){if(a.visible=!1,e.visible=!1,0===s){var t=2200*Math.random()+800;this.game.time.events.add(t,(function(){this.hackAnimation(a,e,Math.floor(3*Math.random()))}),this)}else s--,this.game.time.events.add(200,(function(){this.hackAnimation(a,e,s)}),this)}),this)}),this)}),this))},e.prototype.poisonAnimation=function(){this.game.time.events.add(750,(function(){var a=new Phaser.Sprite(this.game,0,-50,"texture_atlas_3","poisoned_01.png");a.anchor.set(.5,1),this.add(a),a.animations.add("anim",Phaser.Animation.generateFrameNames("poisoned_",1,25,".png",2)),a.play("anim",24,!1,!0);var e=t.Utils.shakeArray(30,3);this.game.add.tween(this.monsterImage).to({x:e},500,Phaser.Easing.Cubic.Out,!0)}),this)},e.prototype.changeMonster=function(){this.x===this.xIn?this.isPlayer?this.game.add.tween(this).to({x:this.xOut},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0).onComplete.add(this.nextMonster,this):(this.removeStates(),this.game.add.tween(this.monsterImage).to({alpha:0},1e3,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.monsterImage.scale).to({x:1.1,y:1.1},1e3,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){this.monsterImage.scale.set(1),this.monsterImage.alpha=1,this.y=this.isPlayer?t.GameConstants.Y_PLAYER:t.GameConstants.Y_ADVERSARY,this.x=this.xOut,this.nextMonster()}),this)):this.x===this.xOut&&this.nextMonster()},e.prototype.retireMonster=function(){this.removeStates();this.y;this.game.add.tween(this.monsterImage).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.monsterImage.scale).to({x:1.1,y:1.1},1e3,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){this.monsterImage.scale.set(1),this.monsterImage.alpha=1,this.y=this.isPlayer?t.GameConstants.Y_PLAYER:t.GameConstants.Y_ADVERSARY,this.x=this.xOut}),this)},e.prototype.showSmoke=function(){var t=new Phaser.Image(this.game,0,200,"texture_atlas_3","smoke_generic_01.png");t.anchor.set(.5,1),t.scale.set(2.5),this.add(t),t.animations.add("anim",Phaser.Animation.generateFrameNames("smoke_generic_",1,21,".png",2)),t.play("anim",16,!1,!0)},e.prototype.showCatchAnimation=function(){this.showSmoke();var t=new Phaser.Image(this.game,0,40,"texture_atlas_3","flash_generic_01.png");t.anchor.set(.5,1),this.add(t),t.animations.add("anim",Phaser.Animation.generateFrameNames("flash_generic_",1,9,".png",2)),t.play("anim",16,!1,!0);var a=new Phaser.Image(this.game,0,40,"texture_atlas_3","dazzle_generic_01.png");a.anchor.set(.5,1),this.add(a),a.animations.add("anim",Phaser.Animation.generateFrameNames("dazzle_generic_",1,20,".png",2)),a.play("anim",16,!1,!0)},e.prototype.monsterToIcon=function(){this.stopTweenMonster(),this.monsterImage.frameName="icon_"+this.monsterData.id+".png",this.monsterImage.y-=90,this.lifeBarContainer.visible=!1,this.game.add.tween(this.monsterImage).to({y:this.monsterImage.y+90},2*t.GameConstants.CHANGE_TIME,Phaser.Easing.Bounce.Out,!0,t.GameConstants.CHANGE_TIME)},e.prototype.removeStates=function(){for(var t=0;t<this.states.length;t++)this.states[t].alpha=0},e.prototype.showStates=function(){for(var t=0;t<this.states.length;t++)this.states[t].alpha=1,this.states[t].frameName===this.monsterImage.frameName&&(this.states[t].alpha=.5)},e.prototype.iconToMonster=function(){this.monsterImage.frameName="mkm_"+this.monsterData.id+"_back.png",this.lifeBarContainer.visible=!0,this.startTweenMonster()},e.prototype.nextMonster=function(){this.monsterData=this.isPlayer?t.GameVars.playerMonstersFighting[0]:t.GameVars.adversaryMonstersFighting[0];var a="mkm_"+(this.isPlayer?t.GameVars.playerMonstersFighting[0].id:t.GameVars.adversaryMonstersFighting[0].id)+"_";a+=this.isPlayer?"back.png":"front.png",this.changeFrameName(a),this.showMonsterStates(),this.game.add.tween(this).to({x:this.xIn},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0)},e.prototype.deadMonster=function(){this.removeStates(),this.game.add.tween(this.monsterImage).to({alpha:0},250,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.monsterImage.scale).to({x:1.1,y:1.1},250,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){this.monsterImage.scale.set(1),this.monsterImage.alpha=1,this.y=this.isPlayer?t.GameConstants.Y_PLAYER:t.GameConstants.Y_ADVERSARY,this.x=this.xOut}),this)},e.prototype.updateLife=function(){this.game.time.events.add(t.GameConstants.CHANGE_TIME,(function(){this.updateLifeBar()}),this)},e.prototype.changeLifeBar=function(){var t=Math.round(this.monsterData.life/this.monsterData.maxLife*100),a=this.monsterData.life/this.monsterData.maxLife*e.LIFE_BAR_LENGTH;this.lifeBar.scale.x=a/64,this.lifeBar.tint=this.setBarColor(t),this.lifeBarBack.tint=this.setBarBackColor(t)},e.prototype.updateLifeBar=function(){Math.round(this.monsterData.life/this.monsterData.maxLife*100);var a=this.monsterData.life/this.monsterData.maxLife*e.LIFE_BAR_LENGTH;this.updatingLife=!0,this.game.add.tween(this.lifeBar.scale).to({x:a/64},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0,t.GameConstants.CHANGE_TIME).onComplete.add((function(){this.updatingLife=!1}),this)},e.prototype.setBarColor=function(t){return t>e.ORANGE_BAR_PERCENTAGE||e.RED_BAR_PERCENTAGE,4114513},e.prototype.setBarBackColor=function(t){return t>e.ORANGE_BAR_PERCENTAGE||e.RED_BAR_PERCENTAGE,161120},e.prototype.addLifeBar=function(){this.lifeBarContainer=new Phaser.Group(this.game),this.add(this.lifeBarContainer)},e.LIFE_BAR_LENGTH=180,e.ORANGE_BAR_PERCENTAGE=50,e.RED_BAR_PERCENTAGE=25,e}(Phaser.Group);t.Monster=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"monsters-container")||this;s.animationsContainer1=new t.AnimationsContainer(s.game,!1),s.add(s.animationsContainer1);var n,i,o=new Spriter.SpriterXml(s.game.cache.getXML("capture"),{imageNameType:Spriter.eImageNameType.ORIGINAL}),r=(new Spriter.Loader).load(o);if(s.trainerSpriter=new Spriter.SpriterGroup(s.game,r,"texture_atlas_1","entity_000",0,4),s.add(s.trainerSpriter),s.trainerSpriter.setAnimationSpeedPercent(4),s.trainerSpriter.playAnimationByName("idle_01"),s.trainerSpriter.onLoop.add(s.onAnimationLoopFinished,s),s.adversary=new t.Monster(s.game,!1),s.add(s.adversary),s.player=new t.Monster(s.game,!0),s.add(s.player),s.animationsContainer2=new t.AnimationsContainer(s.game,!0),s.add(s.animationsContainer2),s.trainer=new Phaser.Image(s.game,t.GameConstants.X_OUT_PLAYER,t.GameConstants.Y_PLAYER,"texture_atlas_1","hero_back.png"),s.trainer.anchor.set(.5,1),s.add(s.trainer),s.trainerSpriter.x=t.GameConstants.X_OUT_ADVERSARY-s.trainer.width/2+20,s.trainerSpriter.y=t.GameConstants.Y_ADVERSARY-s.trainer.height,s.trainerSpriter.visible=!1,t.GameVars.turn===t.GameConstants.PLAYER?(n=s.player.xIn,i=s.player.y-10):(n=s.adversary.xIn,i=s.adversary.y-10),s.signContainer=new Phaser.Group(s.game),s.signContainer.x=n,s.signContainer.y=i,s.signContainer.scale.y=.35,s.addAt(s.signContainer,0),t.GameVars.playerMonstersFighting[0]){var m="current_mkm_"+t.GameVars.playerMonstersFighting[0].class+".png";s.activeMonsterSign=new Phaser.Image(s.game,0,0,"texture_atlas_2",m),s.activeMonsterSign.anchor.set(.5),s.signContainer.add(s.activeMonsterSign);var h="aura_"+t.GameVars.playerMonstersFighting[0].class+".png";s.aura=new Phaser.Image(s.game,n,i,"texture_atlas_2",h),s.aura.anchor.set(.5,.75),s.add(s.aura),s.game.add.tween(s.activeMonsterSign).to({angle:360},1e4,Phaser.Easing.Linear.None,!0,0,-1)}else{m="current_turn_ander.png";s.activeMonsterSign=new Phaser.Image(s.game,0,0,"texture_atlas_"+t.GameVars.gameData.language,m),s.activeMonsterSign.anchor.set(.5),s.signContainer.add(s.activeMonsterSign),s.game.add.tween(s.activeMonsterSign).to({angle:360},1e4,Phaser.Easing.Linear.None,!0,0,-1)}return s.itemContainer=new Phaser.Group(s.game),s.itemContainer.x=t.GameConstants.X_IN_PLAYER,s.itemContainer.y=t.GameConstants.Y_PLAYER-100,s.itemContainer.visible=!1,s.add(s.itemContainer),s.itemAnim1=new Phaser.Image(s.game,0,0,"texture_atlas_3","item_01.png"),s.itemAnim1.anchor.set(.5),s.itemContainer.add(s.itemAnim1),s.itemAnim2=new Phaser.Image(s.game,0,0,"texture_atlas_3","dazzle_generic_01.png"),s.itemAnim2.anchor.set(.5),s.itemContainer.add(s.itemAnim2),s.itemText=new Phaser.Text(s.game,0,60,"",{font:"30px Chewy",fontWeight:"200",fill:"#72ffff",align:"center"}),s.itemText.stroke="#009eff",s.itemText.strokeThickness=6,s.itemText.anchor.set(.5),s.itemContainer.add(s.itemText),s.item=new Phaser.Image(s.game,0,0,"texture_atlas_1","icon_big_heal.png"),s.item.anchor.set(.5),s.itemContainer.add(s.item),s.itemAnim1.animations.add("anim",Phaser.Animation.generateFrameNames("item_",1,34,".png",2)).onComplete.add((function(){this.itemAnim1.visible=!1}),s),s.itemAnim2.animations.add("anim",Phaser.Animation.generateFrameNames("dazzle_generic_",1,20,".png",2)).onComplete.add((function(){this.itemAnim2.visible=!1}),s),s.ray=new Phaser.Graphics(s.game,0,0),s.ray.lineStyle(60,393214,.25),s.ray.moveTo(t.GameConstants.X_IN_ADVERSARY+80,t.GameConstants.Y_ADVERSARY-140),s.ray.lineTo(t.GameConstants.X_IN_PLAYER+40,t.GameConstants.Y_PLAYER-120),s.ray.lineStyle(40,13762520,.25),s.ray.moveTo(t.GameConstants.X_IN_ADVERSARY+80,t.GameConstants.Y_ADVERSARY-140),s.ray.lineTo(t.GameConstants.X_IN_PLAYER+40,t.GameConstants.Y_PLAYER-120),s.ray.lineStyle(30,16777215,.25),s.ray.moveTo(t.GameConstants.X_IN_ADVERSARY+80,t.GameConstants.Y_ADVERSARY-140),s.ray.lineTo(t.GameConstants.X_IN_PLAYER+40,t.GameConstants.Y_PLAYER-120),s.ray.visible=!1,s.add(s.ray),s.final="fail",s}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this),this.trainerSpriter.updateAnimation()},e.prototype.changeAuraTutorial=function(){this.game.time.events.add(1500,(function(){this.signContainer.remove(this.activeMonsterSign),this.activeMonsterSign=new Phaser.Image(this.game,0,0,"texture_atlas_2","current_mkm_spectre.png"),this.activeMonsterSign.anchor.set(.5),this.signContainer.add(this.activeMonsterSign),this.game.add.tween(this.activeMonsterSign).to({angle:360},1e4,Phaser.Easing.Linear.None,!0,0,-1),this.game.add.tween(this.signContainer).to({x:this.adversary.xIn,y:this.adversary.y-10},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0)}),this)},e.prototype.onAnimationLoopFinished=function(){"stance"===this.trainerSpriter.currentAnimationName?(t.FightManager.decisionCatch()?(this.final="success",this.trainerSpriter.setAnimationSpeedPercent(4)):(this.final="fail",this.trainerSpriter.setAnimationSpeedPercent(7)),this.trainerSpriter.playAnimationByName("stance_02"),t.AudioManager.playSound("fx_capture"),this.ray.visible=!0,this.ray.alpha=0,this.game.add.tween(this.ray).to({alpha:1},50,Phaser.Easing.Cubic.In,!0).onComplete.add((function(){this.ray.visible=!1}),this)):"stance_02"===this.trainerSpriter.currentAnimationName?"success"===this.final?(this.game.time.events.add(300,(function(){t.AudioManager.playSound("fx_capture_success")}),this),this.trainerSpriter.setAnimationSpeedPercent(4),this.trainerSpriter.playAnimationByName("success")):(this.trainerSpriter.setAnimationSpeedPercent(4),this.trainerSpriter.playAnimationByName("fail"),this.game.time.events.add(100,(function(){t.AudioManager.playSound("fx_capture_fail")}),this)):"success"!==this.trainerSpriter.currentAnimationName&&"fail"!==this.trainerSpriter.currentAnimationName||(this.trainerSpriter.setAnimationSpeedPercent(4),this.trainerSpriter.playAnimationByName("final_idle"))},e.prototype.turnChanged=function(){var a,e;t.GameVars.turn===t.GameConstants.PLAYER?(a=this.player.xIn,e=this.player.y-10,t.FightManager.enableGUI()):(a=this.adversary.xIn,e=this.adversary.y-10,this.game.time.events.add(4*t.GameConstants.CHANGE_TIME,t.FightManager.adversaryAttack,this)),this.game.add.tween(this.signContainer).to({x:a,y:e},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.aura).to({x:a,y:e},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),this.changeSign()},e.prototype.hideAdversary=function(){this.game.add.tween(this.adversary).to({alpha:0,y:this.adversary.y+50},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.aura).to({alpha:0,y:this.aura.y+50},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.aura.scale).to({x:.8,y:.8},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.activeMonsterSign).to({alpha:0,y:this.activeMonsterSign.y+50},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.activeMonsterSign.scale).to({x:.8,y:.8},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.trainer).to({y:this.trainer.y+100},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.In,!0)},e.prototype.changeSignClass=function(t){this.activeMonsterSign.frameName="current_mkm_"+t+".png"},e.prototype.animationCatch=function(){this.changeSign(!0),this.game.add.tween(this.signContainer).to({x:t.GameConstants.X_IN_ADVERSARY,y:t.GameConstants.Y_ADVERSARY-10},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.aura).to({x:t.GameConstants.X_IN_ADVERSARY,y:t.GameConstants.Y_ADVERSARY-10},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.player).to({x:this.player.xOut},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.trainer).to({x:t.GameConstants.X_IN_PLAYER},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0,t.GameConstants.CHANGE_TIME),this.game.time.events.add(3*t.GameConstants.CHANGE_TIME,this.adversaryToTrainer,this),this.game.time.events.add(3*t.GameConstants.CHANGE_TIME,this.trainerToAdversary,this)},e.prototype.animationReturnToFight=function(){this.adversary.iconToMonster(),this.game.time.events.add(t.GameConstants.CHANGE_TIME,this.adversaryToInitial,this),this.game.time.events.add(t.GameConstants.CHANGE_TIME,this.trainerToInitial,this),this.game.time.events.add(5*t.GameConstants.CHANGE_TIME,(function(){this.game.add.tween(this.trainer).to({x:this.player.xOut},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.player).to({x:t.GameConstants.X_IN_PLAYER},t.GameConstants.CHANGE_TIME,Phaser.Easing.Cubic.Out,!0,t.GameConstants.CHANGE_TIME)}),this)},e.prototype.showUseItem=function(a){"attack"===a?this.itemText.text=t.GameVars.names.ATTACK:"defense"===a?this.itemText.text=t.GameVars.names.DEFENSE:"aim"===a?this.itemText.text=t.GameVars.names.AIM:"heal"===a?this.itemText.text=t.GameVars.names.HEAL:"focus"===a?this.itemText.text=t.GameVars.names.FOCUS:"antidote"===a&&(this.itemText.text=t.GameVars.names.ANTIDOTE),this.item.frameName="icon_big_"+a+".png",this.itemContainer.visible=!0,this.itemAnim1.visible=!1,this.itemAnim2.visible=!1,this.item.scale.set(0),this.itemText.scale.set(0),this.item.alpha=1,this.itemText.alpha=1,this.game.time.events.add(500,(function(){this.itemAnim1.visible=!0,this.itemAnim1.play("anim",24)}),this),this.game.add.tween(this.item.scale).to({x:1,y:1},600,Phaser.Easing.Cubic.In,!0,1e3),this.game.add.tween(this.itemText.scale).to({x:1,y:1},600,Phaser.Easing.Cubic.In,!0,1e3).onComplete.add((function(){this.itemAnim2.visible=!0,this.itemAnim2.play("anim",24),this.game.add.tween(this.item.scale).to({x:1.1,y:1.1},600,Phaser.Easing.Linear.None,!0,2e3),this.game.add.tween(this.itemText.scale).to({x:1.1,y:1.1},600,Phaser.Easing.Linear.None,!0,2e3),this.game.add.tween(this.item).to({alpha:0},600,Phaser.Easing.Linear.None,!0,2e3),this.game.add.tween(this.itemText).to({alpha:0},600,Phaser.Easing.Linear.None,!0,2e3)}),this)},e.prototype.updateLife=function(a){a===t.GameConstants.PLAYER?this.player.updateLife():this.adversary.updateLife()},e.prototype.showMonsterStates=function(){this.player.showMonsterStates(),this.adversary.showMonsterStates()},e.prototype.changePlayerMonster=function(){this.player.changeMonster(),this.changeSign()},e.prototype.changeAdversaryMonster=function(){this.adversary.changeMonster(),this.changeSign()},e.prototype.retireAdversaryMonster=function(){this.adversary.retireMonster()},e.prototype.deadPlayerMonster=function(){this.player.deadMonster()},e.prototype.playerAttack=function(a){this.animationAttack(this.player,a);var e=t.GameVars.specialAttack?9*t.GameConstants.CHANGE_TIME:5*t.GameConstants.CHANGE_TIME;this.game.time.events.add(e,t.FightManager.changeTurn,this)},e.prototype.adversaryAttack=function(a){this.animationAttack(this.adversary,a);var e=t.GameVars.specialAttack?9*t.GameConstants.CHANGE_TIME:5*t.GameConstants.CHANGE_TIME;this.game.time.events.add(e,t.FightManager.changeTurn,this)},e.prototype.animationAttack=function(a,e){var s;s=e?t.GameVars.monstersActions[e.id]:a===this.player?t.GameVars.monstersActions["001"]:t.GameVars.monstersActions["015"],e&&!e.miss?(this.animationsContainer1.newAction(s,e.backfired),this.animationsContainer2.newAction(s,e.backfired)):e||(t.GameVars.slotData.state>t.GameConstants.TUTORIAL_ESCAPE||t.GameVars.turn!==t.GameConstants.PLAYER)&&(this.animationsContainer1.newAction(s,!1),this.animationsContainer2.newAction(s,!1));var n=this.player,i=-1;a===this.player&&(n=this.adversary,i=1),s.movement_player&&this.playAnimationAttack(a,i,s.movement_player),s.movement_adversary&&e&&!e.miss&&!e.backfired?this.playAnimationDefense(n,i,s.movement_adversary):e||this.playAnimationDefense(n,i,s.movement_adversary)},e.prototype.playAnimationAttack=function(a,e,s){var n=Math.round(60*s[1]);if(1===s[0])this.game.add.tween(a.monsterImage).to({x:-20*e,y:20*e},50,Phaser.Easing.Cubic.Out,!0,n).onComplete.add((function(){this.game.add.tween(a.monsterImage).to({x:50*e,y:-50*e},50,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){this.game.add.tween(a.monsterImage).to({x:0,y:0},400,Phaser.Easing.Quintic.Out,!0)}),this)}),this);else if(2===s[0]){var i=t.Utils.shakeArray(30,3);this.game.add.tween(a.monsterImage).to({x:i},500,Phaser.Easing.Cubic.Out,!0,n)}},e.prototype.playAnimationDefense=function(a,e,s){var n=Math.round(60*s[1]);if(1===s[0])this.game.add.tween(a.monsterImage).to({x:20*e,y:-20*e},50,Phaser.Easing.Cubic.Out,!0,n).onComplete.add((function(){this.game.add.tween(a.monsterImage).to({x:0,y:0},400,Phaser.Easing.Quintic.Out,!0)}),this),this.game.add.tween(a.monsterImage.scale).to({x:.95,y:.95},50,Phaser.Easing.Cubic.Out,!0,n).onComplete.add((function(){this.game.add.tween(a.monsterImage.scale).to({x:1,y:1},400,Phaser.Easing.Quintic.Out,!0)}),this);else if(2===s[0]){var i=t.Utils.shakeArray(30,3);this.game.add.tween(a.monsterImage).to({x:i},500,Phaser.Easing.Cubic.Out,!0,n)}else 3===s[0]&&(this.game.add.tween(a.monsterImage).to({x:20*e,y:-20*e},50,Phaser.Easing.Cubic.Out,!0,n).onComplete.add((function(){this.game.add.tween(a.monsterImage).to({x:0,y:0},500,Phaser.Easing.Quintic.Out,!0).onComplete.add((function(){var e=t.Utils.shakeArray(30,3);this.game.add.tween(a.monsterImage).to({x:e},400,Phaser.Easing.Cubic.Out,!0)}),this)}),this),this.game.add.tween(a.monsterImage.scale).to({x:.95,y:.95},50,Phaser.Easing.Cubic.Out,!0,n).onComplete.add((function(){this.game.add.tween(a.monsterImage.scale).to({x:1,y:1},500,Phaser.Easing.Quintic.Out,!0)}),this))},e.prototype.adversaryToTrainer=function(){this.game.add.tween(this.trainer).to({x:t.GameConstants.X_OUT_ADVERSARY},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.trainer).to({y:t.GameConstants.Y_PLAYER/2},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.In,!0),this.game.time.events.add(t.GameConstants.CHANGE_TIME,(function(){this.trainer.visible=!1,this.trainerSpriter.visible=!0,this.trainerSpriter.x=t.GameConstants.X_OUT_ADVERSARY-this.trainer.width/2+20,this.trainerSpriter.y=t.GameConstants.Y_ADVERSARY-this.trainer.height,this.trainer.frameName="hero_front.png",this.game.add.tween(this.trainer).to({x:t.GameConstants.X_IN_ADVERSARY},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.trainer).to({y:t.GameConstants.Y_ADVERSARY},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.trainerSpriter).to({x:t.GameConstants.X_IN_ADVERSARY-this.trainer.width/2+40},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.trainerSpriter).to({y:t.GameConstants.Y_ADVERSARY-this.trainer.height+40},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){this.trainerSpriter.playAnimationByName("stance")}),this)}),this)},e.prototype.trainerToInitial=function(){this.game.add.tween(this.trainer).to({x:t.GameConstants.X_OUT_PLAYER},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.trainer).to({y:t.GameConstants.Y_PLAYER/2},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.trainerSpriter).to({x:t.GameConstants.X_OUT_PLAYER-this.trainer.width/2+20},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.trainerSpriter).to({y:t.GameConstants.Y_PLAYER/2-this.trainer.height},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.In,!0),this.game.time.events.add(t.GameConstants.CHANGE_TIME,(function(){this.trainer.visible=!0,this.trainerSpriter.visible=!1,this.trainer.frameName="hero_back.png",this.game.add.tween(this.trainer).to({x:t.GameConstants.X_IN_PLAYER},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.trainer).to({y:t.GameConstants.Y_PLAYER},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.Out,!0)}),this)},e.prototype.trainerToAdversary=function(){this.game.add.tween(this.adversary).to({x:t.GameConstants.X_OUT_PLAYER},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.adversary).to({y:t.GameConstants.Y_PLAYER/2},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.aura).to({x:t.GameConstants.X_OUT_PLAYER},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.aura).to({y:t.GameConstants.Y_PLAYER/2},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.signContainer).to({x:t.GameConstants.X_OUT_PLAYER},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.signContainer).to({y:t.GameConstants.Y_PLAYER/2},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.In,!0),this.game.time.events.add(t.GameConstants.CHANGE_TIME,(function(){var a="mkm_"+t.GameVars.adversaryMonstersFighting[0].id+"_back.png";this.adversary.changeFrameName(a),this.adversary.removeStates(),this.game.add.tween(this.adversary).to({x:t.GameConstants.X_IN_PLAYER+50},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.adversary).to({y:t.GameConstants.Y_PLAYER},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.aura).to({x:t.GameConstants.X_IN_PLAYER+50},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.aura).to({y:t.GameConstants.Y_PLAYER-10},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.signContainer).to({x:t.GameConstants.X_IN_PLAYER+50},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.signContainer).to({y:t.GameConstants.Y_PLAYER-10},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.Out,!0)}),this)},e.prototype.adversaryToInitial=function(){this.game.add.tween(this.adversary).to({x:t.GameConstants.X_OUT_ADVERSARY},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.adversary).to({y:t.GameConstants.Y_PLAYER/2},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.aura).to({x:t.GameConstants.X_OUT_ADVERSARY},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.aura).to({y:t.GameConstants.Y_PLAYER/2},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.signContainer).to({x:t.GameConstants.X_OUT_ADVERSARY},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.signContainer).to({y:t.GameConstants.Y_PLAYER/2},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.In,!0),this.game.time.events.add(t.GameConstants.CHANGE_TIME,(function(){var a="mkm_"+t.GameVars.adversaryMonstersFighting[0].id+"_front.png";this.adversary.changeFrameName(a),this.adversary.showStates(),this.game.add.tween(this.adversary).to({x:t.GameConstants.X_IN_ADVERSARY},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.adversary).to({y:t.GameConstants.Y_ADVERSARY},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.aura).to({x:t.GameConstants.X_IN_ADVERSARY},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.aura).to({y:t.GameConstants.Y_ADVERSARY-10},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.signContainer).to({x:t.GameConstants.X_IN_ADVERSARY},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.signContainer).to({y:t.GameConstants.Y_ADVERSARY-10},t.GameConstants.CHANGE_TIME/2,Phaser.Easing.Cubic.Out,!0)}),this)},e.prototype.changeSign=function(a){var e=t.GameVars.turn===t.GameConstants.PLAYER?t.GameVars.playerMonstersFighting[0].class:t.GameVars.adversaryMonstersFighting[0].class;a&&(e=t.GameVars.turn!==t.GameConstants.PLAYER?t.GameVars.playerMonstersFighting[0].class:t.GameVars.adversaryMonstersFighting[0].class);var s="current_mkm_"+e+".png";this.activeMonsterSign.frameName=s;var n="aura_"+e+".png";this.aura.frameName=n},e}(Phaser.Group);t.MonstersContainer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"chapter_layer")||this;s.fixedToCamera=!0,s.visible=!1;var n=new Phaser.Image(s.game,0,300,s.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));n.tint=1713462,n.anchor.set(0,1),n.alpha=.9,n.scale.y=t.GameVars.scaleY,n.scale.set(t.GameConstants.GAME_WIDTH/t.GameConstants.BITMAP_SIZE,100/t.GameConstants.BITMAP_SIZE),s.add(n);var i=new Phaser.Text(s.game,t.GameConstants.GAME_WIDTH/2,210,t.GameVars.chaptersTexts[t.GameVars.slotData.mapName+" title"],{font:"40px Chewy",fill:"#ffffff",align:"center"});i.anchor.set(.5,0),i.scale.y=t.GameVars.scaleY,s.add(i);var o=new Phaser.Text(s.game,t.GameConstants.GAME_WIDTH/2,255,t.GameVars.chaptersTexts[t.GameVars.slotData.mapName+" subtitle"],{font:"28px Chewy",fill:"#ffffff",align:"center"});return o.anchor.set(.5,0),o.scale.y=t.GameVars.scaleY,s.add(o),s}return __extends(e,a),e.prototype.show=function(){this.visible=!0,this.alpha=0;this.game.add.tween(this).to({alpha:1},250,Phaser.Easing.Linear.None,!0,1e3).onComplete.add((function(){this.game.add.tween(this).to({alpha:0},250,Phaser.Easing.Linear.None,!0,5e3).onComplete.add((function(){this.visible=!1}),this)}),this)},e}(Phaser.Group);t.ChapterLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(t,s,n){var i=a.call(this,t,null,"hero")||this;return i.x=s,i.y=n,e.canMove=!0,i.encounterAnimation=new Phaser.Sprite(i.game,0,0,"texture_atlas_3","impact_classic_01.png"),i.encounterAnimation.anchor.set(.5),i.encounterAnimation.scale.set(.5),i.encounterAnimation.visible=!1,i.add(i.encounterAnimation),i.wand=new Phaser.Sprite(i.game,0,-40,"texture_atlas_1","wand_map_01.png"),i.wand.anchor.set(.5),i.wand.visible=!1,i.add(i.wand),i.explosionWand=new Phaser.Sprite(i.game,0,-40,"texture_atlas_3","smoke_generic_01.png"),i.explosionWand.anchor.set(.5),i.explosionWand.scale.set(.2),i.explosionWand.visible=!1,i.add(i.explosionWand),i.explosionWand.animations.add("explosion",Phaser.Animation.generateFrameNames("smoke_generic_",1,21,".png",2)).onComplete.add((function(){this.explosionWand.visible=!1}),i),i.spriteHero=new Phaser.Sprite(i.game,0,0,"texture_atlas_1","down_03.png"),i.spriteHero.anchor.set(.5,.75),i.add(i.spriteHero),i.direction="idle",i.fromDialogue="",i.spriteHero.animations.add("down",Phaser.Animation.generateFrameNames("down_",1,5,".png",2)),i.spriteHero.animations.add("up",Phaser.Animation.generateFrameNames("up_",1,5,".png",2)),i.spriteHero.animations.add("left",Phaser.Animation.generateFrameNames("side_",1,8,".png",2)),i.spriteHero.animations.add("rigth",Phaser.Animation.generateFrameNames("side_",1,8,".png",2)),i.tweenAnim=i.game.add.tween(i.spriteHero.scale).to({y:[.95,1],x:[1.1,1]},1600,Phaser.Easing.Cubic.In,!0,0,-1),i.encounterAnimation.animations.add("encounter",Phaser.Animation.generateFrameNames("impact_spectre_",1,14,".png",2)).onComplete.add((function(){this.encounterAnimation.visible=!1}),i),i.wand.animations.add("wand",Phaser.Animation.generateFrameNames("wand_map_",1,16,".png",2)),i}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this)},e.prototype.walk=function(a,s){t.GameVars.paused?this.stopWalk():t.MapManager.findSpawn(s)?e.canMove=!1:t.MapManager.findDialogue(s)||t.MapManager.findTrainer(s,a.length)||(s<a.length?(e.walking=!0,t.GameManager.saveHeroPosition(a[s]),(this.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE>a[s].y?this.setHeroWalk("up","up_01.png",1):(this.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE<a[s].y?this.setHeroWalk("down","down_01.png",1):(this.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE<a[s].x?this.setHeroWalk("left","side_01.png",-1):(this.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE>a[s].x&&this.setHeroWalk("rigth","side_01.png",1),this.moveTo(a,s)):(this.stopWalk(),this.fromDialogue="",t.MapManager.findObjectEndPath()))},e.prototype.stopWalk=function(t){this.tweenAnim=this.game.add.tween(this.spriteHero.scale).to({y:[.95,1],x:[1.1,1]},1600,Phaser.Easing.Cubic.In,!0,0,-1),e.walking=!1,this.spriteHero.animations.stop(null,!0),"down"===this.direction?this.spriteHero.frameName="down_03.png":"up"===this.direction?this.spriteHero.frameName="up_03.png":this.spriteHero.frameName="side_03.png",t&&(this.spriteHero.frameName="up_03.png"),this.direction="idle"},e.prototype.changeWalk=function(){this.tweenHero&&this.tweenHero.stop(),this.tweenAnim&&this.tweenAnim.stop()},e.prototype.watchingSign=function(){this.spriteHero.frameName="up_03.png",this.direction="idle"},e.prototype.startFight=function(){"up"===this.direction?(this.encounterAnimation.x=this.spriteHero.x,this.encounterAnimation.y=this.spriteHero.y-t.GameConstants.TILES_SIZE,this.bringToTop(this.spriteHero)):"down"===this.direction?(this.encounterAnimation.x=this.spriteHero.x,this.encounterAnimation.y=this.spriteHero.y+t.GameConstants.TILES_SIZE,this.bringToTop(this.encounterAnimation)):"left"===this.direction?(this.encounterAnimation.x=this.spriteHero.x-t.GameConstants.TILES_SIZE,this.encounterAnimation.y=this.spriteHero.y,this.bringToTop(this.encounterAnimation)):"rigth"===this.direction&&(this.encounterAnimation.x=this.spriteHero.x+t.GameConstants.TILES_SIZE,this.encounterAnimation.y=this.spriteHero.y,this.bringToTop(this.encounterAnimation)),t.GameVars.adversaryMonstersFighting[0].class===t.GameConstants.ELEMENT_CLASSIC?(this.encounterAnimation.frameName="impact_classic_01.png",this.encounterAnimation.animations.add("encounter",Phaser.Animation.generateFrameNames("impact_classic_",1,16,".png",2))):t.GameVars.adversaryMonstersFighting[0].class===t.GameConstants.ELEMENT_SPECTRE?(this.encounterAnimation.frameName="impact_spectre_01.png",this.encounterAnimation.animations.add("encounter",Phaser.Animation.generateFrameNames("impact_spectre_",1,14,".png",2))):(this.encounterAnimation.frameName="impact_tech_01.png",this.encounterAnimation.animations.add("encounter",Phaser.Animation.generateFrameNames("impact_tech_",1,15,".png",2))),this.encounterAnimation.visible=!0,this.encounterAnimation.alpha=1,this.encounterAnimation.play("encounter",30,!1,!0)},e.prototype.moveToExit=function(t,a){this.y>a?this.setHeroWalk("up","up_01.png",1):this.y<a?this.setHeroWalk("down","down_01.png",1):this.x<t?this.setHeroWalk("left","side_01.png",-1):this.x>t&&this.setHeroWalk("rigth","side_01.png",1);var s=Math.sqrt(Math.pow(this.x-t,2)+Math.pow(this.y-a,2));this.tweenHero=this.game.add.tween(this),this.tweenHero.to({x:t,y:a},e.HERO_TIME*s,Phaser.Easing.Linear.None,!0).onComplete.add(this.stopWalk,this)},e.prototype.setHeroWalk=function(t,a,s){this.direction!==t&&(this.spriteHero.frameName=a,this.spriteHero.play(t,e.HERO_FPS,!0),this.scale.x=s,this.direction=t)},e.prototype.setHeroDirection=function(t,a,e){this.direction!==t&&(this.spriteHero.frameName=a,this.scale.x=e)},e.prototype.startTalkingWand=function(){this.setHeroDirection("up","up_03.png",1),this.direction="idle",this.explosionWand.visible=!0,this.explosionWand.play("explosion",30,!1,!1),t.AudioManager.playSound("smoke_generic"),this.wand.visible=!0,this.wand.alpha=0,this.game.add.tween(this.wand).to({alpha:1},250,Phaser.Easing.Linear.None,!0)},e.prototype.stopTakingWand=function(){this.explosionWand.visible=!0,this.explosionWand.play("explosion",30,!1,!1),t.AudioManager.playSound("smoke_generic"),this.game.add.tween(this.wand).to({alpha:0},250,Phaser.Easing.Linear.None,!0).onComplete.add((function(){this.wand.visible=!1}),this)},e.prototype.moveTo=function(a,s){var n=a[s].x*t.GameConstants.TILES_SIZE+t.GameConstants.TILES_SIZE_HALF,i=a[s].y*t.GameConstants.TILES_SIZE+t.GameConstants.TILES_SIZE_HALF,o=Math.sqrt(Math.pow(this.x-n,2)+Math.pow(this.y-i,2));this.tweenHero=this.game.add.tween(this),this.tweenHero.to({x:n,y:i},e.HERO_TIME*o,Phaser.Easing.Linear.None,!0),this.tweenHero.onComplete.add((function(){t.MapState.currentInstance.mapContainer.hero.walk(a,s+1)}),this),e.heroSteps++,t.AudioManager.playSound("step")},e.HERO_TIME=5,e.HERO_FPS=15,e.heroSteps=0,e.walking=!1,e.canMove=!0,e}(Phaser.Group);t.Hero=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"loading-layer")||this;s.framesCounter=0;var n=s.create(0,0,s.game.cache.getBitmapData(t.GameConstants.BLACK_SQUARE));n.alpha=.8,n.inputEnabled=!0,n.events.onInputDown.add(s.onClickDarkLayer,s),n.scale.set(t.GameConstants.GAME_WIDTH/t.GameConstants.BITMAP_SIZE,t.GameConstants.GAME_HEIGHT/t.GameConstants.BITMAP_SIZE),s.add(n);var i=new Phaser.Group(s.game);return i.x=t.GameConstants.GAME_WIDTH/2,i.y=t.GameConstants.GAME_HEIGHT/2,i.scale.y=t.GameVars.scaleY,s.add(i),s.waiting=new Phaser.Sprite(s.game,0,0,"texture_atlas_1","waiting.png"),s.waiting.anchor.set(.5),i.add(s.waiting),s}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this),this.framesCounter++,5===this.framesCounter&&(this.framesCounter=0,this.waiting.angle+=30)},e.prototype.onClickDarkLayer=function(){},e}(Phaser.Group);t.LoadingLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"map-container")||this,n=t.GameVars.slotData.mapName;if(s.scale.y=t.GameVars.scaleY,s.initialPosition={x:t.GameConstants.TILES_SIZE*t.GameVars.slotData.mapsData[n].heroPosition.x+t.GameConstants.TILES_SIZE_HALF,y:t.GameConstants.TILES_SIZE*t.GameVars.slotData.mapsData[n].heroPosition.y+t.GameConstants.TILES_SIZE_HALF},s.nextDialogue=!1,s.nextDialogueSpace=!1,s.canFindPath=!1,s.easyStar=new EasyStar.js,s.hero=new t.Hero(s.game,s.initialPosition.x,s.initialPosition.y),s.add(s.hero),s.clicksGroup=new Phaser.Group(s.game),s.add(s.clicksGroup),s.chargeMap(t.GameVars.slotData.mapsData[n].tilemapName,t.GameVars.slotData.mapsData[n].imageName),s.reorder(),t.GameVars.needWalk){var i=s.hero.x,o=s.hero.y;"left"===t.GameVars.needWalk?s.hero.x+=t.GameConstants.TILES_SIZE:"right"===t.GameVars.needWalk?s.hero.x-=t.GameConstants.TILES_SIZE:"up"===t.GameVars.needWalk?s.hero.y+=t.GameConstants.TILES_SIZE:s.hero.y-=t.GameConstants.TILES_SIZE,s.game.time.events.add(500,(function(){this.hero.moveToExit(i,o)}),s)}if("map1"===n&&t.GameVars.slotData.state===t.GameConstants.INITIAL_BUS){t.GameVars.paused=!0;var r=new Phaser.Image(s.game,s.initialPosition.x-5,s.initialPosition.y-20,"texture_atlas_1","bus.png");r.anchor.set(.5),s.add(r),s.game.add.tween(r).to({x:r.x-1700},4e3,Phaser.Easing.Linear.None,!0,1e3).onComplete.add((function(){this.game.add.tween(r).to({x:r.x-1600},3e3,Phaser.Easing.Linear.None,!0,1e3),this.game.time.events.add(2e3,(function(){t.GameVars.paused=!1,t.GameVars.slotData.state=t.GameConstants.TUTORIAL_ESCAPE,this.finger=new Phaser.Image(this.game,this.initialPosition.x-1880,this.initialPosition.y-20,"texture_atlas_1","tutorial_finger.png"),this.add(this.finger),this.game.add.tween(this.finger).to({x:[this.initialPosition.x-1895,this.initialPosition.x-1880]},1e3,Phaser.Easing.Linear.None,!0,0,-1);var a=Math.round((this.hero.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),e=Math.round((this.hero.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE);t.GameManager.saveHeroPosition({x:a,y:e})}),this)}),s),s.game.add.tween(s.hero).to({x:s.hero.x-1700},4e3,Phaser.Easing.Linear.None,!0,1e3)}return s.spaceKey=s.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),s.leftKey=s.game.input.keyboard.addKey(Phaser.Keyboard.LEFT),s.rightKey=s.game.input.keyboard.addKey(Phaser.Keyboard.RIGHT),s.upKey=s.game.input.keyboard.addKey(Phaser.Keyboard.UP),s.downKey=s.game.input.keyboard.addKey(Phaser.Keyboard.DOWN),s.prevX=s.hero.x,s.prevY=s.hero.y,s.prevCol=!1,s.game.world.setBounds(0,0,t.GameVars.slotData.mapsData[n].dimensions.x*t.GameConstants.TILES_SIZE,t.GameVars.slotData.mapsData[n].dimensions.y*t.GameConstants.TILES_SIZE*t.GameVars.scaleY),s.game.camera.follow(s.hero.spriteHero,Phaser.Camera.FOLLOW_LOCKON),s}return __extends(e,a),e.prototype.removeTrainer=function(){for(var a=0;a<this.trainers.length;a++)if(this.bringToTop(this.hero),this.trainers[a].data.id===t.GameVars.needRemoveTrainer.id){"016"!==t.GameVars.needRemoveTrainer.id?(this.removeTrainerFromMap(this.trainers[a].tiledX,this.trainers[a].tiledY),this.trainers[a].removeTrainer(),t.MapManager.removeTrainer()):(t.GameVars.needRemoveTrainer=null,t.GameVars.slotData.winLastTrainer=!0,t.GameManager.writeGameData());break}},e.prototype.changeLastTrainer=function(){for(var t=0;t<this.trainers.length;t++)this.bringToTop(this.hero),"016"===this.trainers[t].data.id&&this.trainers[t].changeLastTrainer()},e.prototype.init=function(){this.createAnimations()},e.prototype.update=function(){if(a.prototype.update.call(this),t.GameManager.defaultCursor(),t.Hero.canMove&&!t.GameVars.paused&&!(this.game.input.activePointer.y/t.GameVars.scaleY<95&&t.GameVars.slotData.state>t.GameConstants.TUTORIAL_WAND||t.GameVars.needChangeMkm)){if(this.changeZorder(),this.checkShowHand(),this.game.input.activePointer.isUp){if(this.nextDialogue)return t.MapManager.nextDialogue(),void(this.nextDialogue=!1);if(t.GameVars.needRemoveTrainer)return;this.canFindPath&&(this.canFindPath=!1,this.findPath())}if(this.game.input.activePointer.isDown&&(this.finger&&this.finger.destroy(),t.MapManager.dialogueOpen()?this.nextDialogue=!0:this.canFindPath=!0),this.spaceKey.isUp&&this.nextDialogueSpace)return t.MapManager.nextDialogue(),void(this.nextDialogueSpace=!1);this.spaceKey.isDown&&!this.nextDialogueSpace&&t.MapManager.dialogueOpen()&&(this.nextDialogueSpace=!0)}},e.prototype.checkShowHand=function(){if(this.game.device.desktop){var a={x:this.background.getTileX(this.game.input.activePointer.worldX),y:this.background.getTileY(this.game.input.activePointer.worldY/t.GameVars.scaleY)};this.clickOnTrainer(a.x,a.y)||this.clickOnSign(a.x,a.y)?this.game.canvas.style.cursor="pointer":this.game.canvas.style.cursor="default"}},e.prototype.needReplace=function(t,a,e,s,n,i){var o;"background"===a?o=this.background:"collisions1"===a?o=this.collisions[0]:"collisions2"===a?o=this.collisions[1]:"bridges"===a&&(o=this.bridges);for(var r=e;r<=s;r++)for(var m=n;m<=i;m++)if(o.layer.data[m][r]&&o.layer.data[m][r].index===t)return!0;return!1},e.prototype.changeZorder=function(){var a,e,s,n;this.prevX<=this.hero.x?(a=this.prevCol?Math.floor((this.hero.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE):Math.ceil((this.hero.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),s=Math.floor((this.hero.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE)):(a=this.prevCol?Math.ceil((this.hero.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE):Math.floor((this.hero.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),s=Math.ceil((this.hero.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE)),this.prevY<=this.hero.y?(e=this.prevCol?Math.floor((this.hero.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE):Math.ceil((this.hero.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),n=Math.floor((this.hero.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE)):(e=this.prevCol?Math.ceil((this.hero.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE):Math.floor((this.hero.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),n=Math.ceil((this.hero.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE)),this.prevX=this.hero.x,this.prevY=this.hero.y,2===this.level[e-1][a]||3===this.level[e-1][a]?this.topHero():this.backHero(),2===this.level[n-1][s]||3===this.level[n-1][s]?this.prevCol=!0:this.prevCol=!1},e.prototype.chargeMap=function(a,e){this.stamp=new Phaser.Sprite(this.game,0,0,"tiles"),this.stamp.anchor.set(.5),this.add(this.stamp),this.hero.position.set(this.initialPosition.x,this.initialPosition.y),this.map=this.game.add.tilemap(a),this.map.addTilesetImage(e,e),this.objects=this.map.objects,this.objects=this.objects.objects,t.MapManager.initObjects(this.objects),this.background=this.map.createLayer("background"),this.background.renderable=!1;var s=this.game.cache.getRenderTexture(this.background.layer.name+t.GameVars.slotData.mapName);if(s)this.backgroundImage=new Phaser.Sprite(this.game,0,0,s.texture),this.add(this.backgroundImage);else{var n=new Phaser.RenderTexture(this.game,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.x*t.GameConstants.TILES_SIZE,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.y*t.GameConstants.TILES_SIZE);this.backgroundImage=new Phaser.Sprite(this.game,0,0,n),this.add(this.backgroundImage),this.renderTexture(this.background,n)}for(var i=0,o=0;o<this.map.layers.length;o++)this.map.layers[o].name.search("collisions")||i++;this.collisions=new Array,this.collisionsImages=new Array;for(o=1;o<=i;o++){var r="collisions"+o,m=this.map.createLayer(r);m.renderable=!1,this.collisions.push(m);var h=void 0;if(s=this.game.cache.getRenderTexture(m.layer.name+t.GameVars.slotData.mapName))h=new Phaser.Sprite(this.game,0,0,s.texture),this.add(h),this.collisionsImages.push(h);else{var l=new Phaser.RenderTexture(this.game,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.x*t.GameConstants.TILES_SIZE,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.y*t.GameConstants.TILES_SIZE);h=new Phaser.Sprite(this.game,0,0,l),this.add(h),this.collisionsImages.push(h),this.renderTexture(m,l)}}if(this.animationsBot=this.map.createLayer("animationsBot"),this.animationsBot.renderable=!1,this.animationsBotGroup=new Phaser.Group(this.game),this.add(this.animationsBotGroup),this.bridges=this.map.createLayer("bridges"),this.bridges.renderable=!1,s=this.game.cache.getRenderTexture(this.bridges.layer.name+t.GameVars.slotData.mapName))this.bridgesImage=new Phaser.Sprite(this.game,0,0,s.texture),this.add(this.bridgesImage);else{var c=new Phaser.RenderTexture(this.game,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.x*t.GameConstants.TILES_SIZE,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.y*t.GameConstants.TILES_SIZE);this.bridgesImage=new Phaser.Sprite(this.game,0,0,c),this.add(this.bridgesImage),this.renderTexture(this.bridges,c)}this.animationsTop=this.map.createLayer("animationsTop"),this.animationsTop.renderable=!1,this.animationsTopGroup=new Phaser.Group(this.game),this.add(this.animationsTopGroup),this.trainers=new Array;for(o=0;o<t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].trainers.length;o++){var d=new t.Trainer(this.game,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].trainers[o]);this.add(d),this.trainers.push(d)}this.createLevel(),this.bringToTop(this.hero);for(o=0;o<this.collisionsImages.length;o++)this.bringToTop(this.collisionsImages[o]);this.bringToTop(this.animationsTopGroup),this.bringToTop(this.clicksGroup),t.GameConstants.SHOW_COLLISIONS&&this.createLevelHelper(),t.GameManager.writeGameData()},e.prototype.createAnimations=function(){for(var a=0;a<this.animationsTop.layer.data.length;a++)for(var e=0;e<this.animationsTop.layer.data[0].length;e++)for(var s=0;s<t.GameVars.animations.length;s++){var n=t.GameVars.animations[s];if(this.animationsTop.layer.data[a][e].index===n.tile){var i=new Phaser.Sprite(this.game,e*t.GameConstants.TILES_SIZE,a*t.GameConstants.TILES_SIZE,"texture_atlas_1",n.name+"_01.png");this.animationsTopGroup.add(i),i.animations.add("anim",Phaser.Animation.generateFrameNames(n.name+"_",1,n.length,".png",2)),i.play("anim",8+6*Math.random(),!0)}if(this.animationsBot.layer.data[a][e].index===n.tile){i=new Phaser.Sprite(this.game,e*t.GameConstants.TILES_SIZE,a*t.GameConstants.TILES_SIZE,"texture_atlas_1",n.name+"_01.png");this.animationsBotGroup.add(i),i.animations.add("anim",Phaser.Animation.generateFrameNames(n.name+"_",1,n.length,".png",2)),i.play("anim",8+6*Math.random(),!0)}}},e.prototype.renderTexture=function(a,e){for(var s=0;s<a.layer.data.length;s++)for(var n=0;n<a.layer.data[0].length;n++)this.stamp.scale.set(1),this.stamp.rotation=0,a.layer.data[s][n].flipped&&(2===a.layer.data[s][n].flippedVal?this.stamp.scale.y=-1:4===a.layer.data[s][n].flippedVal&&(this.stamp.scale.x=-1)),a.layer.data[s][n].rotation&&(this.stamp.rotation=a.layer.data[s][n].rotation),-1!==a.layer.data[s][n].index&&(this.stamp.frame=a.layer.data[s][n].index-1,e.renderXY(this.stamp,n*t.GameConstants.TILES_SIZE+t.GameConstants.TILES_SIZE/2,s*t.GameConstants.TILES_SIZE+t.GameConstants.TILES_SIZE/2));this.game.cache.addRenderTexture(a.layer.name+t.GameVars.slotData.mapName,e)},e.prototype.createLevel=function(){if(this.level=[],t.GameConstants.COLLISIONS){for(var a=0;a<this.background.layer.data.length;a++){this.level[a]=[];for(var e=0;e<this.background.layer.data[0].length;e++)this.background.layer.data[a][e].properties.collision?this.level[a][e]=1:this.level[a][e]=0,!1===this.bridges.layer.data[a][e].properties.collision&&(this.level[a][e]=0),this.bridges.layer.data[a][e].properties.sendBack&&(this.level[a][e]=3)}for(a=0;a<this.collisions.length;a++)for(e=0;e<this.collisions[a].layer.data.length;e++)for(var s=0;s<this.collisions[a].layer.data[0].length;s++)this.collisions[a].layer.data[e][s].properties.collision&&(this.collisions[a].layer.data[e][s].properties.sendBack?this.level[e][s]=2:this.level[e][s]=1);for(a=0;a<this.trainers.length;a++){var n=Math.round((this.trainers[a].x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),i=Math.round((this.trainers[a].y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE);this.level[i][n]=1,this.level[i][n-1]=1,this.level[i][n-2]=1,this.level[i][n+1]=1,this.level[i][n+2]=1}}else for(a=0;a<this.background.layer.data.length;a++){this.level[a]=[];for(e=0;e<this.background.layer.data[0].length;e++)this.level[a][e]=0}},e.prototype.removeTrainerFromMap=function(t,a){this.level[a][t]=0,this.level[a][t-1]=0,this.level[a][t-2]=0,this.level[a][t+1]=0,this.level[a][t+2]=0},e.prototype.findPath=function(){var a=Math.round((this.hero.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),e=Math.round((this.hero.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE);this.levelMin=this.createLevelMin(a,e),this.easyStar.setGrid(this.levelMin),this.easyStar.setAcceptableTiles([0,3]),this.easyStar.enableDiagonals();var s={x:a,y:e},n={x:this.background.getTileX(this.game.input.activePointer.worldX),y:this.background.getTileY(this.game.input.activePointer.worldY/t.GameVars.scaleY)};n.y+=this.clickOnTrainer(n.x,n.y),n.y+=this.clickOnSign(n.x,n.y),this.easyStar.findPath(s.x,s.y,n.x,n.y,(function(a){null===a?(t.GameManager.log("The path to the destination point was not found."),t.MapState.currentInstance.mapContainer.focusHero(s.x,s.y,n.x,n.y),t.MapState.currentInstance.mapContainer.showWrongClick()):(t.MapState.currentInstance.mapContainer.hero.changeWalk(),t.MapState.currentInstance.mapContainer.hero.walk(a,1),t.MapState.currentInstance.mapContainer.showCorrectClick())})),this.easyStar.calculate()},e.prototype.showWrongClick=function(){var a=new Phaser.Image(this.game,this.game.input.activePointer.worldX,this.game.input.activePointer.worldY/t.GameVars.scaleY,"texture_atlas_1","cursor_wrong_01.png");a.anchor.set(.5),this.clicksGroup.add(a),a.animations.add("anim",Phaser.Animation.generateFrameNames("cursor_wrong_",1,6,".png",2)),a.play("anim",16,!1,!0),t.AudioManager.playSound("wrong_destination")},e.prototype.showCorrectClick=function(){var a=new Phaser.Image(this.game,this.game.input.activePointer.worldX,this.game.input.activePointer.worldY/t.GameVars.scaleY,"texture_atlas_1","cursor_ok_01.png");a.anchor.set(.5),this.clicksGroup.add(a),a.animations.add("anim",Phaser.Animation.generateFrameNames("cursor_ok_",1,6,".png",2)),a.play("anim",16,!1,!0),t.AudioManager.playSound("click_btn")},e.prototype.findPathArrow=function(a,e){var s=Math.round((this.hero.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),n=Math.round((this.hero.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE);this.levelMin=this.createLevelMin(s,n),this.easyStar.setGrid(this.levelMin),this.easyStar.setAcceptableTiles([0,3]),this.easyStar.enableDiagonals();var i={x:s,y:n},o={x:i.x+a,y:i.y+e};o.y+=this.clickOnTrainer(o.x,o.y),o.y+=this.clickOnSign(o.x,o.y),this.easyStar.findPath(i.x,i.y,o.x,o.y,(function(a){null===a?(t.GameManager.log("The path to the destination point was not found."),t.MapState.currentInstance.mapContainer.focusHero(i.x,i.y,o.x,o.y)):(t.MapState.currentInstance.mapContainer.hero.changeWalk(),t.MapState.currentInstance.mapContainer.hero.walk(a,1))})),this.easyStar.calculate()},e.prototype.clickOnTrainer=function(t,a){for(var e=0;e<this.trainers.length;e++)if(!this.trainers[e].data.won){if(t===this.trainers[e].tiledX&&a===this.trainers[e].tiledY)return 1;if(t===this.trainers[e].tiledX&&a+1===this.trainers[e].tiledY)return 2}return 0},e.prototype.clickOnSign=function(a,e){var s={x:Math.round(a*t.GameConstants.TILES_SIZE+t.GameConstants.TILES_SIZE_HALF),y:Math.round((e+1)*t.GameConstants.TILES_SIZE+t.GameConstants.TILES_SIZE_HALF)},n={x:Math.round(a*t.GameConstants.TILES_SIZE+t.GameConstants.TILES_SIZE_HALF),y:Math.round((e+2)*t.GameConstants.TILES_SIZE+t.GameConstants.TILES_SIZE_HALF)},i=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dialogues;if(!i)return 0;for(var o=0;o<i.length;o++)if(i[o].polygon&&i[o].sign){if(t.Utils.inside(s,i[o].polygon,i[o].x,i[o].y))return 1;if(t.Utils.inside(n,i[o].polygon,i[o].x,i[o].y))return 2}return 0},e.prototype.focusHero=function(a,e,s,n){if(!t.Hero.walking){var i=s-a,o=n-e;Math.abs(i)>Math.abs(o)?i<0?this.hero.setHeroDirection("left","side_03.png",1):i>0&&this.hero.setHeroDirection("right","side_03.png",-1):o<0?this.hero.setHeroDirection("up","up_03.png",1):o>0&&this.hero.setHeroDirection("down","down_03.png",1)}},e.prototype.createLevelMin=function(a,e){var s=[],n=Math.round((t.GameConstants.GAME_WIDTH-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),i=Math.round((t.GameConstants.GAME_HEIGHT/t.GameVars.scaleY-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),o=a-Math.round(n/2)>0?a-Math.round(n/2):0,r=e-Math.round(i/2)>0?e-Math.round(i/2):0,m=o+n,h=r+i,l=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.x,c=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.y;m>l&&(o=(m=l)-n),h>c&&(r=(h=c)-i);for(var d=0;d<this.level.length;d++){s[d]=[];for(var p=0;p<this.level[d].length;p++)s[d][p]=d>=r&&d<=h&&p>=o&&p<=m?this.level[d][p]:1}return s},e.prototype.nextMap=function(t,a){this.chargeMap(t,a)},e.prototype.reorder=function(){this.bringToTop(this.hero);for(var t=0;t<this.collisionsImages.length;t++)this.bringToTop(this.collisionsImages[t]);for(t=0;t<this.trainers.length;t++)this.bringToTop(this.trainers[t]);this.bringToTop(this.animationsTopGroup),this.bringToTop(this.clicksGroup)},e.prototype.topHero=function(){for(var a=0;a<this.collisionsImages.length;a++)this.bringToTop(this.collisionsImages[a]);this.bringToTop(this.hero),t.GameConstants.SHOW_COLLISIONS&&this.bringToTop(this.levelHelper);for(a=0;a<this.trainers.length;a++)this.bringToTop(this.trainers[a]);this.bringToTop(this.animationsTopGroup),this.bringToTop(this.clicksGroup)},e.prototype.backHero=function(){this.bringToTop(this.hero);for(var a=0;a<this.collisionsImages.length;a++)this.bringToTop(this.collisionsImages[a]);for(a=0;a<this.trainers.length;a++)this.bringToTop(this.trainers[a]);t.GameConstants.SHOW_COLLISIONS&&this.bringToTop(this.levelHelper),this.bringToTop(this.animationsTopGroup),this.bringToTop(this.clicksGroup)},e.prototype.zOrderHeroTrainers=function(){for(var t=0;t<this.trainers.length;t++)(this.trainers[t].y>this.hero.y&&this.getChildIndex(this.trainers[t])<this.getChildIndex(this.hero)||this.trainers[t].y<this.hero.y&&this.getChildIndex(this.trainers[t])>this.getChildIndex(this.hero))&&this.swapChildren(this.trainers[t],this.hero)},e.prototype.createLevelHelper=function(){this.levelHelper=new Phaser.Group(this.game),this.add(this.levelHelper);for(var a=0;a<this.level[0].length;a++)for(var e=0;e<this.level.length;e++){if(1===this.level[e][a])(s=new Phaser.Graphics(this.game,a*t.GameConstants.TILES_SIZE,e*t.GameConstants.TILES_SIZE)).lineStyle(0),s.beginFill(16711680,.5),s.drawRect(0,0,t.GameConstants.TILES_SIZE,t.GameConstants.TILES_SIZE),s.endFill(),this.levelHelper.add(s);else if(2===this.level[e][a]){(s=new Phaser.Graphics(this.game,a*t.GameConstants.TILES_SIZE,e*t.GameConstants.TILES_SIZE)).lineStyle(0),s.beginFill(255,.5),s.drawRect(0,0,t.GameConstants.TILES_SIZE,t.GameConstants.TILES_SIZE),s.endFill(),this.levelHelper.add(s)}else if(3===this.level[e][a]){var s;(s=new Phaser.Graphics(this.game,a*t.GameConstants.TILES_SIZE,e*t.GameConstants.TILES_SIZE)).lineStyle(0),s.beginFill(65280,.5),s.drawRect(0,0,t.GameConstants.TILES_SIZE,t.GameConstants.TILES_SIZE),s.endFill(),this.levelHelper.add(s)}}},e}(Phaser.Group);t.MapContainer=a}(MagikMons||(MagikMons={})),function(t){var a=function(){function a(){}return a.init=function(t){a.game=t},a.initObjects=function(e){var s=t.GameVars.slotData.mapName;if(!t.GameVars.slotData.mapsData[s].spawns){t.GameVars.slotData.mapsData[s].spawns=new Array,t.GameVars.slotData.mapsData[s].dialogues=new Array,t.GameVars.slotData.mapsData[s].trainers=new Array,t.GameVars.slotData.mapsData[s].exits=new Array,t.GameVars.slotData.mapsData[s].paths=new Array;for(var n=0;n<e.length;n++)"spawn"===e[n].type?a.addSpawn(e[n]):"dialogue"===e[n].type?a.addDialogue(e[n]):"exit"===e[n].type?a.addExit(e[n]):"trainer"===e[n].type?a.addTrainer(e[n]):"paths"===e[n].type&&t.GameVars.slotData.mapsData[s].paths.push(e[n])}},a.checkNeedChangeMkm=function(){t.GameVars.needChangeMkm=!1;for(var a=!1,e=0,s=0,n=0;n<3;n++)t.GameVars.slotData.monsters[n]&&(e+=t.GameVars.slotData.monsters[n].maxLife,s+=t.GameVars.slotData.monsters[n].life);e>0&&s/e<.6&&(a=!0),t.MapState.currentInstance.mapGUI.needChangeMkm(a)},a.showMapLayer=function(){t.GameVars.paused=!0,t.MapState.currentInstance.showMapLayer()},a.hideMapLayer=function(){t.GameVars.paused=!1,t.MapState.currentInstance.removeMapLayer()},a.showTeamLayer=function(){t.GameVars.paused=!0,t.MapState.currentInstance.showTeamLayer()},a.hideTeamLayer=function(){t.GameVars.paused=!1,t.MapState.currentInstance.removeTeamLayer()},a.showItemsLayer=function(){t.GameVars.paused=!0,t.MapState.currentInstance.showItemLayer()},a.hideItemsLayer=function(){t.GameVars.paused=!1,t.MapState.currentInstance.removeItemLayer(),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_CRAFT&&(t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.CAPTURE_1,"CAPTURE_1"),this.game.time.events.add(500,(function(){t.Hero.canMove=!0}),this))},a.showMkmLayer=function(a){t.MapState.currentInstance.showMkmLayer(a)},a.hideMkmLayer=function(){t.MapState.currentInstance.removeMkmLayer()},a.nextMap=function(){t.MapState.currentInstance.mapContainer.nextMap("map1","tileset_32")},a.deleteSpawn=function(a){var e=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].spawns.indexOf(a);e>-1&&t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].spawns.splice(e,1)},a.deleteDialogue=function(a){var e=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dialogues.indexOf(a);e>-1&&t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dialogues.splice(e,1)},a.dialogueOpen=function(){return t.MapState.currentInstance.mapHUD.dialogueOpen()},a.nextDialogue=function(){t.MapState.currentInstance.mapHUD.nextDialogue()},a.closeDialogue=function(){t.MapState.currentInstance.mapHUD.closeDialogue()},a.closeDialogueTutorial=function(e){t.MapState.currentInstance.mapHUD.closeDialogue(),"WAND_1"===e?(t.MapState.currentInstance.mapContainer.hero.startTalkingWand(),t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.WAND_2,"WAND_2")):"WAND_2"===e?(t.MapState.currentInstance.mapGUI.showWand(),t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.WAND_3,"WAND_3")):"WAND_3"===e?(t.Hero.canMove=!1,t.MapState.currentInstance.mapGUI.showSelectionType()):"WAND_4"===e?(t.Hero.canMove=!1,t.MapState.currentInstance.mapGUI.showSelectedMonster()):"WAND_5"===e?(t.Hero.canMove=!1,a.activeWand(),t.MapState.currentInstance.mapContainer.hero.stopTakingWand(),t.AudioManager.playSound("music_map",!0,1,!0)):"HEAL_1"===e?(t.Hero.canMove=!1,a.activeWand()):"CRAFT_1"===e?(t.Hero.canMove=!1,a.activeItems()):"CAPTURE_1"===e?(t.GameManager.endCraftTutorial(),t.MapState.currentInstance.mapContainer.hero.stopTakingWand(),t.AudioManager.playSound("music_map",!0,1,!0)):"SWAP_0"===e?(t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.SWAP_1,"SWAP_1"),t.MapState.currentInstance.mapGUI.showSwap1()):"SWAP_1"===e?(t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.SWAP_2,"SWAP_2"),t.MapState.currentInstance.mapGUI.showSwap2()):"SWAP_2"===e?(t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.SWAP_3,"SWAP_3"),t.MapState.currentInstance.mapGUI.showSwap3()):"SWAP_3"===e?(t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.SWAP_4,"SWAP_4"),t.MapState.currentInstance.mapGUI.removeSwap()):"SWAP_4"===e?(t.GameManager.endSwap2Tutorial(),t.MapState.currentInstance.mapContainer.hero.stopTakingWand(),t.AudioManager.playSound("music_map",!0,1,!0)):"NO_CAPTURE_1"===e?(t.GameManager.endNoCaptureTutorial(),t.MapState.currentInstance.mapContainer.hero.stopTakingWand(),t.AudioManager.playSound("music_map",!0,1,!0)):"MAP_1"===e?(a.activeMap(),t.MapState.currentInstance.mapContainer.hero.stopTakingWand(),t.AudioManager.playSound("music_map",!0,1,!0)):"MAX_MKM"===e&&(t.GameVars.slotData.needMaxMkmTutorial=!1,t.MapState.currentInstance.mapContainer.hero.stopTakingWand(),t.GameManager.writeGameData(),t.AudioManager.playSound("music_map",!0,1,!0))},a.closeDialogueTrainer=function(e){"IN"===e?a.endDialogueTrainer():(t.MapState.currentInstance.mapHUD.closeDialogue(),t.AudioManager.playSound("music_map",!0,1,!0),t.GameVars.needRemoveTrainer?t.MapState.currentInstance.mapContainer.removeTrainer():t.GameVars.needDialogueTrainer&&(t.GameVars.needDialogueTrainer=null))},a.changeLastTrainer=function(){t.MapState.currentInstance.mapContainer.changeLastTrainer()},a.checkTutorialMaxMkm=function(){t.GameVars.slotData.needMaxMkmTutorial&&t.GameVars.slotData.monsters[0]&&t.GameVars.slotData.monsters[1]&&t.GameVars.slotData.monsters[2]&&t.GameVars.slotData.monsters[3]&&t.GameVars.slotData.monsters[4]&&t.GameVars.slotData.monsters[5]&&(t.Hero.canMove=!1,a.game.time.events.add(500,(function(){t.MapState.currentInstance.mapContainer.hero.startTalkingWand(),t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.MAX_MKM,"MAX_MKM",!0),a.game.time.events.add(500,(function(){t.Hero.canMove=!0}),a)}),a))},a.typeSelected=function(a){a===t.GameConstants.ELEMENT_CLASSIC?t.GameVars.slotData.monsters[0]=t.GameManager.createMonsterFromId(t.GameConstants.START_MKM_CLASSIC,2,1):a===t.GameConstants.ELEMENT_TECH?t.GameVars.slotData.monsters[0]=t.GameManager.createMonsterFromId(t.GameConstants.START_MKM_TECH,2,1):a===t.GameConstants.ELEMENT_SPECTRE&&(t.GameVars.slotData.monsters[0]=t.GameManager.createMonsterFromId(t.GameConstants.START_MKM_SPECTRE,2,1)),t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.WAND_4,"WAND_4"),this.game.time.events.add(500,(function(){t.Hero.canMove=!0}),this)},a.monsterSelected=function(){t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.WAND_5,"WAND_5"),this.game.time.events.add(500,(function(){t.Hero.canMove=!0}),this)},a.activeWand=function(){t.MapState.currentInstance.resetTeamLayer(),t.MapState.currentInstance.mapGUI.activeWand()},a.activeItems=function(){t.MapState.currentInstance.mapGUI.activeItems()},a.activeMap=function(){t.MapState.currentInstance.mapGUI.activeMap(),t.GameManager.endMapTutorial()},a.removeTrainer=function(){for(var e=0;e<t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].trainers.length;e++)t.GameVars.needRemoveTrainer.id===t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].trainers[e].id&&(t.GameVars.slotData.state!==t.GameConstants.TUTORIAL_NO_CAPTURE&&t.GameVars.slotData.state!==t.GameConstants.TUTORIAL_MAP&&(t.GameVars.needRemoveTrainer=null),t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].trainers.splice(e,1));t.GameVars.needRemoveTrainer&&t.GameVars.slotData.state===t.GameConstants.TUTORIAL_NO_CAPTURE?a.game.time.events.add(2500,(function(){t.MapState.currentInstance.mapContainer.hero.startTalkingWand(),t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.NO_CAPTURE_1,"NO_CAPTURE_1"),a.game.time.events.add(500,(function(){t.Hero.canMove=!0}),a),t.GameVars.needRemoveTrainer=null}),a):t.GameVars.needRemoveTrainer&&t.GameVars.slotData.state===t.GameConstants.TUTORIAL_MAP&&a.game.time.events.add(2500,(function(){t.MapState.currentInstance.mapContainer.hero.startTalkingWand(),t.MapState.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.MAP_1,"MAP_1"),a.game.time.events.add(500,(function(){t.Hero.canMove=!0}),a),t.GameVars.needRemoveTrainer=null}),a),t.GameManager.writeGameData()},a.findSpawn=function(e){var s=a.heroInSpawn();if(0!==e&&s){var n=s.percent,i=s.ids,o=s.ids_level_max,r=s.ids_level_min,m=s.ids_percent;if(100!==n&&(e<2||t.Hero.heroSteps<t.GameConstants.MINIMUM_STEPS))return!1;if(Math.round(100*Math.random())<n&&!t.GameConstants.REPELENTE){for(var h=Math.round(100*Math.random()),l=m[0],c=0;l<h;)l+=m[++c];return t.GameManager.log("Nueva batalla, magikmon ["+i[c]+"]"),t.GameVars.currentSpawn=s,t.GameManager.writeGameData(),a.startFightMonster(i[c],o[c],r[c]),t.MapState.currentInstance.mapContainer.hero.stopWalk(),!0}}return!1},a.heroInSpawn=function(){for(var a=t.MapState.currentInstance.mapContainer.hero,e={x:a.x,y:a.y},s=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].spawns,n=0;n<s.length;n++)if(s[n].polygon&&t.Utils.inside(e,s[n].polygon,s[n].x,s[n].y))return s[n];return null},a.findDialogue=function(e){var s=a.heroInDialogue(!1);return!(0===e||!s)&&(t.MapState.currentInstance.mapContainer.hero.fromDialogue!==s.name&&(a.showDialogue(s),t.GameManager.writeGameData(),!0))},a.heroInDialogue=function(a){for(var e=t.MapState.currentInstance.mapContainer.hero,s={x:e.x,y:e.y},n=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dialogues,i=0;i<n.length;i++)if(n[i].polygon&&(a&&n[i].sign||!a&&!n[i].sign)&&t.Utils.inside(s,n[i].polygon,n[i].x,n[i].y))return n[i];return null},a.findTrainer=function(e,s){if(1===e&&0!==s)return!1;for(var n=t.MapState.currentInstance.mapContainer.hero,i=t.MapState.currentInstance.mapContainer.trainers,o=Math.round((n.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),r=Math.round((n.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),m=0;m<i.length;m++)if(!i[m].data.won&&o===i[m].tiledX&&r===i[m].tiledY+1)return t.MapState.currentInstance.mapContainer.hero.stopWalk(!0),t.GameManager.saveHeroPosition({x:o,y:r}),a.startFightTrainer(i[m].data),!0;return!1},a.trainerToHero=function(e,s,n){t.Hero.canMove=!1,t.MapState.currentInstance.mapContainer.hero.stopWalk();var i=t.MapState.currentInstance.mapContainer.hero;s=t.GameConstants.TILES_SIZE*s+t.GameConstants.TILES_SIZE_HALF,n=t.GameConstants.TILES_SIZE*n+t.GameConstants.TILES_SIZE_HALF;var o=Math.sqrt(Math.pow(i.x-s,2)+Math.pow(i.y-n,2)),r={x:i.x,y:i.y};r.x=Math.round((i.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),r.y=Math.round((i.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),this.game.add.tween(e).to({x:s,y:n},t.Hero.HERO_TIME*o*3,Phaser.Easing.Linear.None,!0).onComplete.add((function(){e.data.won=!0,e.data.x=e.x,e.data.y=e.y,t.GameManager.saveHeroPosition(r),a.startFightTrainer(e.data)}),this)},a.findObjectEndPath=function(){var e=a.heroInDialogue(!0);if(e)return a.showDialogue(e),t.MapState.currentInstance.mapContainer.hero.watchingSign(),void t.GameManager.writeGameData();var s=a.heroInExit();if(s){var n=t.MapState.currentInstance.mapContainer.hero.x,i=t.MapState.currentInstance.mapContainer.hero.y;"left"===s.direction?n-=t.GameConstants.TILES_SIZE:"right"===s.direction?n+=t.GameConstants.TILES_SIZE:"up"===s.direction?i-=t.GameConstants.TILES_SIZE:i+=t.GameConstants.TILES_SIZE,t.MapState.currentInstance.mapContainer.hero.moveToExit(n,i),t.GameVars.needWalk=s.direction,t.GameManager.goMapState(s.next)}},a.heroInExit=function(){for(var a=t.MapState.currentInstance.mapContainer.hero,e={x:a.x,y:a.y},s=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].exits,n=0;n<s.length;n++)if(s[n].polygon&&t.Utils.inside(e,s[n].polygon,s[n].x,s[n].y))return s[n];return null},a.showDialogue=function(e){t.MapState.currentInstance.mapContainer.hero.fromDialogue=e.name,t.GameManager.log("Estas en el dialogo: "+e.name),t.MapState.currentInstance.mapHUD.showDialogue(e),t.MapState.currentInstance.mapContainer.hero.stopWalk(),e.disable&&a.deleteDialogue(e)},a.getHeroPosition=function(){var a=new PIXI.Point(t.MapState.currentInstance.mapContainer.hero.x,t.MapState.currentInstance.mapContainer.hero.y*t.GameVars.scaleY);return this.game.world.toGlobal(a)},a.startFightMonster=function(e,s,n){t.AudioManager.stopSound("music_map",!0,!0),t.AudioManager.playSound("intro_combate"),t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPosition.x=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPrevPosition.x,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPosition.y=t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].heroPrevPosition.y,t.GameManager.writeGameData(),t.GameVars.typeFight=t.GameConstants.MONSTER_FIGHT,t.GameManager.createAdversayMonster([e],[s],[n]),t.Hero.canMove=!1,t.MapState.currentInstance.mapContainer.hero.startFight(),this.game.camera.onFadeComplete.removeAll(),this.game.camera.onFadeComplete.add((function(){a.game.state.start("FightState",!0,!1)}),this),this.game.time.events.add(1e3,(function(){this.game.camera.fade(0,500,!1)}),this)},a.startFightTrainer=function(a){var e=a.ids,s=a.ids_level;t.GameVars.typeFight=t.GameConstants.TRAINER_FIGHT,t.GameVars.currentTrainer=a,t.GameManager.createAdversayMonster(e,s,s),t.GameVars.currentTrainer.first_time?t.MapState.currentInstance.mapHUD.showTrainerDialogue(t.GameVars.trainersTexts[t.GameVars.currentTrainer.ids_text_in],"IN"):"016"===t.GameVars.currentTrainer.id&&t.GameVars.slotData.winLastTrainer?t.MapState.currentInstance.mapHUD.showTrainerDialogue(t.GameVars.trainersTexts.trainer_16_in_win,"IN"):t.MapState.currentInstance.mapHUD.showTrainerDialogue(t.GameVars.trainersTexts[t.GameVars.currentTrainer.ids_text_in_lose],"IN")},a.endDialogueTrainer=function(){t.AudioManager.playSound("intro_combate"),this.game.camera.onFadeComplete.removeAll(),this.game.camera.onFadeComplete.add((function(){a.game.state.start("FightState",!0,!1)}),this),this.game.camera.fade(0,500,!1)},a.addSpawn=function(a){var e={name:a.name,x:a.x,y:a.y,polygon:a.polygon,ids:JSON.parse(a.properties.ids),ids_level_max:JSON.parse(a.properties.ids_level_max),ids_level_min:JSON.parse(a.properties.ids_level_min),ids_percent:JSON.parse(a.properties.ids_percent),percent:parseInt(a.properties.percent),solvable:a.properties.solvable};t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].spawns.push(e)},a.addDialogue=function(a){var e={name:a.name,x:a.x,y:a.y,polygon:a.polygon,disable:a.properties.disable,random:a.properties.random,sign:a.properties.sign,ids:JSON.parse(a.properties.ids),idIndex:0};t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dialogues.push(e)},a.addExit=function(a){var e={name:a.name,x:a.x,y:a.y,polygon:a.polygon,next:a.properties.next,direction:a.properties.direction};t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].exits.push(e)},a.addTrainer=function(a){var e={id:a.properties.id,x:a.x,y:a.y,ids:JSON.parse(a.properties.ids),ids_level:JSON.parse(a.properties.ids_level),ids_text_in:a.properties.ids_text_in,ids_text_out:a.properties.ids_text_out,ids_text_in_lose:a.properties.ids_text_in_lose,ids_text_out_lose:a.properties.ids_text_out_lose,first_time:!0,won:!1};t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].trainers.push(e)},a}();t.MapManager=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return __extends(e,a),e.prototype.init=function(){e.currentInstance=this,t.MapManager.init(this.game),t.AudioManager.playSound("music_map",!0,.25,!0)},e.prototype.create=function(){this.mapLayer=null,this.mapContainer=new t.MapContainer(this.game),this.mapContainer.init(),this.add.existing(this.mapContainer),this.mapGUI=new t.MapGUI(this.game),this.add.existing(this.mapGUI),this.mapHUD=new t.MapHUD(this.game),this.add.existing(this.mapHUD),this.chapterLayer=new t.ChapterLayer(this.game),this.add.existing(this.chapterLayer),this.mapLayer=new t.MapLayer(this.game),this.add.existing(this.mapLayer),this.teamLayer=new t.TeamLayer(this.game),this.add.existing(this.teamLayer),this.mkmLayer=new t.MkmLayer(this.game),this.add.existing(this.mkmLayer),this.itemsLayer=new t.ItemsLayer(this.game),this.add.existing(this.itemsLayer),t.GameVars.needRemoveTrainer?(t.Hero.canMove=!1,"016"===t.GameVars.needRemoveTrainer.id&&t.GameVars.slotData.winLastTrainer?e.currentInstance.mapHUD.showTrainerDialogue(t.GameVars.trainersTexts.trainer_16_out_win,"OUT"):e.currentInstance.mapHUD.showTrainerDialogue(t.GameVars.trainersTexts[t.GameVars.needRemoveTrainer.ids_text_out],"OUT"),this.game.time.events.add(500,(function(){t.Hero.canMove=!0}),this)):t.GameVars.needDialogueTrainer&&(t.Hero.canMove=!1,"016"===t.GameVars.needDialogueTrainer.id&&t.GameVars.slotData.winLastTrainer?e.currentInstance.mapHUD.showTrainerDialogue(t.GameVars.trainersTexts.trainer_16_out_lose_win,"OUT"):e.currentInstance.mapHUD.showTrainerDialogue(t.GameVars.trainersTexts[t.GameVars.needDialogueTrainer.ids_text_out_lose],"OUT"),this.game.time.events.add(500,(function(){t.Hero.canMove=!0}),this)),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_WAND?(t.Hero.canMove=!1,this.game.time.events.add(500,(function(){e.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.WAND_1,"WAND_1",!0),t.Hero.canMove=!0}),this)):t.GameVars.slotData.state===t.GameConstants.TUTORIAL_HEAL?(t.Hero.canMove=!1,this.game.time.events.add(500,(function(){e.currentInstance.mapContainer.hero.startTalkingWand(),e.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.HEAL_1,"HEAL_1",!0),this.game.time.events.add(500,(function(){t.Hero.canMove=!0}),this)}),this)):t.GameVars.slotData.state===t.GameConstants.TUTORIAL_CRAFT?(e.currentInstance.startCraftTutorial(),e.currentInstance.mapContainer.hero.startTalkingWand()):t.GameVars.slotData.state===t.GameConstants.TUTORIAL_SWAP_2&&(t.Hero.canMove=!1,this.game.time.events.add(500,(function(){e.currentInstance.mapContainer.hero.startTalkingWand(),e.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.SWAP_0,"SWAP_0",!0),this.game.time.events.add(500,(function(){t.Hero.canMove=!0}),this)}),this)),(t.GameVars.needWalk||t.GameVars.slotData.state===t.GameConstants.INITIAL_BUS)&&(this.chapterLayer.show(),t.GameVars.needWalk=null),t.MapManager.checkTutorialMaxMkm()},e.prototype.update=function(){t.MapManager.checkNeedChangeMkm()},e.prototype.render=function(){t.GameConstants.FPS&&this.game.debug.text(this.game.time.fps.toString(),t.GameConstants.GAME_WIDTH-30,30,"#ffffff","20px Arial")},e.prototype.shutdown=function(){e.currentInstance=null,a.prototype.shutdown.call(this)},e.prototype.startCraftTutorial=function(){this.mapGUI.removeTween(),t.Hero.canMove=!1,this.game.time.events.add(500,(function(){e.currentInstance.mapHUD.showTutorialDialogue(t.GameVars.tutorialTexts.CRAFT_1,"CRAFT_1"),this.game.time.events.add(500,(function(){t.Hero.canMove=!0}),this)}),this)},e.prototype.showMapLayer=function(){this.mapLayer.visible=!0},e.prototype.removeMapLayer=function(){this.mapLayer.visible=!1},e.prototype.showTeamLayer=function(){this.teamLayer.show()},e.prototype.resetTeamLayer=function(){this.stage.removeChild(this.teamLayer),this.stage.removeChild(this.mkmLayer),this.stage.removeChild(this.itemsLayer),this.teamLayer=new t.TeamLayer(this.game),this.add.existing(this.teamLayer),this.mkmLayer=new t.MkmLayer(this.game),this.add.existing(this.mkmLayer),this.itemsLayer=new t.ItemsLayer(this.game),this.add.existing(this.itemsLayer)},e.prototype.removeTeamLayer=function(){this.teamLayer.visible=!1},e.prototype.showMkmLayer=function(a){this.mkmLayer.show(a),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_WAND&&this.teamLayer.removeFinger()},e.prototype.removeMkmLayer=function(){this.mkmLayer.visible=!1},e.prototype.showItemLayer=function(){this.itemsLayer.show()},e.prototype.removeItemLayer=function(){this.itemsLayer.visible=!1,this.mapGUI.removeTween()},e}(Phaser.State);t.MapState=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n){var i=a.call(this,e,null,"trainer")||this;return i.tiledX=Math.round((s.x-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),i.tiledY=Math.round((s.y-t.GameConstants.TILES_SIZE_HALF)/t.GameConstants.TILES_SIZE),i.x=t.GameConstants.TILES_SIZE*i.tiledX+t.GameConstants.TILES_SIZE_HALF,i.y=t.GameConstants.TILES_SIZE*i.tiledY+t.GameConstants.TILES_SIZE_HALF,i.data=s,i.barrier=new Phaser.Sprite(i.game,0,-t.GameConstants.TILES_SIZE,"texture_atlas_2","barrier_0001.png"),i.barrier.anchor.set(.5,.9),i.add(i.barrier),n||(i.barrier.animations.add("anim",Phaser.Animation.generateFrameNames("barrier_",1,20,".png",4)),i.barrier.play("anim",12,!0)),i.sprite=new Phaser.Sprite(i.game,0,0,"texture_atlas_1","adversary_"+s.id+".png"),i.sprite.anchor.set(.5,1),i.add(i.sprite),n||i.game.add.tween(i.sprite.scale).to({y:[.9,1],x:[1.1,1]},1e3,Phaser.Easing.Cubic.In,!0,0,-1),"016"===i.data.id&&(i.barrier.visible=!1,i.data.first_time&&(i.sprite.frameName="adversary_009.png")),i}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this)},e.prototype.removeTrainer=function(){this.tiledX=-1,this.tiledY=-1,this.game.add.tween(this.barrier.scale).to({y:0},500,Phaser.Easing.Linear.None,!0,500),this.game.add.tween(this.barrier).to({alpha:0},500,Phaser.Easing.Linear.None,!0,500),this.game.add.tween(this.sprite).to({alpha:0},500,Phaser.Easing.Linear.None,!0,1500).onStart.add((function(){var a=new Phaser.Sprite(this.game,0,-30,"texture_atlas_3","smoke_generic_01.png");a.anchor.set(.5),a.scale.set(.3),this.add(a),a.animations.add("smoke",Phaser.Animation.generateFrameNames("smoke_generic_",1,21,".png",2)),a.play("smoke",20,!1,!0),t.AudioManager.playSound("smoke_generic")}),this)},e.prototype.changeLastTrainer=function(){var a=new Phaser.Sprite(this.game,0,-30,"texture_atlas_3","smoke_generic_01.png");a.anchor.set(.5),a.scale.set(.3),this.add(a),a.animations.add("smoke",Phaser.Animation.generateFrameNames("smoke_generic_",1,21,".png",2)),a.play("smoke",20,!1,!0),t.AudioManager.playSound("smoke_generic"),this.game.time.events.add(100,(function(){this.sprite.frameName="adversary_016.png"}),this)},e}(Phaser.Group);t.Trainer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"hud")||this;if(s.fixedToCamera=!0,s.scale.y=t.GameVars.scaleY,s.topLayer=s.create(0,0,s.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),s.topLayer.scale.set(t.GameConstants.GAME_WIDTH/t.GameConstants.BITMAP_SIZE,95/t.GameConstants.BITMAP_SIZE),s.topLayer.alpha=.8,s.topLayer.tint=794674,s.add(s.topLayer),s.menuButton=new Phaser.Button(s.game,0,0,"texture_atlas_1",s.onClickMenu,s),s.menuButton.setFrames("btn_menu.png","btn_menu.png","btn_menu.png"),s.menuButton.events.onInputDown.add(s.onButtonDown,s),s.menuButton.events.onInputOut.add(s.onOut,s),s.menuButton.events.onInputOver.add(s.onOver,s),s.menuButton.forceOut=!0,s.add(s.menuButton),t.GameVars.slotData.state<t.GameConstants.TUTORIAL_FINISHED&&(s.tutorialAnim=new Phaser.Image(s.game,270,40,"texture_atlas_1","resalte_btn_tutorial.png"),s.tutorialAnim.anchor.set(.5),s.tutorialAnim.scale.set(1.1),s.tutorialAnim.visible=!1,s.add(s.tutorialAnim)),s.mapButton=new Phaser.Button(s.game,270,40,"texture_atlas_1",s.onClickPause,s),s.mapButton.setFrames("btn_map.png","btn_map.png","btn_map.png"),s.mapButton.events.onInputDown.add(s.onButtonDown,s),s.mapButton.events.onInputOut.add(s.onOut,s),s.mapButton.events.onInputOver.add(s.onOver,s),s.mapButton.anchor.set(.5),s.mapButton.forceOut=!0,s.add(s.mapButton),s.itemsButton=new Phaser.Button(s.game,190,40,"texture_atlas_1",s.onClickItems,s),s.itemsButton.setFrames("btn_crafting.png","btn_crafting.png","btn_crafting.png"),s.itemsButton.events.onInputDown.add(s.onButtonDown,s),s.itemsButton.events.onInputOut.add(s.onOut,s),s.itemsButton.events.onInputOver.add(s.onOver,s),s.itemsButton.anchor.set(.5),s.itemsButton.forceOut=!0,s.add(s.itemsButton),s.teamButton=new Phaser.Button(s.game,110,40,"texture_atlas_1",s.onClickTeam,s),s.teamButton.setFrames("btn_wand.png","btn_wand.png","btn_wand.png"),s.teamButton.events.onInputDown.add(s.onButtonDown,s),s.teamButton.events.onInputOut.add(s.onOut,s),s.teamButton.events.onInputOver.add(s.onOver,s),s.teamButton.anchor.set(.5),s.teamButton.forceOut=!0,s.add(s.teamButton),s.attention=new Phaser.Image(s.game,137,72,"texture_atlas_1","icon_attention.png"),s.attention.scale.set(.85),s.attention.anchor.set(.5),s.add(s.attention),s.wispTab=new Phaser.Image(s.game,330,22,"texture_atlas_1","tab_wisps.png"),s.add(s.wispTab),s.wispText=new Phaser.Text(s.game,427,54,t.Utils.validNumber(t.GameVars.slotData.wisp),{font:"24px Chewy",fontWeight:"400",fill:"#59ffff"}),s.wispText.anchor.set(1,.5),s.add(s.wispText),t.GameConstants.DEVELOPMENT){var n=new Phaser.Button(s.game,390,47,"texture_atlas_1",s.onClickAttacks,s);n.setFrames("btn_attacks_state.png","btn_attacks_state.png","btn_attacks_state.png"),n.anchor.set(.5),n.forceOut=!0,s.add(n)}s.teamButton.visible=!1,s.itemsButton.visible=!1,s.mapButton.visible=!1,s.attention.visible=!1,s.wispTab.visible=!1,s.wispText.visible=!1,t.GameVars.slotData.state>t.GameConstants.TUTORIAL_WAND&&(s.teamButton.visible=!0),t.GameVars.slotData.state>t.GameConstants.TUTORIAL_HEAL&&(s.attention.visible=!0),t.GameVars.slotData.state>t.GameConstants.TUTORIAL_CRAFT&&(s.itemsButton.visible=!0,s.wispTab.visible=!0,s.wispText.visible=!0),t.GameVars.slotData.state>t.GameConstants.TUTORIAL_MAP&&(s.mapButton.visible=!0);var i=s.game.add.tween(s.attention.scale).to({x:.95,y:.95},250,Phaser.Easing.Quintic.In),o=s.game.add.tween(s.attention.scale).to({x:.85,y:.85},250,Phaser.Easing.Quintic.In);return i.chain(o),o.chain(i),i.start(),s.alpha=0,s.game.add.tween(s).to({alpha:1},1e3,Phaser.Easing.Cubic.Out,!0,500),t.GameVars.slotData.wisp>=100&&t.GameVars.slotData.state>t.GameConstants.TUTORIAL_CRAFT&&s.game.time.events.loop(3e3,(function(){this.game.add.tween(this.itemsButton.scale).to({x:[1.05,1,1.05,1],y:[1.05,1,1.05,1]},1e3,Phaser.Easing.Cubic.Out,!0)}),s),s}return __extends(e,a),e.prototype.showSelectionType=function(){this.containerClassic=new Phaser.Group(this.game),this.containerClassic.x=85,this.containerClassic.y=250,this.add(this.containerClassic);var a=new Phaser.Image(this.game,0,0,"texture_atlas_2","office_classic.png");a.anchor.set(.5),a.name=t.GameConstants.ELEMENT_CLASSIC,a.events.onInputDown.add(this.typeSelected,this),a.events.onInputOver.add(this.typeOver,this),a.events.onInputOut.add(this.typeOut,this),a.scale.set(.65),this.containerClassic.add(a);var e=new Phaser.Text(this.game,0,75,t.GameVars.names.TEACHER,{font:"28px Chewy",fontWeight:"400",fill:"#ff9c50"});e.stroke="#40241D",e.strokeThickness=6,e.anchor.set(.5),this.containerClassic.add(e),this.containerTech=new Phaser.Group(this.game),this.containerTech.x=t.GameConstants.GAME_WIDTH/2,this.containerTech.y=250,this.add(this.containerTech);var s=new Phaser.Image(this.game,0,0,"texture_atlas_2","office_tech.png");s.anchor.set(.5),s.name=t.GameConstants.ELEMENT_TECH,s.events.onInputDown.add(this.typeSelected,this),s.events.onInputOver.add(this.typeOver,this),s.events.onInputOut.add(this.typeOut,this),s.scale.set(.65),this.containerTech.add(s);var n=new Phaser.Text(this.game,0,75,t.GameVars.names.SCIENTIST,{font:"28px Chewy",fontWeight:"400",fill:"#00dfa9"});n.stroke="#102932",n.strokeThickness=6,n.anchor.set(.5),this.containerTech.add(n),this.containerSpectre=new Phaser.Group(this.game),this.containerSpectre.x=t.GameConstants.GAME_WIDTH-85,this.containerSpectre.y=250,this.add(this.containerSpectre);var i=new Phaser.Image(this.game,0,0,"texture_atlas_2","office_spectre.png");i.anchor.set(.5),i.name=t.GameConstants.ELEMENT_SPECTRE,i.events.onInputDown.add(this.typeSelected,this),i.events.onInputOver.add(this.typeOver,this),i.events.onInputOut.add(this.typeOut,this),i.scale.set(.65),this.containerSpectre.add(i);var o=new Phaser.Text(this.game,0,75,t.GameVars.names.FIREMAN,{font:"28px Chewy",fontWeight:"400",fill:"#b9a8ff"});o.stroke="#300949",o.strokeThickness=6,o.anchor.set(.5),this.containerSpectre.add(o),this.containerClassic.alpha=0,this.containerTech.alpha=0,this.containerSpectre.alpha=0,this.containerClassic.scale.set(0),this.containerTech.scale.set(0),this.containerSpectre.scale.set(0),this.game.add.tween(this.containerClassic).to({alpha:1},250,Phaser.Easing.Linear.None,!0,500),this.game.add.tween(this.containerTech).to({alpha:1},250,Phaser.Easing.Linear.None,!0,1e3),this.game.add.tween(this.containerSpectre).to({alpha:1},250,Phaser.Easing.Linear.None,!0,1500),this.game.add.tween(this.containerClassic.scale).to({x:1,y:1},500,Phaser.Easing.Elastic.Out,!0,500),this.game.add.tween(this.containerTech.scale).to({x:1,y:1},500,Phaser.Easing.Elastic.Out,!0,750),this.game.add.tween(this.containerSpectre.scale).to({x:1,y:1},500,Phaser.Easing.Elastic.Out,!0,1e3).onComplete.add((function(){a.inputEnabled=!0,s.inputEnabled=!0,i.inputEnabled=!0}),this)},e.prototype.typeOver=function(t){t.scale.set(.7)},e.prototype.typeOut=function(t){t.scale.set(.65)},e.prototype.typeSelected=function(a){this.game.add.tween(this.containerClassic.scale).to({x:0,y:0},250,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.containerTech.scale).to({x:0,y:0},250,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.containerSpectre.scale).to({x:0,y:0},250,Phaser.Easing.Cubic.In,!0).onComplete.add((function(){this.containerClassic.visible=!1,this.containerTech.visible=!1,this.containerSpectre.visible=!1}),this),t.MapManager.typeSelected(a.name)},e.prototype.showSelectedMonster=function(){this.backgroundMonster=new Phaser.Image(this.game,0,0,this.game.cache.getBitmapData(t.GameConstants.BLACK_SQUARE)),this.backgroundMonster.scale.set(t.GameConstants.GAME_WIDTH/t.GameConstants.BITMAPDATA_SIZE,t.GameConstants.GAME_HEIGHT/t.GameConstants.BITMAPDATA_SIZE),this.backgroundMonster.alpha=.01,this.backgroundMonster.inputEnabled=!0,this.backgroundMonster.events.onInputDown.add(this.monsterClicked,this),this.add(this.backgroundMonster),this.circle=new Phaser.Image(this.game,t.GameConstants.GAME_WIDTH/2,250,"texture_atlas_2","current_mkm_"+t.GameVars.slotData.monsters[0].class+".png"),this.circle.anchor.set(.5),this.circle.alpha=0,this.add(this.circle),this.monsterTutorial=new Phaser.Image(this.game,t.GameConstants.GAME_WIDTH/2,250,"texture_atlas_4","mkm_"+t.GameVars.slotData.monsters[0].id+"_front.png"),this.monsterTutorial.anchor.set(.5),this.monsterTutorial.alpha=0,this.add(this.monsterTutorial),this.game.add.tween(this.circle).to({angle:360},1e4,Phaser.Easing.Linear.None,!0,0,-1),this.circle.scale.set(0),this.monsterTutorial.scale.set(0),this.game.add.tween(this.circle).to({alpha:1},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.monsterTutorial).to({alpha:1},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.circle.scale).to({x:1,y:1},1e3,Phaser.Easing.Elastic.Out,!0),this.game.add.tween(this.monsterTutorial.scale).to({x:1,y:1},1e3,Phaser.Easing.Elastic.Out,!0)},e.prototype.monsterClicked=function(){this.game.add.tween(this.circle).to({x:110,y:50},500,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.circle).to({alpha:0},1e3,Phaser.Easing.Quadratic.In,!0),this.game.add.tween(this.circle.scale).to({x:.1,y:.1},500,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.monsterTutorial).to({x:110,y:50},500,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.monsterTutorial).to({alpha:0},1e3,Phaser.Easing.Quadratic.In,!0),this.game.add.tween(this.monsterTutorial.scale).to({x:.1,y:.1},500,Phaser.Easing.Cubic.In,!0).onComplete.add((function(){this.monsterTutorial.visible=!1,this.circle.visible=!1,this.backgroundMonster.visible=!1,t.MapManager.monsterSelected()}),this)},e.prototype.showSwap1=function(){this.swapContainer=new Phaser.Group(this.game),this.swapContainer.x=t.GameConstants.GAME_WIDTH/2,this.swapContainer.y=t.GameConstants.GAME_HEIGHT/2,this.swapContainer.scale.set(0),this.add(this.swapContainer),this.swapLight=new Phaser.Image(this.game,0,0,"texture_atlas_1","fx_radial_rays.png"),this.swapLight.anchor.set(.5),this.swapLight.scale.set(0),this.swapContainer.add(this.swapLight),this.swapCirle1=new Phaser.Image(this.game,0,0,"texture_atlas_2","current_mkm_classic.png"),this.swapCirle1.anchor.set(.5),this.swapContainer.add(this.swapCirle1),this.swapCirle2=new Phaser.Image(this.game,0,0,"texture_atlas_2","current_mkm_spectre.png"),this.swapCirle2.anchor.set(.5),this.swapCirle2.alpha=0,this.swapContainer.add(this.swapCirle2),this.swapCirle3=new Phaser.Image(this.game,0,0,"texture_atlas_2","current_mkm_tech.png"),this.swapCirle3.anchor.set(.5),this.swapCirle3.alpha=0,this.swapContainer.add(this.swapCirle3),this.swapPart1=new Phaser.Image(this.game,0,0,"texture_atlas_1","icon_class_classic.png"),this.swapPart1.anchor.set(.5),this.swapContainer.add(this.swapPart1),this.swapPart2=new Phaser.Image(this.game,0,0,"texture_atlas_1","icon_class_spectre.png"),this.swapPart2.anchor.set(.5),this.swapPart2.alpha=.75,this.swapContainer.add(this.swapPart2),this.swapPart3=new Phaser.Image(this.game,0,0,"texture_atlas_1","icon_class_tech.png"),this.swapPart3.anchor.set(.5),this.swapPart3.alpha=.75,this.swapContainer.add(this.swapPart3),this.swapMkm1=new Phaser.Image(this.game,0,-140,"texture_atlas_4","mkm_"+t.GameConstants.START_MKM_CLASSIC+"_front.png"),this.swapMkm1.scale.set(.5),this.swapMkm1.anchor.set(.5),this.swapMkm1.alpha=0,this.swapContainer.add(this.swapMkm1),this.swapMkm2=new Phaser.Image(this.game,120,20,"texture_atlas_4","mkm_"+t.GameConstants.START_MKM_SPECTRE+"_front.png"),this.swapMkm2.scale.set(.5),this.swapMkm2.anchor.set(.5),this.swapMkm2.alpha=0,this.swapContainer.add(this.swapMkm2),this.swapCapsule=new Phaser.Image(this.game,-230,-210,"texture_atlas_1","monster-capsule-classic.png"),this.swapCapsule.alpha=0,this.swapCapsule.scale.set(.8),this.swapContainer.add(this.swapCapsule),this.swapName=new Phaser.Text(this.game,-160,-180,t.GameVars.names.CLASSIC.replace("Á","A"),{font:"18px Goonies",fill:"#FFFFFF",align:"center"}),this.swapName.alpha=0,this.swapName.anchor.set(.5),this.swapName.font="Pythia",this.swapName.fill="#5b473c",this.swapContainer.add(this.swapName),this.game.add.tween(this.swapContainer.scale).to({x:1,y:1},1e3,Phaser.Easing.Elastic.Out,!0),this.game.add.tween(this.swapMkm1).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0,1e3),this.game.add.tween(this.swapMkm2).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0,1e3),this.game.add.tween(this.swapCapsule).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0,1e3),this.game.add.tween(this.swapName).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0,1e3),this.game.add.tween(this.swapCirle1).to({angle:360},1e4,Phaser.Easing.Linear.None,!0,0,-1),this.game.add.tween(this.swapCirle2).to({angle:360},1e4,Phaser.Easing.Linear.None,!0,0,-1),this.game.add.tween(this.swapCirle3).to({angle:360},1e4,Phaser.Easing.Linear.None,!0,0,-1),this.swapLight.tint=16751696,this.game.add.tween(this.swapLight.scale).to({x:1.5,y:1.5},500,Phaser.Easing.Cubic.Out,!0,250).onComplete.add((function(){this.game.add.tween(this.swapLight.scale).to({x:0,y:0},500,Phaser.Easing.Cubic.In,!0,100),this.game.add.tween(this.swapLight).to({alpha:0},500,Phaser.Easing.Cubic.In,!0)}),this)},e.prototype.showSwap2=function(){this.swapLight.tint=57257,this.swapLight.alpha=1,this.game.add.tween(this.swapLight.scale).to({x:1.5,y:1.5},500,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){this.game.add.tween(this.swapLight.scale).to({x:0,y:0},500,Phaser.Easing.Cubic.In,!0,100),this.game.add.tween(this.swapLight).to({alpha:0},500,Phaser.Easing.Cubic.In,!0)}),this),this.game.add.tween(this.swapCirle1).to({alpha:0},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapCapsule).to({alpha:0},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapName).to({alpha:0},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapCirle3).to({alpha:1},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapPart1).to({alpha:.75},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapPart2).to({alpha:.75},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapPart3).to({alpha:1},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapPart1).to({angle:120},2e3,Phaser.Easing.Elastic.Out,!0),this.game.add.tween(this.swapPart2).to({angle:120},2e3,Phaser.Easing.Elastic.Out,!0),this.game.add.tween(this.swapPart3).to({angle:120},2e3,Phaser.Easing.Elastic.Out,!0),this.game.add.tween(this.swapMkm1).to({alpha:0},500,Phaser.Easing.Linear.None,!0).onComplete.add((function(){this.swapMkm1.frameName="mkm_"+t.GameConstants.START_MKM_TECH+"_front.png",this.game.add.tween(this.swapMkm1).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapCapsule).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapName).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.swapCapsule.frameName="monster-capsule-tech.png",this.swapName.text=t.GameVars.names.TECH,this.swapName.font="Adineue",this.swapName.fill="#ffffff"}),this),this.game.add.tween(this.swapMkm2).to({alpha:0},500,Phaser.Easing.Linear.None,!0).onComplete.add((function(){this.swapMkm2.frameName="mkm_"+t.GameConstants.START_MKM_CLASSIC+"_front.png",this.game.add.tween(this.swapMkm2).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0)}),this)},e.prototype.showSwap3=function(){this.swapLight.tint=12167423,this.swapLight.alpha=1,this.game.add.tween(this.swapLight.scale).to({x:1.5,y:1.5},500,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){this.game.add.tween(this.swapLight.scale).to({x:0,y:0},500,Phaser.Easing.Cubic.In,!0,100),this.game.add.tween(this.swapLight).to({alpha:0},500,Phaser.Easing.Cubic.In,!0)}),this),this.game.add.tween(this.swapCapsule).to({alpha:0},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapName).to({alpha:0},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapCirle3).to({alpha:0},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapCirle2).to({alpha:1},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapPart1).to({alpha:.75},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapPart2).to({alpha:1},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapPart3).to({alpha:.75},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapPart1).to({angle:240},2e3,Phaser.Easing.Elastic.Out,!0),this.game.add.tween(this.swapPart2).to({angle:240},2e3,Phaser.Easing.Elastic.Out,!0),this.game.add.tween(this.swapPart3).to({angle:240},2e3,Phaser.Easing.Elastic.Out,!0),this.game.add.tween(this.swapMkm1).to({alpha:0},500,Phaser.Easing.Linear.None,!0).onComplete.add((function(){this.swapMkm1.frameName="mkm_"+t.GameConstants.START_MKM_SPECTRE+"_front.png",this.game.add.tween(this.swapMkm1).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapCapsule).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapName).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.swapCapsule.frameName="monster-capsule-spectre.png",this.swapName.text=t.GameVars.names.SPECTRE,this.swapName.font="Goonies",this.swapName.fill="#2a3147"}),this),this.game.add.tween(this.swapMkm2).to({alpha:0},500,Phaser.Easing.Linear.None,!0).onComplete.add((function(){this.swapMkm2.frameName="mkm_"+t.GameConstants.START_MKM_TECH+"_front.png",this.game.add.tween(this.swapMkm2).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0)}),this)},e.prototype.removeSwap=function(){this.game.add.tween(this.swapMkm1).to({alpha:0},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapMkm2).to({alpha:0},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapCapsule).to({alpha:0},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapName).to({alpha:0},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.swapContainer.scale).to({x:0,y:0},1e3,Phaser.Easing.Elastic.In,!0).onComplete.add((function(){this.swapContainer.visible=!1}),this)},e.prototype.needChangeMkm=function(a){this.mapButton.alpha=1,this.mapButton.inputEnabled=!0,this.itemsButton.alpha=1,this.itemsButton.inputEnabled=!0,this.game.tweens.remove(this.tweenTeam),a&&t.GameVars.slotData.state>t.GameConstants.TUTORIAL_HEAL?this.attention.visible=!0:this.attention.visible=!1},e.prototype.showWand=function(){this.teamButton.visible=!0,this.teamButton.alpha=0,this.game.add.tween(this.teamButton).to({alpha:.5},250,Phaser.Easing.Linear.None,!0),this.teamButton.inputEnabled=!1},e.prototype.activeWand=function(){this.game.add.tween(this.teamButton).to({alpha:1},250,Phaser.Easing.Linear.None,!0),this.tutorialTween=this.game.add.tween(this.teamButton.scale).to({x:[1.1,1],y:[1.1,1]},500,Phaser.Easing.Linear.None,!0,0,-1),this.tutorialAnim.x=this.teamButton.x,this.tutorialAnim.y=this.teamButton.y+10,this.tutorialAnim.visible=!0,this.tutorialTween2=this.game.add.tween(this.tutorialAnim.scale).to({x:[1,1.1],y:[1,1.1]},500,Phaser.Easing.Linear.None,!0,0,-1),this.teamButton.inputEnabled=!0},e.prototype.activeItems=function(){this.itemsButton.visible=!0,this.wispTab.visible=!0,this.wispText.visible=!0,this.itemsButton.alpha=0,this.wispTab.alpha=0,this.wispText.alpha=0,this.game.add.tween(this.itemsButton).to({alpha:1},250,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.wispTab).to({alpha:1},250,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.wispText).to({alpha:1},250,Phaser.Easing.Linear.None,!0),this.tutorialTween=this.game.add.tween(this.itemsButton.scale).to({x:[1.1,1],y:[1.1,1]},500,Phaser.Easing.Linear.None,!0,0,-1),this.tutorialAnim.x=this.itemsButton.x,this.tutorialAnim.y=this.itemsButton.y+10,this.tutorialAnim.visible=!0,this.tutorialTween2?(this.tutorialTween2.stop(),this.tutorialAnim.scale.set(1.1),this.tutorialTween2=this.game.add.tween(this.tutorialAnim.scale).to({x:[1,1.1],y:[1,1.1]},500,Phaser.Easing.Linear.None,!0,0,-1)):this.tutorialTween2=this.game.add.tween(this.tutorialAnim.scale).to({x:[1,1.1],y:[1,1.1]},500,Phaser.Easing.Linear.None,!0,0,-1)},e.prototype.activeMap=function(){this.mapButton.visible=!0,this.mapButton.alpha=0,this.game.add.tween(this.mapButton).to({alpha:1},250,Phaser.Easing.Linear.None,!0)},e.prototype.removeTween=function(){this.wispText.text=t.Utils.validNumber(t.GameVars.slotData.wisp),this.tutorialTween&&this.tutorialTween.stop(),this.tutorialAnim.visible=!1,this.teamButton.scale.set(1),this.itemsButton.scale.set(1)},e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),a.scale.set(1.1)},e.prototype.onClickMenu=function(){this.menuButton.scale.set(1),t.GameManager.backHome()},e.prototype.onClickPause=function(){this.mapButton.scale.set(1),t.MapManager.showMapLayer()},e.prototype.onClickTeam=function(){t.GameVars.slotData.state===t.GameConstants.TUTORIAL_WAND&&this.removeTween(),this.teamButton.scale.set(1),t.MapManager.showTeamLayer()},e.prototype.onClickItems=function(){this.itemsButton.scale.set(1),t.MapManager.showItemsLayer()},e.prototype.onClickAttacks=function(){t.GameManager.goAttacksState()},e.prototype.onOut=function(t){t.scale.set(1)},e.prototype.onOver=function(t){t.scale.set(1.05)},e}(Phaser.Group);t.MapGUI=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n){var i=a.call(this,e,null,"dialogue")||this;i.wait=!1,i.x=s,i.y=n,i.scale.y=t.GameVars.scaleY,i.visible=!1,i.idTutorial=0,i.idTrainer=0,i.image=new Phaser.Image(i.game,0,-90,"texture_atlas_1","hero_avatar.png"),i.image.anchor.set(0,1),i.add(i.image),i.characterName=new Phaser.Text(i.game,100,-90,"",{font:"20px Chewy",fill:"#72ffff",align:"center"}),i.characterName.anchor.set(0,1),i.characterName.stroke="#1A2536",i.characterName.strokeThickness=6,i.add(i.characterName);var o=new Phaser.Image(i.game,0,0,i.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));return o.tint=1713462,o.anchor.set(0,1),o.alpha=.9,o.scale.set(t.GameConstants.GAME_WIDTH/t.GameConstants.BITMAP_SIZE,90/t.GameConstants.BITMAP_SIZE),i.add(o),i.text=new Phaser.Text(i.game,t.GameConstants.GAME_WIDTH/2+5,-45,"",{font:"19px DosisBold",fill:"#dbefef",fontWeight:400,align:"center"}),i.text.wordWrap=!0,i.text.wordWrapWidth=440,i.text.lineSpacing=-5,i.text.anchor.set(.5),i.add(i.text),i}return __extends(e,a),e.prototype.showTutorialDialogue=function(a,e,s){this.wait=!1,this.game.time.events.add(500,(function(){this.wait=!0}),this),t.AudioManager.playSound("music_dialogue",!0,1,!0),t.AudioManager.playSound("fx_speak"),this.tutorialDialogue=a,this.dialogue=null,this.trainersDialogue=null,this.visible=!0,s&&(this.y=t.GameConstants.GAME_HEIGHT+200,this.game.add.tween(this).to({y:t.GameConstants.GAME_HEIGHT},500,Phaser.Easing.Cubic.Out,!0)),this.idTutorial=0,this.value=e,this.selectTutorialImage(),this.text.text=this.tutorialDialogue[this.idTutorial].text,this.idTutorial++,t.GameVars.slotData.monsters[0]&&(this.text.text=this.text.text.replace("*type*",t.GameVars.slotData.monsters[0].class),this.text.text=this.text.text.replace("*name*",t.GameVars.slotData.monsters[0].name))},e.prototype.showTrainerDialogue=function(a,e){this.wait=!1,this.game.time.events.add(500,(function(){this.wait=!0}),this),t.AudioManager.playSound("music_dialogue",!0,1,!0),t.AudioManager.playSound("fx_speak"),this.trainersDialogue=a,this.dialogue=null,this.tutorialDialogue=null,this.visible=!0,"OUT"===e&&(this.y=t.GameConstants.GAME_HEIGHT+200,this.game.add.tween(this).to({y:t.GameConstants.GAME_HEIGHT},500,Phaser.Easing.Cubic.Out,!0,500)),this.idTrainer=0,this.value=e,this.selectTrainerImage(),this.text.text=this.trainersDialogue[this.idTrainer].text,this.idTrainer++},e.prototype.showDialogue=function(a){var e;this.wait=!1,this.game.time.events.add(500,(function(){this.wait=!0}),this),t.AudioManager.playSound("fx_speak"),this.image.frameName="hero_avatar.png",this.image.x=0,this.characterName.text=t.GameVars.names.ANDER,this.characterName.anchor.set(0,1),this.characterName.x=100,this.dialogue=a,this.tutorialDialogue=null,this.trainersDialogue=null,this.visible=!0,a.random?e=Math.round(Math.random()*a.ids.length):(e=a.ids[a.idIndex],a.idIndex++),this.text.text=t.GameVars.dialoguesText[t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].tilemapName][e],this.y=t.GameConstants.GAME_HEIGHT+200,this.game.add.tween(this).to({y:t.GameConstants.GAME_HEIGHT},500,Phaser.Easing.Cubic.Out,!0)},e.prototype.nextDialogue=function(){if(this.wait){if(this.wait=!1,this.game.time.events.add(500,(function(){this.wait=!0}),this),this.dialogue)if(this.dialogue.idIndex>=this.dialogue.ids.length||this.dialogue.random)this.dialogue.idIndex=0,this.dialogue=null,t.MapManager.closeDialogue();else{var a=this.dialogue.ids[this.dialogue.idIndex];this.dialogue.idIndex++,this.text.text=t.GameVars.dialoguesText[t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].tilemapName][a]}else this.tutorialDialogue?this.idTutorial>=this.tutorialDialogue.length?t.MapManager.closeDialogueTutorial(this.value):(this.selectTutorialImage(),this.text.text=this.tutorialDialogue[this.idTutorial].text,this.idTutorial++):this.trainersDialogue&&(this.idTrainer>=this.trainersDialogue.length?t.MapManager.closeDialogueTrainer(this.value):(this.selectTrainerImage(),t.GameVars.currentTrainer&&"016"===t.GameVars.currentTrainer.id&&t.GameVars.currentTrainer.first_time&&2===this.idTrainer&&t.MapManager.changeLastTrainer(),this.text.text=this.trainersDialogue[this.idTrainer].text,this.idTrainer++));t.AudioManager.playSound("fx_speak")}},e.prototype.selectTutorialImage=function(){"Ander"===this.tutorialDialogue[this.idTutorial].id?(this.image.frameName="hero_avatar.png",this.image.x=0,this.characterName.text=t.GameVars.names.ANDER,this.characterName.anchor.set(0,1),this.characterName.x=100):"Varita"===this.tutorialDialogue[this.idTutorial].id&&(this.image.frameName="varita_avatar.png",this.image.x=t.GameConstants.GAME_WIDTH-this.image.width,this.characterName.text=t.GameVars.names.VARITA,this.characterName.anchor.set(1),this.characterName.x=t.GameConstants.GAME_WIDTH-100)},e.prototype.selectTrainerImage=function(){"Ander"===this.trainersDialogue[this.idTrainer].id?(this.image.frameName="hero_avatar.png",this.image.x=0,this.characterName.text=t.GameVars.names.ANDER,this.characterName.anchor.set(0,1),this.characterName.x=100):"Trainer"===this.trainersDialogue[this.idTrainer].id&&(t.GameVars.currentTrainer?(this.image.frameName="adversary_avatar_"+t.GameVars.currentTrainer.id+".png",this.characterName.text=" "+t.GameVars.trainersNames[t.GameVars.currentTrainer.id].toUpperCase()+" ","016"===t.GameVars.currentTrainer.id&&t.GameVars.currentTrainer.first_time&&this.idTrainer<2&&(this.image.frameName="adversary_avatar_009.png",this.characterName.text=" "+t.GameVars.trainersNames["009"].toUpperCase()+" ")):t.GameVars.needRemoveTrainer?(this.image.frameName="adversary_avatar_"+t.GameVars.needRemoveTrainer.id+".png",this.characterName.text=" "+t.GameVars.trainersNames[t.GameVars.needRemoveTrainer.id].toUpperCase()+" "):(this.image.frameName="adversary_avatar_"+t.GameVars.needDialogueTrainer.id+".png",this.characterName.text=" "+t.GameVars.trainersNames[t.GameVars.needDialogueTrainer.id].toUpperCase()+" "),this.image.x=t.GameConstants.GAME_WIDTH-this.image.width,this.characterName.anchor.set(1),this.characterName.x=t.GameConstants.GAME_WIDTH-100)},e}(Phaser.Group);t.DialogueHUD=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"hud")||this;return s.fixedToCamera=!0,t.GameConstants.FPS&&(s.fps=new Phaser.Text(s.game,t.GameConstants.GAME_WIDTH-10,10,"",{font:"20px Chewy",fontWeight:"400",fill:"#ffffff"}),s.fps.anchor.set(1,0),s.add(s.fps)),s.dialogue=new t.DialogueHUD(s.game,0,t.GameConstants.GAME_HEIGHT),s.add(s.dialogue),s}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this)},e.prototype.showDialogue=function(t){this.dialogue.showDialogue(t)},e.prototype.showTutorialDialogue=function(t,a,e){this.dialogue.showTutorialDialogue(t,a,e)},e.prototype.showTrainerDialogue=function(t,a){this.dialogue.showTrainerDialogue(t,a)},e.prototype.dialogueOpen=function(){return this.dialogue.visible},e.prototype.nextDialogue=function(){this.dialogue.nextDialogue()},e.prototype.closeDialogue=function(){this.dialogue.visible=!1},e}(Phaser.Group);t.MapHUD=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i,o){var r=a.call(this,e,null,"team-layer")||this;r.x=s,r.y=n,r.i=i,r.scale.y=t.GameVars.scaleY,r.itemsLayer=o,r.createNameNum(),r.buttonContainer=new Phaser.Group(r.game),r.add(r.buttonContainer),r.image=new Phaser.Image(r.game,0,0,"texture_atlas_"+t.GameVars.gameData.language,"btn_item_"+r.name+".png"),r.image.anchor.set(.5),r.image.inputEnabled=!0,r.image.events.onInputDown.add(r.onDown,r),r.image.events.onInputUp.add(r.craftItem,r),r.image.events.onInputOut.add(r.onOut,r),r.image.events.onInputOver.add(r.onOver,r),r.buttonContainer.add(r.image),r.circle=new Phaser.Image(r.game,0,0,"texture_atlas_1","circle_num_items.png"),r.circle.anchor.set(.5),r.buttonContainer.add(r.circle),r.numText=new Phaser.Text(r.game,59,-17,t.Utils.validNumber(r.num),{font:"22px Chewy",fontWeight:"400",fill:"#00427f"}),r.numText.anchor.set(.5),r.buttonContainer.add(r.numText),r.particles=new Phaser.Image(r.game,59,-18,"texture_atlas_1","particles_fx_01.png"),r.particles.visible=!1,r.particles.anchor.set(.5),r.buttonContainer.add(r.particles),r.particles.animations.add("anim",Phaser.Animation.generateFrameNames("particles_fx_",1,14,".png",2)).onComplete.add((function(){this.particles.visible=!1}),r);var m=new Phaser.Image(r.game,25,58,"texture_atlas_2","icon_wisp.png");m.anchor.set(.5),m.scale.set(.5),r.add(m),r.priceText=new Phaser.Text(r.game,10,60,t.Utils.validNumber(t.GameConstants.ITEM_PRICES[r.i]),{font:"18px Chewy",fontWeight:"400",fill:"#59ffff"}),r.priceText.anchor.set(1,.5),r.add(r.priceText);var h=r.create(0,85,r.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));h.anchor.set(.5),h.tint=12637,h.scale.set(235/t.GameConstants.BITMAP_SIZE,30/t.GameConstants.BITMAP_SIZE),r.add(h);var l=new Phaser.Text(r.game,0,88,t.GameVars.itemsTexts[r.i],{font:"18px Chewy",fontWeight:"400",fill:"#009eff"});return l.anchor.set(.5),r.add(l),r.checkPrice(),r}return __extends(e,a),e.prototype.checkPrice=function(){this.buttonContainer.scale.set(1),t.GameVars.slotData.wisp<t.GameConstants.ITEM_PRICES[this.i]?this.disable():this.enable()},e.prototype.onDown=function(){this.buttonContainer.scale.set(1.1)},e.prototype.craftItem=function(){this.buttonContainer.scale.set(1),t.GameVars.slotData.wisp-=t.GameConstants.ITEM_PRICES[this.i],this.newItemCrafted(),this.particles.visible=!0,this.particles.play("anim",24,!1),this.itemsLayer.itemCrafted(),t.AudioManager.playSound("fx_buy_item"),this.updateNum()},e.prototype.disable=function(){this.image.inputEnabled=!1,this.image.alpha=.5,this.priceText.fill="#e92c4f"},e.prototype.enable=function(){this.image.inputEnabled=!0,this.image.alpha=1,this.priceText.fill="#59ffff"},e.prototype.createNameNum=function(){switch(this.i){case 0:this.name="capture",this.num=t.GameVars.slotData.items.ball;break;case 1:this.name="heal",this.num=t.GameVars.slotData.items.healing;break;case 2:this.name="antidote",this.num=t.GameVars.slotData.items.antidote;break;case 3:this.name="focus",this.num=t.GameVars.slotData.items.hypnoCure;break;case 4:this.name="attack",this.num=t.GameVars.slotData.items.attackIncrease;break;case 5:this.name="defense",this.num=t.GameVars.slotData.items.defenseIncrease;break;case 6:this.name="aim",this.num=t.GameVars.slotData.items.aimingIncrease}},e.prototype.updateNum=function(){this.numText.text=t.Utils.validNumber(this.num)},e.prototype.newItemCrafted=function(){switch(this.i){case 0:t.GameVars.slotData.items.ball++,this.num=t.GameVars.slotData.items.ball;break;case 1:t.GameVars.slotData.items.healing++,this.num=t.GameVars.slotData.items.healing;break;case 2:t.GameVars.slotData.items.antidote++,this.num=t.GameVars.slotData.items.antidote;break;case 3:t.GameVars.slotData.items.hypnoCure++,this.num=t.GameVars.slotData.items.hypnoCure;break;case 4:t.GameVars.slotData.items.attackIncrease++,this.num=t.GameVars.slotData.items.attackIncrease;break;case 5:t.GameVars.slotData.items.defenseIncrease++,this.num=t.GameVars.slotData.items.defenseIncrease;break;case 6:t.GameVars.slotData.items.aimingIncrease++,this.num=t.GameVars.slotData.items.aimingIncrease}},e.prototype.onOut=function(t){this.buttonContainer.scale.set(1)},e.prototype.onOver=function(t){this.buttonContainer.scale.set(1.05)},e}(Phaser.Group);t.CraftItem=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(s){var n=a.call(this,s,null,"team-layer")||this;n.fixedToCamera=!0,n.visible=!1,n.updateWisp=!1,n.wisp=t.GameVars.slotData.wisp;var i=n.create(0,0,n.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_1));i.inputEnabled=!0,i.events.onInputDown.add(n.onClickDarkLayer,n),i.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),n.add(i);var o=n.create(0,320,n.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_2));o.inputEnabled=!0,o.events.onInputDown.add(n.onClickDarkLayer,n),o.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),n.add(o);var r=new Phaser.Group(n.game);r.scale.y=t.GameVars.scaleY,n.add(r),n.backButton=new Phaser.Button(n.game,10,10,"texture_atlas_1",n.onClickBack,n),n.backButton.events.onInputDown.add(n.onButtonDown,n),n.backButton.events.onInputOut.add(n.onOut,n),n.backButton.events.onInputOver.add(n.onOver,n),n.backButton.setFrames("btn_back.png","btn_back.png","btn_back.png"),n.backButton.anchor.set(.5),n.backButton.x+=n.backButton.width/2,n.backButton.y+=n.backButton.height/2,r.add(n.backButton);var m=new Phaser.Image(n.game,135,15,"texture_atlas_1","tab_wisps.png");r.add(m),n.wispText=new Phaser.Text(n.game,230,47,t.Utils.validNumber(t.GameVars.slotData.wisp),{font:"24px Chewy",fontWeight:"400",fill:"#59ffff"}),n.wispText.anchor.set(1,.5),r.add(n.wispText);var h=new Phaser.Image(n.game,t.GameConstants.GAME_WIDTH-10,10,"texture_atlas_1","tab_area_big.png");h.anchor.set(1,0),r.add(h);var l=new Phaser.Text(n.game,380,45,t.GameVars.names.CRAFTING,{font:"25px Chewy",fontWeight:"400",fill:"#ffb63b"});l.anchor.set(.5),r.add(l);var c=new Phaser.Group(n.game);c.x=t.GameConstants.GAME_WIDTH/2,c.y=t.GameConstants.GAME_HEIGHT/2,n.add(c),n.craftItems=new Array;for(var d=0;d<7;d++){var p=new t.CraftItem(n.game,e.POSITIONS[d][0],e.POSITIONS[d][1],d,n);c.add(p),n.craftItems.push(p)}return t.GameVars.slotData.state!==t.GameConstants.TUTORIAL_HEAL&&t.GameVars.slotData.state!==t.GameConstants.TUTORIAL_CRAFT||(n.backButton.visible=!1,n.tween=n.game.add.tween(n.craftItems[0].buttonContainer.scale).to({x:[1.05,1],y:[1.05,1]},500,Phaser.Easing.Linear.None,!0,0,-1)),n}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this),this.updateWisp&&(this.wisp-=100,this.wisp<=t.GameVars.slotData.wisp?(this.wisp=t.GameVars.slotData.wisp,this.wispText.text=t.Utils.validNumber(this.wisp),this.updateWisp=!1):this.wispText.text=t.Utils.validNumber(this.wisp))},e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),a.scale.set(1.1)},e.prototype.show=function(){this.visible=!0,this.wispText.text=t.Utils.validNumber(t.GameVars.slotData.wisp);for(var a=0;a<this.craftItems.length;a++)this.craftItems[a].checkPrice()},e.prototype.itemCrafted=function(){this.updateWisp=!0;for(var a=0;a<this.craftItems.length;a++)this.craftItems[a].checkPrice();t.GameVars.slotData.state===t.GameConstants.TUTORIAL_CRAFT&&(this.tween.stop(),this.craftItems[0].buttonContainer.scale.set(1),this.backButton.visible=!0)},e.prototype.onClickBack=function(a){a.scale.set(1),t.MapManager.hideItemsLayer()},e.prototype.onClickDarkLayer=function(){},e.prototype.onOut=function(t){t.scale.set(1)},e.prototype.onOver=function(t){t.scale.set(1.05)},e.POSITIONS=[[0,-200],[-120,-62],[120,-62],[-120,76],[120,76],[-120,214],[120,214]],e}(Phaser.Group);t.ItemsLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"pause-layer")||this;s.fixedToCamera=!0;var n=s.create(0,0,s.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_1));n.inputEnabled=!0,n.events.onInputDown.add(s.onDownBackground,s),n.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),s.add(n);var i=s.create(0,320,s.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_2));i.inputEnabled=!0,i.events.onInputDown.add(s.onDownBackground,s),i.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),s.add(i);var o=new Phaser.Group(s.game);o.x=t.GameConstants.GAME_WIDTH/2,o.y=t.GameConstants.GAME_HEIGHT/2+40,o.scale.set(.85,.85*t.GameVars.scaleY),s.add(o),s.map=new Phaser.Image(s.game,0,0,"texture_atlas_1","mapa_overworld.png"),s.map.anchor.set(.5),o.add(s.map),s.imHereContainer=new Phaser.Group(s.game),o.add(s.imHereContainer),s.imHere=new Phaser.Image(s.game,0,0,"texture_atlas_1","icon_ander.png"),s.imHere.anchor.set(.5,1),s.imHereContainer.add(s.imHere),s.game.add.tween(s.imHere).to({y:[5,0]},500,Phaser.Easing.Linear.None,!0,0,-1);var r=new Phaser.Button(s.game,10,10*t.GameVars.scaleY,"texture_atlas_1",s.onClickBack,s);return r.setFrames("btn_back.png","btn_back.png","btn_back.png"),r.events.onInputDown.add(s.onButtonDown,s),r.events.onInputOut.add(s.onOut,s),r.events.onInputOver.add(s.onOver,s),r.scale.y=t.GameVars.scaleY,r.forceOut=!0,s.add(r),s.visible=!1,s}return __extends(e,a),e.prototype.update=function(){var a=t.GameVars.slotData.mapName,e=t.MapState.currentInstance.mapContainer.hero.position;t.GameVars.slotData.mapsData[a]&&(this.imHereContainer.x=10-this.map.width/2+t.GameVars.slotData.mapsData[a].minimapPosition.x+.07*e.x,this.imHereContainer.y=10-this.map.height/2+t.GameVars.slotData.mapsData[a].minimapPosition.y+.07*e.y)},e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),a.scale.set(1.05,1.05*t.GameVars.scaleY)},e.prototype.onOut=function(a){a.scale.set(1,t.GameVars.scaleY)},e.prototype.onOver=function(a){a.scale.set(1.05,1.05*t.GameVars.scaleY)},e.prototype.onClickBack=function(){t.AudioManager.playSound("click_btn"),t.MapManager.hideMapLayer()},e.prototype.onDownBackground=function(){},e}(Phaser.Group);t.MapLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i,o,r){var m=a.call(this,e,null,"action-layer")||this;m.x=s,m.y=n;var h=t.GameVars.monstersActions[i],l=m.create(0,0,m.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));if(l.tint=12637,l.scale.set(280/t.GameConstants.BITMAP_SIZE,75/t.GameConstants.BITMAP_SIZE),m.add(l),o){var c=new Phaser.Image(m.game,5,37,"texture_atlas_1","btn_attack_"+i+".png");c.anchor.set(0,.5),m.add(c),(G=new Phaser.Text(m.game,70,23,h.name.toUpperCase(),{font:"18px Chewy",fontWeight:"400",fill:"#abe2e9"})).anchor.set(0,.5),m.add(G);var d=new Phaser.Text(m.game,70,53,t.GameVars.names.DAMAGE+": "+Math.round(10*h.damage),{font:"16px Chewy",fontWeight:"400",fill:"#abe2e9"});d.anchor.set(0,.5),m.add(d);var p=new Phaser.Text(m.game,190,65,t.GameVars.names.COOLDOWN+": "+(h.cooldown-1),{font:"16px Chewy",fontWeight:"400",fill:"#abe2e9"});if(p.anchor.set(0,.5),m.add(p),1===h.cooldown&&(p.visible=!1),h.special!==t.GameConstants.SPECIAL_NONE){var u=new Phaser.Text(m.game,180,45,t.GameVars.names.SPECIAL+": ",{font:"16px Chewy",fontWeight:"400",fill:"#abe2e9"});u.anchor.set(0,.5),m.add(u);var g=new Phaser.Image(m.game,235,40,"texture_atlas_1","icon_"+h.special+".png");g.anchor.set(0,.5),g.scale.set(.62),m.add(g)}}else{m.alpha=.75;var G,f=void 0;1===r?f=t.GameConstants.LEVEL_ATTACK_1:2===r?f=t.GameConstants.LEVEL_ATTACK_2:3===r&&(f=t.GameConstants.LEVEL_ATTACK_3),(G=new Phaser.Text(m.game,140,40,t.GameVars.names.LEVEL+" "+f,{font:"20px Chewy",fontWeight:"400",fill:"#abe2e9"})).anchor.set(.5),m.add(G)}return m}return __extends(e,a),e}(Phaser.Group);t.ActionLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(s,n,i,o,r){var m,h,l,c,d=a.call(this,s,null,"bar")||this;d.x=n,d.y=i,"life"===o?(m=1136974,h=161120,l=9043853,c=4114513):"xp"===o&&(m=11030019,h=10123320,l=16646025,c=16758331);var p=new Phaser.Sprite(d.game,0,0,d.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));p.scale.set((e.BAR_LENGTH+4)/64,10/64),p.tint=m,d.add(p);var u=new Phaser.Sprite(d.game,2,2,d.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));return u.scale.set(e.BAR_LENGTH/64,6/64),u.tint=h,d.add(u),r&&(d.fx=new Phaser.Image(d.game,0,0,"texture_atlas_2","heal_fx_long_0001.png"),d.fx.scale.x=.42,d.add(d.fx),d.fx.animations.add("anim",Phaser.Animation.generateFrameNames("heal_fx_long_",1,20,".png",4)),d.fx.play("anim",24,!0)),d.bar1=new Phaser.Sprite(d.game,2,2,d.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),d.bar1.scale.set(60/64,3/64),d.bar1.tint=l,d.add(d.bar1),d.bar2=new Phaser.Sprite(d.game,2,5,d.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),d.bar2.scale.set(60/64,3/64),d.bar2.tint=c,d.add(d.bar2),d}return __extends(e,a),e.prototype.setValue=function(t,a){this.fx&&(t===a?this.fx.visible&&(this.fx.visible=!1):this.fx.visible||(this.fx.visible=!0));var s=t/a*e.BAR_LENGTH;this.bar1.scale.x=s/64,this.bar2.scale.x=s/64},e.BAR_LENGTH=80,e}(Phaser.Group);t.Bar=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"team-layer")||this;s.fixedToCamera=!0,s.visible=!1,s.topLayer=s.create(0,0,s.game.cache.getBitmapData(t.GameConstants.GRADIENT_CLASSIC)),s.topLayer.inputEnabled=!0,s.topLayer.events.onInputDown.add(s.onClickDarkLayer,s),s.topLayer.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),s.add(s.topLayer);var n=new Phaser.Group(s.game);n.scale.y=t.GameVars.scaleY,s.add(n);var i=new Phaser.Button(s.game,10,10,"texture_atlas_1",s.onClickBack,s);i.setFrames("btn_back.png","btn_back.png","btn_back.png"),i.anchor.set(.5),i.x+=i.width/2,i.y+=i.height/2,i.events.onInputDown.add(s.onButtonDown,s),i.events.onInputOut.add(s.onOut,s),i.events.onInputOver.add(s.onOver,s),n.add(i),s.capsule=new Phaser.Image(s.game,t.GameConstants.GAME_WIDTH/2,10,"texture_atlas_1","monster-capsule-classic.png"),s.capsule.anchor.set(.5,0),n.add(s.capsule),s.mkmName=new Phaser.Text(s.game,t.GameConstants.GAME_WIDTH/2-20,46,"",{font:"20px Goonies",fill:"#FFFFFF",align:"center"}),s.mkmName.anchor.set(.5),n.add(s.mkmName);var o=new Phaser.Image(s.game,370,30,"texture_atlas_1","icon_life_bar.png");o.anchor.set(.5),n.add(o),s.lifeBar=new t.Bar(s.game,380,26,"life"),n.add(s.lifeBar);var r=new Phaser.Image(s.game,370,50,"texture_atlas_1","icon_xp.png");r.anchor.set(.5),r.scale.set(.6),n.add(r),s.xpBar=new t.Bar(s.game,380,46,"xp"),n.add(s.xpBar);var m=new Phaser.Group(s.game);m.x=t.GameConstants.GAME_WIDTH/2,m.y=t.GameConstants.GAME_HEIGHT/2-125,m.scale.set(.9,.9*t.GameVars.scaleY),s.add(m),s.sign=new Phaser.Image(s.game,0,0,"texture_atlas_2","current_mkm_classic.png"),s.sign.anchor.set(.5),m.add(s.sign),s.mkm=new Phaser.Image(s.game,0,-20,"texture_atlas_4","mkm_001_front.png"),s.mkm.anchor.set(.5),m.add(s.mkm),s.level=new Phaser.Text(s.game,70,15,"",{font:"75px Chewy",fontWeight:"400",fill:"#000000"}),s.level.stroke="#11252c",s.level.strokeThickness=10,m.add(s.level),s.bottomContainer=new Phaser.Group(s.game),s.bottomContainer.scale.y=t.GameVars.scaleY,s.bottomContainer.y=t.GameConstants.GAME_HEIGHT,s.add(s.bottomContainer),s.stats=new Array;for(var h=0;h<4;h++){var l=new t.StatLayer(s.game,25,-5-80*h,h);s.bottomContainer.add(l),s.stats.push(l)}return s.actions=new Array,s}return __extends(e,a),e.prototype.show=function(a){var e;this.visible=!0,a.class===t.GameConstants.ELEMENT_CLASSIC?(e=t.GameConstants.GRADIENT_CLASSIC,this.mkmName.font="Pythia",this.mkmName.fontSize="20px",this.mkmName.fill="#5b473c",this.level.fill="#ff9c50"):a.class===t.GameConstants.ELEMENT_SPECTRE?(e=t.GameConstants.GRADIENT_SPECTRE,this.mkmName.font="Goonies",this.mkmName.fontSize="20px",this.mkmName.fill="#2a3147",this.level.fill="#b9a8ff"):a.class===t.GameConstants.ELEMENT_TECH&&(e=t.GameConstants.GRADIENT_TECH,this.mkmName.font="Adineue",this.mkmName.fontSize="25px",this.mkmName.fill="#ffffff",this.level.fill="#00dfa9"),this.newGradients(e),this.capsule.frameName="monster-capsule-"+a.class+".png",this.mkmName.text=a.name,this.lifeBar.setValue(a.life,a.maxLife),this.xpBar.setValue(a.xp,t.Utils.levelToXp(a.level)),this.sign.frameName="current_mkm_"+a.class+".png",this.mkm.frameName="mkm_"+a.id+"_front.png",this.level.text=a.level+"";for(var s=0;s<this.stats.length;s++)this.stats[s].setStats(a);for(s=0;s<this.actions.length;s++)this.actions[s].destroy();this.actions=new Array;var n=0;a.level>=t.GameConstants.LEVEL_ATTACK_3?n=3:a.level>=t.GameConstants.LEVEL_ATTACK_2?n=2:a.level>=t.GameConstants.LEVEL_ATTACK_1&&(n=1);for(s=0;s<4;s++){var i=new t.ActionLayer(this.game,175,80*s-320,a.actions[s].id,s<=n,s);this.bottomContainer.add(i),this.actions.push(i)}},e.prototype.onClickBack=function(a){a.scale.set(1),t.MapManager.hideMkmLayer()},e.prototype.onClickDarkLayer=function(){},e.prototype.newGradients=function(a){this.remove(this.topLayer),this.topLayer=this.create(0,0,this.game.cache.getBitmapData(a)),this.topLayer.inputEnabled=!0,this.topLayer.events.onInputDown.add(this.onClickDarkLayer,this),this.topLayer.scale.set(t.GameConstants.GAME_WIDTH/16,5),this.add(this.topLayer),this.sendToBack(this.topLayer)},e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),a.scale.set(1.1)},e.prototype.onOut=function(t){t.scale.set(1)},e.prototype.onOver=function(t){t.scale.set(1.05)},e}(Phaser.Group);t.MkmLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i){var o=a.call(this,e,null,"stat-layer")||this;o.x=s,o.y=n,o.i=i,o.createName();var r=o.create(0,0,o.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));r.anchor.set(0,1),r.tint=12637,r.scale.set(125/t.GameConstants.BITMAP_SIZE,75/t.GameConstants.BITMAP_SIZE),o.add(r);var m=new Phaser.Image(o.game,132,-75,"texture_atlas_1","tab_area.png");m.scale.x=-1,o.add(m);var h="";switch(o.name){case"aim":h=t.GameVars.names.AIM;break;case"life":h=t.GameVars.names.LIFE;break;case"defense":h=t.GameVars.names.DEFENSE;break;case"attack":h=t.GameVars.names.ATTACK}var l=new Phaser.Text(o.game,45,-50,h,{font:"18px Chewy",fontWeight:"400",fill:"#ffb63b"});l.anchor.set(.5),o.add(l);var c=new Phaser.Image(o.game,105,-55,"texture_atlas_1","icon_"+o.name.toLowerCase()+".png");return c.anchor.set(.5),o.add(c),o.numText=new Phaser.Text(o.game,62,-15,"",{font:"22px Chewy",fontWeight:"400",fill:"#abe2e9"}),o.numText.anchor.set(.5),o.add(o.numText),o}return __extends(e,a),e.prototype.setStats=function(t){switch(this.name){case"aim":this.numText.text=t.aiming+"";break;case"life":this.numText.text=t.maxLife+"";break;case"defense":this.numText.text=t.defense+"";break;case"attack":this.numText.text=t.attack+""}},e.prototype.createName=function(){switch(this.i){case 0:this.name="aim";break;case 1:this.name="life";break;case 2:this.name="defense";break;case 3:this.name="attack"}},e}(Phaser.Group);t.StatLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i,o){var r=a.call(this,e,null,"aura-mkm")||this;r.x=s,r.y=n,r.monsterData=i;var m=new Phaser.Image(r.game,0,0,"texture_atlas_2","current_mkm_classic.png");m.anchor.set(.5),m.scale.set(.45),r.add(m);var h=new Phaser.Group(r.game);h.y=o?-105:75,r.add(h);var l=new Phaser.Text(r.game,0,0,"",{font:"16px Chewy",fill:"#FFFFFF",align:"center"});l.anchor.set(.5),h.add(l),r.lifeBar=new t.Bar(r.game,-40,11,"life",!0),h.add(r.lifeBar);var c=new Phaser.Image(r.game,-50,32,"texture_atlas_1","icon_xp.png");c.anchor.set(.5),c.scale.set(.6),h.add(c);var d=new t.Bar(r.game,-40,28,"xp");return h.add(d),r.lifeIcon=new Phaser.Image(r.game,-50,15,"texture_atlas_1","icon_life_bar.png"),r.lifeIcon.anchor.set(.5),h.add(r.lifeIcon),i?(m.frameName="current_mkm_"+i.class+".png",l.text=" "+i.name.toUpperCase()+" ",i.class===t.GameConstants.ELEMENT_CLASSIC?l.fill="#ff9c50":i.class===t.GameConstants.ELEMENT_SPECTRE?l.fill="#b9a8ff":i.class===t.GameConstants.ELEMENT_TECH&&(l.fill="#00dfa9"),r.lifeBar.setValue(i.life,i.maxLife),d.setValue(i.xp,t.Utils.levelToXp(i.level))):r.visible=!1,r}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this),this.monsterData&&(this.lifeBar.setValue(this.monsterData.life,this.monsterData.maxLife),this.monsterData.life<this.monsterData.maxLife?(this.lifeIcon.frameName="icon_attention.png",this.lifeIcon.scale.set(.65),this.t1||(this.t1=this.game.add.tween(this.lifeIcon.scale).to({x:.6,y:.6},250,Phaser.Easing.Quintic.In),this.t2=this.game.add.tween(this.lifeIcon.scale).to({x:.65,y:.65},250,Phaser.Easing.Quintic.In),this.t1.chain(this.t2),this.t2.chain(this.t1),this.t1.start())):(this.t1&&(this.t1.stop(),this.t1=null),this.t2&&(this.t2.stop(),this.t2=null),this.lifeIcon.frameName="icon_life_bar.png",this.lifeIcon.scale.set(1)))},e}(Phaser.Group);t.AuraMkm=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(t,e,s,n,i){var o=a.call(this,t,null,"heal-fx")||this;return o.x=e,o.y=s,o.counter=-1,n&&(o.scale.x=-1),o.heal1=new Phaser.Image(o.game,0,0,"texture_atlas_2","heal_01.png"),o.heal1.scale.set(.5),o.heal1.visible=!1,o.add(o.heal1),o.heal2=new Phaser.Image(o.game,0,-80,"texture_atlas_2","heal_01.png"),o.heal2.scale.set(.5),o.heal2.visible=!1,o.add(o.heal2),o.heal3=new Phaser.Image(o.game,0,-160,"texture_atlas_2","heal_01.png"),o.heal3.scale.set(.5),o.heal3.visible=!1,o.add(o.heal3),o.heal4=new Phaser.Image(o.game,-30,-450,"texture_atlas_2","heal_01.png"),o.heal4.scale.set(1,1.5),o.heal4.visible=!1,o.add(o.heal4),o.heal1.animations.add("anim",Phaser.Animation.generateFrameNames("heal_",1,11,".png",2)).onComplete.add((function(){this.heal1.visible=!1}),o),o.heal2.animations.add("anim",Phaser.Animation.generateFrameNames("heal_",1,11,".png",2)).onComplete.add((function(){this.heal2.visible=!1}),o),o.heal3.animations.add("anim",Phaser.Animation.generateFrameNames("heal_",1,11,".png",2)).onComplete.add((function(){this.heal3.visible=!1}),o),o.heal4.animations.add("anim",Phaser.Animation.generateFrameNames("heal_",1,11,".png",2)).onComplete.add((function(){this.heal4.visible=!1,i.removeHeal(this)}),o),o.start(),o}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this),-1!==this.counter&&(Math.round(0/e.FPS)===this.counter?(this.heal1.visible=!0,this.heal1.play("anim",e.FPS,!1),t.AudioManager.playSound("flame_heal_01")):Math.round(360/e.FPS)===this.counter?(this.heal2.visible=!0,this.heal2.play("anim",e.FPS,!1)):Math.round(720/e.FPS)===this.counter?(this.heal3.visible=!0,this.heal3.play("anim",e.FPS,!1)):Math.round(1080/e.FPS)===this.counter?(this.heal4.visible=!0,this.heal4.play("anim",e.FPS,!1),t.AudioManager.playSound("flame_heal_02")):Math.round(1800/e.FPS)===this.counter&&(this.counter=-2),this.counter++)},e.prototype.start=function(){-1===this.counter&&(this.counter=0)},e.FPS=24,e}(Phaser.Group);t.HealFx=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(s,n,i,o,r){var m=a.call(this,s,null,"heal-slot")||this;if(m.x=n,m.y=i,m.counter=60,m.i=r,m.monsterData=o,m.i>2){var h=new Phaser.Sprite(m.game,2,-2,m.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE));h.scale.set(8/64,(e.BAR_LENGTH+4)/64),h.anchor.set(0,1),h.tint=161120,m.add(h),m.bar=new Phaser.Sprite(m.game,2,-2,m.game.cache.getBitmapData(t.GameConstants.WHITE_SQUARE)),m.bar.scale.set(8/64,(e.BAR_LENGTH+4)/64),m.bar.anchor.set(0,1),m.bar.tint=4114513,m.add(m.bar),m.healBackground=new Phaser.Image(m.game,0,0,"texture_atlas_2","fx_heal_0001.png"),m.healBackground.anchor.set(0,1),m.add(m.healBackground)}if(m.time=new Phaser.Text(m.game,15,0,"",{font:"16px Chewy",fontWeight:"400",fill:"#0f1f26"}),m.time.anchor.set(0,1),m.add(m.time),0===m.i?(m.time.position.add(-8,-108),m.time.fill="#c6feff"):r<=2&&m.time.position.add(-8,72),m.monsterData){if(t.GameManager.setInitialHealTime(m.monsterData),m.i>2){var l=o.life/o.maxLife*e.BAR_LENGTH;m.bar.scale.y=l/64,o.life<o.maxLife&&(m.healBackground.animations.add("anim",Phaser.Animation.generateFrameNames("fx_heal_",1,21,".png",4)),m.healBackground.play("anim",24,!0))}}else m.visible=!1;return m}return __extends(e,a),e.prototype.update=function(){if(a.prototype.update.call(this),this.monsterData){if(this.counter<60?this.counter++:(this.counter=0,t.GameManager.setHealTime(this.monsterData)),this.i>2){var s=this.monsterData.life/this.monsterData.maxLife*e.BAR_LENGTH;this.bar.scale.y=s/64}var n=2*(this.monsterData.maxLife-this.monsterData.life);n>0?this.time.text=n<60?Math.round(n)+" s":Math.floor(n/60)+" m":(this.time.text="",this.i>2&&(this.healBackground.animations.stop("anim"),this.healBackground.frameName="fx_heal_0001.png"))}},e.BAR_LENGTH=60,e}(Phaser.Group);t.HealSlot=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(s){var n=a.call(this,s,null,"team-layer")||this;n.fixedToCamera=!0,n.visible=!1;var i=n.create(0,0,n.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_1));i.inputEnabled=!0,i.events.onInputDown.add(n.onClickDarkLayer,n),i.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),n.add(i);var o=n.create(0,320,n.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_2));o.inputEnabled=!0,o.events.onInputDown.add(n.onClickDarkLayer,n),o.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),n.add(o);var r=new Phaser.Group(n.game);r.scale.y=t.GameVars.scaleY,n.add(r),n.backButton=new Phaser.Button(n.game,10,10,"texture_atlas_1",n.onClickBack,n),n.backButton.setFrames("btn_back.png","btn_back.png","btn_back.png"),n.backButton.anchor.set(.5),n.backButton.x+=n.backButton.width/2,n.backButton.y+=n.backButton.height/2,n.backButton.events.onInputDown.add(n.onButtonDown,n),n.backButton.events.onInputOut.add(n.onOut,n),n.backButton.events.onInputOver.add(n.onOver,n),r.add(n.backButton);var m=new Phaser.Button(n.game,10,n.backButton.y+n.backButton.height+10,"texture_atlas_1",n.onClickBestiary,n);m.setFrames("btn_bestiary.png","btn_bestiary.png","btn_bestiary.png"),m.anchor.set(.5),m.x+=n.backButton.width/2,m.events.onInputDown.add(n.onButtonDown,n),m.events.onInputOut.add(n.onOut,n),m.events.onInputOver.add(n.onOver,n),r.add(m);var h=1/t.GameVars.scaleY*1.1/1.33;h<1&&(h=1),n.midContainer=new Phaser.Group(n.game),n.midContainer.x=t.GameConstants.GAME_WIDTH/2,n.midContainer.y=t.GameConstants.GAME_HEIGHT/2,n.midContainer.scale.set(h,h*t.GameVars.scaleY);var l=new Phaser.Image(n.game,0,36,"texture_atlas_2","magic_wand_silhouette.png");l.anchor.set(.5),n.midContainer.add(l),n.aurasContainer=new Phaser.Group(n.game),n.midContainer.add(n.aurasContainer),n.auras=new Array;for(var c=0;c<3;c++){var d=t.GameVars.slotData.monsters[c],p=new t.AuraMkm(n.game,e.POSITIONS[c][0],e.POSITIONS[c][1],d,0===c);n.aurasContainer.add(p),n.auras.push(p)}n.slotsContainer=new Phaser.Group(n.game),n.midContainer.add(n.slotsContainer),n.slots=new Array;for(c=0;c<6;c++){var u=new Phaser.Image(n.game,e.POSITIONS[c][0],e.POSITIONS[c][1],"texture_atlas_1",c<3?"slot_swap_eye.png":"slot_empty.png");u.anchor.set(.5),u.visible=c>=3,n.midContainer.add(u),n.slots.push(u)}n.healSlots=new Array;for(c=0;c<6;c++){var g=new t.HealSlot(n.game,e.POSITIONS[c][0]+42,e.POSITIONS[c][1]+35,t.GameVars.slotData.monsters[c],c);n.slotsContainer.add(g),n.healSlots.push(g)}n.teamMkm=new Array;for(c=0;c<t.GameVars.slotData.monsters.length;c++){var G=void 0;G=t.GameVars.slotData.monsters[c]?new t.TeamMkm(n.game,e.POSITIONS[c][0],e.POSITIONS[c][1],t.GameVars.slotData.monsters[c],c<3,n,c):new t.TeamMkm(n.game,e.POSITIONS[c][0],e.POSITIONS[c][1],null,c<3,n,c),n.midContainer.add(G),n.teamMkm.push(G)}n.fingerMkm=new Phaser.Image(n.game,-120,-150,"texture_atlas_1","tutorial_finger.png"),n.fingerMkm.anchor.set(.5),n.fingerMkm.scale.x=-1,n.fingerMkm.visible=!1,n.midContainer.add(n.fingerMkm),n.game.add.tween(n.fingerMkm).to({x:[-150,-120]},1e3,Phaser.Easing.Linear.None,!0,0,-1);var f=new Phaser.Group(n.game);f.x=t.GameConstants.GAME_WIDTH/2,f.y=t.GameConstants.GAME_HEIGHT/2,f.scale.y=t.GameVars.scaleY,n.add(f);var C=new Phaser.Image(n.game,t.GameConstants.GAME_WIDTH/2-5,-t.GameConstants.GAME_HEIGHT/2+5,"texture_atlas_1","tab_area.png");C.anchor.set(1,0),f.add(C);var _=new Phaser.Text(n.game,t.GameConstants.GAME_WIDTH/2-77,-t.GameConstants.GAME_HEIGHT/2+30,t.GameVars.names["COMBAT TEAM"],{font:"18px Chewy",fontWeight:"400",fill:"#ffb63b"});_.anchor.set(.5),f.add(_);var E=new Phaser.Group(n.game);E.y=t.GameConstants.GAME_HEIGHT,E.scale.y=t.GameVars.scaleY,n.add(E),n.healButton=new Phaser.Button(n.game,0,0,"texture_atlas_"+t.GameVars.gameData.language,n.onClickInstantHeal,n),n.healButton.setFrames("btn_instant_heal.png","btn_instant_heal.png","btn_instant_heal.png"),n.healButton.onInputDown.add(n.onButtonDown,n),n.healButton.events.onInputOut.add(n.onOut,n),n.healButton.events.onInputOver.add(n.onOver,n),n.healButton.anchor.set(.5),n.healButton.x+=n.healButton.width/2,n.healButton.y-=n.healButton.height/2,E.add(n.healButton);var T=new Phaser.Text(n.game,70,-80,"("+t.GameVars.names["WATCH VIDEO"]+")",{font:"16px Chewy",fontWeight:"400",fill:"#0f1f26"});return T.anchor.set(.5),E.add(T),n.healBoostButton=new Phaser.Button(n.game,t.GameConstants.GAME_WIDTH,0,"texture_atlas_"+t.GameVars.gameData.language,n.onClickHealingBoost,n),n.healBoostButton.onInputDown.add(n.onButtonDown,n),n.healBoostButton.events.onInputOut.add(n.onOut,n),n.healBoostButton.events.onInputOver.add(n.onOver,n),n.healBoostButton.setFrames("btn_healing_boost.png","btn_healing_boost.png","btn_healing_boost.png"),n.healBoostButton.anchor.set(.5),E.add(n.healBoostButton),n.healBoostButton.x-=n.healBoostButton.width/2,n.healBoostButton.y-=n.healBoostButton.height/2,n.fingerHeal=new Phaser.Image(n.game,t.GameConstants.GAME_WIDTH-100,-140,"texture_atlas_1","tutorial_finger.png"),n.fingerHeal.anchor.set(.5),n.fingerHeal.angle=90,n.fingerHeal.scale.x=-1,E.add(n.fingerHeal),n.game.add.tween(n.fingerHeal).to({y:[-120,-140]},250,Phaser.Easing.Linear.None,!0,0,-1),t.GameVars.slotData.state<t.GameConstants.TUTORIAL_HEAL&&(n.healBoostButton.visible=!1,n.healButton.visible=!1,T.visible=!1),t.GameVars.slotData.state<t.GameConstants.TUTORIAL_SWAP&&(m.visible=!1),n.add(n.midContainer),n.bestiary=new t.Bestiary(n.game),n.add(n.bestiary),n.game.time.events.add(100,(function(){this.needChange()}),n),n}return __extends(e,a),e.prototype.update=function(){a.prototype.update.call(this);for(var t=!1,e=0;e<6;e++)if(this.healSlots[e].monsterData){var s=this.healSlots[e].monsterData;s.life<s.maxLife&&(t=!0)}t||1!==this.healBoostButton.alpha?t&&.5===this.healBoostButton.alpha&&(this.healBoostButton.alpha=1,this.healBoostButton.inputEnabled=!0,this.healButton.alpha=1,this.healButton.inputEnabled=!0,this.fingerHeal.visible=!0):(this.healBoostButton.alpha=.5,this.healBoostButton.inputEnabled=!1,this.healButton.alpha=.5,this.healButton.inputEnabled=!1,this.fingerHeal.visible=!1)},e.prototype.needChange=function(){for(var t=!0,a=0;a<3;a++)this.teamMkm[a].monsterData&&(t=!1);t?(this.backButton.alpha=.5,this.backButton.inputEnabled=!1):(this.backButton.alpha=1,this.backButton.inputEnabled=!0)},e.prototype.show=function(){this.visible=!0,t.GameVars.slotData.state===t.GameConstants.TUTORIAL_WAND&&(this.backButton.alpha=.5,this.backButton.inputEnabled=!1,this.fingerMkm.visible=!0)},e.prototype.removeFinger=function(){this.fingerMkm.visible=!1,this.backButton.alpha=1,this.backButton.inputEnabled=!0},e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),a.scale.set(1.1)},e.prototype.canChange=function(a){for(var e=0;e<this.teamMkm.length;e++)if(a!==this.teamMkm[e]){var s=this.teamMkm[e];if(t.Utils.intersectRect(a.x,a.y,s.x,s.y,30))return void this.swapMkms(a,s)}a.moveInitial(),this.uploadAurasSlots()},e.prototype.swapMkms=function(a,e){var s=a.initialX,n=a.initialY;a.initialX=e.initialX,a.initialY=e.initialY,e.initialX=s,e.initialY=n;var i=a.pos;a.pos=e.pos,e.pos=i,this.midContainer.bringToTop(s),this.midContainer.bringToTop(e),a.moveInitial(),e.moveInitial(),t.GameManager.reorderMonsters(this.teamMkm),a.pos<3&&a.monsterData&&(a.monsterData.healTime=0),e.pos<3&&e.monsterData&&(e.monsterData.healTime=0),this.uploadAurasSlots(),this.needChange(),t.GameManager.writeGameData()},e.prototype.uploadAurasSlots=function(){for(var a=0;a<3;a++)this.auras[a].destroy();for(a=0;a<6;a++)this.healSlots[a].destroy();this.auras=new Array;for(a=0;a<3;a++){var s=t.GameVars.slotData.monsters[a],n=new t.AuraMkm(this.game,e.POSITIONS[a][0],e.POSITIONS[a][1],s,0===a);this.aurasContainer.add(n),this.auras.push(n)}this.healSlots=new Array;for(a=0;a<6;a++){var i=new t.HealSlot(this.game,e.POSITIONS[a][0]+42,e.POSITIONS[a][1]+35,t.GameVars.slotData.monsters[a],a);this.slotsContainer.add(i),this.healSlots.push(i)}},e.prototype.removeBack=function(t){t<3?this.auras[t].visible=!1:this.healSlots[t-3].visible=!1},e.prototype.checkIntersection=function(a){this.uncheckSlots();for(var e=0;e<this.teamMkm.length;e++)if(a!==this.teamMkm[e]){var s=this.teamMkm[e];if(t.Utils.intersectRect(a.x,a.y,s.x,s.y,30))return this.slots[s.pos].visible=!0,void(s.pos>=3&&(this.slots[s.pos].frameName="slot_swap.png"))}this.slots[a.pos].visible=!0,a.pos>3&&(this.slots[a.pos].frameName="slot_swap.png")},e.prototype.uncheckSlots=function(){for(var t=0;t<6;t++)this.slots[t].frameName=t<3?"slot_swap_eye.png":"slot_empty.png",this.slots[t].visible=t>=3},e.prototype.onClickBack=function(a){a.scale.set(1),t.MapManager.hideTeamLayer(),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_HEAL&&t.GameManager.endHealTutorial(),t.GameVars.slotData.state===t.GameConstants.TUTORIAL_WAND&&t.GameManager.endWandTutorial()},e.prototype.onClickBestiary=function(t){t.scale.set(1),this.bestiary.visible=!0},e.prototype.onClickInstantHeal=function(a){a.scale.set(1),t.GameConstants.SPONSOR===t.GameConstants.GAMEPIX&&"undefined"!=typeof GamePix?GamePix.hook({type:"show_video_reward"}).then((function(a){t.MapState.currentInstance.teamLayer.instantHeal()})).catch((function(t){console.log(t)})):t.GameConstants.SPONSOR===t.GameConstants.POKI?PokiSDK.rewardedBreak().then((function(a){console.log("Should the user get a reward? ${withReward}"),t.MapState.currentInstance.teamLayer.instantHeal()})):this.instantHeal()},e.prototype.instantHeal=function(){for(var t=0;t<6;t++)if(this.healSlots[t].monsterData){var a=this.healSlots[t].monsterData;a.life<a.maxLife&&(a.life=a.maxLife)}},e.prototype.onClickHealingBoost=function(a){a.scale.set(1),this.fingerHeal.visible=!1;for(var e=!1,s=0;s<6;s++)if(this.healSlots[s].monsterData){var n=this.healSlots[s].monsterData;n.life<n.maxLife&&(e=!0,n.life+=2,n.life>n.maxLife&&(n.life=n.maxLife))}if(e){var i=new t.HealFx(this.game,60,220,!0,this);this.midContainer.add(i);var o=new t.HealFx(this.game,-60,220,!1,this);this.midContainer.add(o),this.midContainer.sendToBack(i),this.midContainer.bringToTop(o)}},e.prototype.removeHeal=function(t){this.midContainer.remove(t)},e.prototype.onClickDarkLayer=function(){},e.prototype.onOut=function(t){t.scale.set(1)},e.prototype.onOver=function(t){t.scale.set(1.05)},e.POSITIONS=[[-2,-192],[-72,-68],[73,-69],[0,95],[0,180],[0,265]],e}(Phaser.Group);t.TeamLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i,o,r,m){var h=a.call(this,e,null,"team-mkm")||this;return h.x=s,h.y=n,h.initialX=s,h.initialY=n,h.pos=m,h.canMove=!1,h.canDown=!0,h.typeMkm=o,h.teamLayer=r,h.monsterData=i,h.needFx=!1,h.monsterData&&(h.fx=new Phaser.Image(h.game,0,0,"texture_atlas_1","fx_radial_rays.png"),h.fx.anchor.set(.5),h.fx.visible=!1,h.fx.scale.set(0),h.add(h.fx),h.mkm=new Phaser.Image(h.game,0,-10,"texture_atlas_4","mkm_"+i.id+"_front.png"),h.mkm.scale.set(.52),h.mkm.anchor.set(.5),h.mkm.inputEnabled=!0,h.mkm.events.onInputDown.add(h.onDown,h),h.mkm.events.onInputUp.add(h.onUp,h),h.add(h.mkm),h.mkmLevel=new Phaser.Text(h.game,30,0,i.level+"",{font:"40px Chewy",fontWeight:"400",fill:"#000000"}),h.mkmLevel.stroke="#11252c",h.mkmLevel.strokeThickness=8,h.add(h.mkmLevel),h.icon=new Phaser.Image(h.game,0,0,"texture_atlas_4","icon_"+i.id+".png"),h.icon.anchor.set(.5),h.icon.inputEnabled=!0,h.icon.events.onInputDown.add(h.onDown,h),h.icon.events.onInputUp.add(h.onUp,h),h.add(h.icon),h.iconLevel=new Phaser.Text(h.game,-32,-33,i.level+"",{font:"18px Chewy",fontWeight:"400",fill:"#000000"}),h.iconLevel.stroke="#11252c",h.iconLevel.strokeThickness=5,h.add(h.iconLevel),i.class===t.GameConstants.ELEMENT_CLASSIC?(h.mkmLevel.fill="#ff9c50",h.iconLevel.fill="#ff9c50",h.fx.tint=16751696,h.mkmLevel.stroke="#40241D",h.iconLevel.stroke="#40241D"):i.class===t.GameConstants.ELEMENT_SPECTRE?(h.mkmLevel.fill="#b9a8ff",h.iconLevel.fill="#b9a8ff",h.fx.tint=12167423,h.mkmLevel.stroke="#300949",h.iconLevel.stroke="#300949"):i.class===t.GameConstants.ELEMENT_TECH&&(h.mkmLevel.fill="#00dfa9",h.iconLevel.fill="#00dfa9",h.fx.tint=57257,h.mkmLevel.stroke="#102932",h.iconLevel.stroke="#102932"),o?h.mkmMode():h.iconMode(),h.typeMkm?(h.mkmLevel.visible=!0,h.iconLevel.visible=!1):(h.mkmLevel.visible=!1,h.iconLevel.visible=!0)),h}return __extends(e,a),e.prototype.update=function(){if(a.prototype.update.call(this),t.GameVars.slotData.state<t.GameConstants.TUTORIAL_SWAP_2){if(!this.monsterData)return;this.monsterData.life<this.monsterData.maxLife?this.needFx=!0:this.needFx&&(this.needFx=!1,t.MapState.currentInstance.teamLayer.visible&&t.AudioManager.playSound("finished_healing"),this.fx.visible=!0,this.game.add.tween(this.fx.scale).to({x:1,y:1},300,Phaser.Easing.Elastic.Out,!0).onComplete.add((function(){this.game.add.tween(this.fx.scale).to({x:0,y:0},500,Phaser.Easing.Cubic.Out,!0,200).onComplete.add((function(){this.fx.visible=!1}),this)}),this))}else{if(this.canMove){var e=this.game.input.activePointer;this.x=e.x-t.GameConstants.GAME_WIDTH/2-this.offX,this.y=(e.y-t.GameConstants.GAME_HEIGHT/2)/t.GameVars.scaleY-this.offY,this.teamLayer.checkIntersection(this)}this.monsterData&&(this.y<25?this.typeMkm||this.mkmMode():this.typeMkm&&this.iconMode(),this.monsterData.life<this.monsterData.maxLife?this.needFx=!0:this.needFx&&(this.needFx=!1,t.MapState.currentInstance.teamLayer.visible&&t.AudioManager.playSound("finished_healing"),this.fx.visible=!0,this.game.add.tween(this.fx.scale).to({x:1,y:1},300,Phaser.Easing.Elastic.Out,!0).onComplete.add((function(){this.game.add.tween(this.fx.scale).to({x:0,y:0},500,Phaser.Easing.Cubic.Out,!0,200).onComplete.add((function(){this.fx.visible=!1}),this)}),this)))}},e.prototype.moveInitial=function(){this.canDown=!1;var t=Math.sqrt(Math.pow(this.x-this.initialX,2)+Math.pow(this.y-this.initialY,2)/4);t<10&&(t=10),this.game.add.tween(this).to({x:this.initialX,y:this.initialY},t,Phaser.Easing.Linear.None,!0).onComplete.add((function(){this.canDown=!0,this.monsterData&&(this.typeMkm?(this.mkmLevel.visible=!0,this.iconLevel.visible=!1):(this.mkmLevel.visible=!1,this.iconLevel.visible=!0))}),this)},e.prototype.mkmMode=function(){this.mkm.visible=!0,this.icon.visible=!1,this.typeMkm=!0},e.prototype.iconMode=function(){this.mkm.visible=!1,this.icon.visible=!0,this.typeMkm=!1},e.prototype.onDown=function(a,e){this.canDown&&this.monsterData&&(this.mkmLevel.visible=!1,this.iconLevel.visible=!1,this.offX=e.x-t.GameConstants.GAME_WIDTH/2-this.x,this.offY=(e.y-t.GameConstants.GAME_HEIGHT/2)/t.GameVars.scaleY-this.y,this.canMove=!0,this.teamLayer.midContainer.bringToTop(this),this.teamLayer.removeBack(this.pos))},e.prototype.onUp=function(a,e){if(this.canDown&&this.canMove&&this.monsterData){this.canMove=!1;var s=e.timeUp-e.timeDown,n=e.positionUp,i=e.positionDown;s<250&&Math.abs(n.x-i.x)<10&&Math.abs(n.y-i.y)<10?(this.moveInitial(),t.MapManager.showMkmLayer(this.monsterData),this.teamLayer.uploadAurasSlots()):this.teamLayer.canChange(this),this.teamLayer.uncheckSlots()}},e}(Phaser.Group);t.TeamMkm=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(s){var n=a.call(this,s,null,"bestiary")||this;n.visible=!1,n.startX=0,n.canSwipe=!1,n.classBestiary=t.GameConstants.ELEMENT_CLASSIC,n.game.input.onUp.add(n.mouseUp,n),n.game.input.onDown.add(n.mouseDown,n),n.topLayer=n.create(0,0,n.game.cache.getBitmapData(t.GameConstants.GRADIENT_CLASSIC)),n.topLayer.inputEnabled=!0,n.topLayer.events.onInputDown.add(n.onClickDarkLayer,n),n.topLayer.scale.set(t.GameConstants.GAME_WIDTH/16,t.GameConstants.GAME_HEIGHT/128),n.add(n.topLayer);var i=new Phaser.Group(n.game);i.scale.y=t.GameVars.scaleY,n.add(i);var o=new Phaser.Button(n.game,10,10,"texture_atlas_1",n.onClickBack,n);o.setFrames("btn_back.png","btn_back.png","btn_back.png"),o.anchor.set(.5),o.x+=o.width/2,o.y+=o.height/2,o.events.onInputDown.add(n.onButtonDown,n),o.events.onInputOut.add(n.onOut,n),o.events.onInputOver.add(n.onOver,n),i.add(o);var r=new Phaser.Image(n.game,t.GameConstants.GAME_WIDTH-5,5,"texture_atlas_1","tab_area_big.png");r.anchor.set(1,0),i.add(r);var m=new Phaser.Text(n.game,t.GameConstants.GAME_WIDTH-100,40,t.GameVars.names.BESTIARY,{font:"25px Chewy",fontWeight:"400",fill:"#ffb63b"});m.anchor.set(.5),i.add(m),n.midContainer=new Phaser.Group(n.game),n.midContainer.scale.y=t.GameVars.scaleY,n.midContainer.x=t.GameConstants.GAME_WIDTH/2,n.midContainer.y=200,n.add(n.midContainer),n.mkms=new Array;for(var h=0;h<5;h++){var l=new t.BestiaryIcon(n.game,h,e.POSITIONS[h][0],e.POSITIONS[h][1],n.classBestiary,n);n.midContainer.add(l),n.mkms.push(l)}var c=new Phaser.Group(n.game);return c.scale.y=t.GameVars.scaleY,c.x=t.GameConstants.GAME_WIDTH/2,c.y=450,n.add(c),n.leftArrow=new Phaser.Image(n.game,-200,0,"texture_atlas_1","btn_arrow_tech.png"),n.leftArrow.scale.x=-1,n.leftArrow.anchor.set(.5),n.leftArrow.name="left",n.leftArrow.inputEnabled=!0,n.leftArrow.events.onInputDown.add(n.onArrowDown,n),n.leftArrow.events.onInputUp.add(n.onArrowUp,n),n.leftArrow.events.onInputOut.add(n.onOutLeft,n),n.leftArrow.events.onInputOver.add(n.onOverLeft,n),c.add(n.leftArrow),n.rightArrow=new Phaser.Image(n.game,200,0,"texture_atlas_1","btn_arrow_spectre.png"),n.rightArrow.anchor.set(.5),n.rightArrow.name="right",n.rightArrow.inputEnabled=!0,n.rightArrow.events.onInputDown.add(n.onArrowDown,n),n.rightArrow.events.onInputUp.add(n.onArrowUp,n),n.rightArrow.events.onInputOut.add(n.onOut,n),n.rightArrow.events.onInputOver.add(n.onOver,n),c.add(n.rightArrow),n.capsule=new Phaser.Image(n.game,0,0,"texture_atlas_1","monster-capsule-classic.png"),n.capsule.anchor.set(.5),c.add(n.capsule),n.capsuleText=new Phaser.Text(n.game,-20,8,t.GameVars.bestiaryTexts.CLASSIC,{font:"22px Pythia",fill:"#5b473c",align:"center"}),n.capsuleText.anchor.set(.5),c.add(n.capsuleText),n.classText=new Phaser.Text(n.game,0,45,t.GameVars.bestiaryTexts["DESCRIPTION CLASSIC"],{font:"18px Chewy",fontWeight:"400",fill:"#ff9c50",align:"center"}),n.classText.anchor.set(.5,0),n.classText.wordWrap=!0,n.classText.wordWrapWidth=460,c.add(n.classText),n.changeBestiaryType(),n}return __extends(e,a),e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),a.scale.set(1.1)},e.prototype.mouseDown=function(){this.startX=this.game.input.x,this.canSwipe=!0},e.prototype.mouseUp=function(){if(this.canSwipe){this.canSwipe=!1;var t=this.game.input.x,a=this.startX-t;a>50?this.swipeLeft():a<-50&&this.swipeRight()}},e.prototype.swipeLeft=function(){this.classBestiary===t.GameConstants.ELEMENT_CLASSIC?this.classBestiary=t.GameConstants.ELEMENT_TECH:this.classBestiary===t.GameConstants.ELEMENT_SPECTRE?this.classBestiary=t.GameConstants.ELEMENT_CLASSIC:this.classBestiary=t.GameConstants.ELEMENT_SPECTRE,this.changeBestiaryType()},e.prototype.swipeRight=function(){this.classBestiary===t.GameConstants.ELEMENT_CLASSIC?this.classBestiary=t.GameConstants.ELEMENT_SPECTRE:this.classBestiary===t.GameConstants.ELEMENT_SPECTRE?this.classBestiary=t.GameConstants.ELEMENT_TECH:this.classBestiary=t.GameConstants.ELEMENT_CLASSIC,this.changeBestiaryType()},e.prototype.onArrowDown=function(a){t.AudioManager.playSound("click_btn"),"left"===a.name?a.scale.set(-1.1,1.1):a.scale.set(1.1)},e.prototype.onArrowUp=function(a){"left"===a.name?a.scale.set(-1,1):a.scale.set(1),this.classBestiary===t.GameConstants.ELEMENT_CLASSIC?"left"===a.name?this.classBestiary=t.GameConstants.ELEMENT_TECH:this.classBestiary=t.GameConstants.ELEMENT_SPECTRE:this.classBestiary===t.GameConstants.ELEMENT_SPECTRE?"left"===a.name?this.classBestiary=t.GameConstants.ELEMENT_CLASSIC:this.classBestiary=t.GameConstants.ELEMENT_TECH:"left"===a.name?this.classBestiary=t.GameConstants.ELEMENT_SPECTRE:this.classBestiary=t.GameConstants.ELEMENT_CLASSIC,this.changeBestiaryType()},e.prototype.changeBestiaryType=function(){var a;this.remove(this.topLayer),this.topLayer=this.create(0,0,this.game.cache.getBitmapData(this.classBestiary)),this.topLayer.inputEnabled=!0,this.topLayer.events.onInputDown.add(this.onClickDarkLayer,this),this.topLayer.scale.set(t.GameConstants.GAME_WIDTH/16,t.GameConstants.GAME_HEIGHT/128),this.add(this.topLayer),this.sendToBack(this.topLayer),this.capsule.frameName="monster-capsule-"+this.classBestiary+".png",this.classBestiary===t.GameConstants.ELEMENT_CLASSIC?(this.capsuleText.font="Pythia",this.capsuleText.fill="#5b473c",this.capsuleText.fontSize="22px",this.leftArrow.frameName="btn_arrow_tech.png",this.rightArrow.frameName="btn_arrow_spectre.png",this.classText.text=t.GameVars.bestiaryTexts.CLASSIC,this.capsuleText.text=t.GameVars.names.CLASSIC.replace("Á","A"),this.classText.fill="#ff9c50",a=1):this.classBestiary===t.GameConstants.ELEMENT_SPECTRE?(this.capsuleText.font="Goonies",this.capsuleText.fill="#2a3147",this.capsuleText.fontSize="22px",this.leftArrow.frameName="btn_arrow_classic.png",this.rightArrow.frameName="btn_arrow_tech.png",this.classText.text=t.GameVars.bestiaryTexts.SPECTRE,this.capsuleText.text=t.GameVars.names.SPECTRE,this.classText.fill="#b9a8ff",a=11):(this.capsuleText.font="Adineue",this.capsuleText.fill="#ffffff",this.capsuleText.fontSize="28px",this.leftArrow.frameName="btn_arrow_spectre.png",this.rightArrow.frameName="btn_arrow_classic.png",this.classText.text=t.GameVars.bestiaryTexts.TECH,this.capsuleText.text=t.GameVars.names.TECH,this.classText.fill="#00dfa9",a=6);for(var s=0;s<5;s++)this.mkms[s].destroy(),this.midContainer.remove(this.mkms[s]);this.mkms=new Array;for(s=0;s<5;s++){var n=new t.BestiaryIcon(this.game,s+a,e.POSITIONS[s][0],e.POSITIONS[s][1],this.classBestiary,this);this.midContainer.add(n),this.mkms.push(n)}},e.prototype.showMkm=function(a){this.bestiaryMkm=new t.BestiaryMkm(this.game,t.GameVars.monstersInfo[a],a,this),this.add(this.bestiaryMkm)},e.prototype.onClickBack=function(t){t.scale.set(1),this.visible=!1},e.prototype.onClickDarkLayer=function(){},e.prototype.onOut=function(t){t.scale.set(1)},e.prototype.onOver=function(t){t.scale.set(1.05)},e.prototype.onOutLeft=function(t){t.scale.set(-1)},e.prototype.onOverLeft=function(t){t.scale.set(-1.05)},e.POSITIONS=[[-150,-50],[0,-50],[150,-50],[-75,110],[75,110]],e}(Phaser.Group);t.Bestiary=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i,o,r){var m,h=a.call(this,e,null,"bestiary-icon")||this;h.bestiary=r,h.startX=0,h.x=n,h.y=i,h.num=s,h.id=("000"+s).substr(-3),t.GameVars.slotData.bestiary[h.num-1]?m=t.GameVars.monstersInfo[h.id]:h.id="000";var l=new Phaser.Image(h.game,0,0,"texture_atlas_2","current_mkm_"+o+".png");l.anchor.set(.5),l.scale.set(.5),h.add(l);var c=new Phaser.Image(h.game,0,0,"texture_atlas_4","mkm_"+h.id+"_front.png");c.inputEnabled=!0,c.events.onInputDown.add(h.onImageDown,h),c.events.onInputUp.add(h.onImageUp,h),c.anchor.set(.5),h.add(c),"000"!==h.id&&(c.scale.set(.5),c.events.onInputOut.add(h.onOut,h),c.events.onInputOver.add(h.onOver,h));var d=new Phaser.Text(h.game,0,85,"",{font:"18px Chewy",fontWeight:"400",fill:"#ff9c50",align:"center"});return d.anchor.set(.5),h.add(d),m&&(d.text=" "+m.name.toUpperCase()+" "),o===t.GameConstants.ELEMENT_CLASSIC?d.fill="#ff9c50":o===t.GameConstants.ELEMENT_SPECTRE?d.fill="#b9a8ff":d.fill="#00dfa9",h}return __extends(e,a),e.prototype.onImageDown=function(){"000"!==this.id&&this.scale.set(1.1),this.startX=this.game.input.x},e.prototype.onImageUp=function(){this.scale.set(1);var t=this.game.input.x;Math.abs(this.startX-t)<=50&&"000"!==this.id&&this.bestiary.showMkm(this.id)},e.prototype.onOut=function(t){t.scale.set(.5)},e.prototype.onOver=function(t){t.scale.set(.55)},e}(Phaser.Group);t.BestiaryIcon=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i){var o=a.call(this,e,null,"bestiary-mkm")||this;o.bestiary=i,o.id=n,o.topLayer=o.create(0,0,o.game.cache.getBitmapData(s.class)),o.topLayer.inputEnabled=!0,o.topLayer.events.onInputDown.add(o.onClickDarkLayer,o),o.topLayer.scale.set(t.GameConstants.GAME_WIDTH/16,t.GameConstants.GAME_HEIGHT/128),o.add(o.topLayer);var r=new Phaser.Group(o.game);r.scale.y=t.GameVars.scaleY,o.add(r);var m=new Phaser.Button(o.game,10,10,"texture_atlas_1",o.onClickBack,o);m.setFrames("btn_back.png","btn_back.png","btn_back.png"),m.anchor.set(.5),m.x+=m.width/2,m.y+=m.height/2,m.events.onInputDown.add(o.onButtonDown,o),m.events.onInputOut.add(o.onOut,o),m.events.onInputOver.add(o.onOver,o),m.forceOut=!0,r.add(m);var h=new Phaser.Image(o.game,t.GameConstants.GAME_WIDTH/2,50,"texture_atlas_1","monster-capsule-"+s.class+".png");h.anchor.set(.5),r.add(h);var l=new Phaser.Text(o.game,t.GameConstants.GAME_WIDTH/2-20,58," "+s.name.toUpperCase()+" ",{font:"20px Pythia",fill:"#5b473c",align:"center"});l.anchor.set(.5),r.add(l);var c=new Phaser.Group(o.game);c.scale.y=t.GameVars.scaleY,c.x=t.GameConstants.GAME_WIDTH/2,c.y=220,o.add(c);var d=new Phaser.Image(o.game,0,0,"texture_atlas_2","current_mkm_"+s.class+".png");d.anchor.set(.5),c.add(d);var p=new Phaser.Image(o.game,0,0,"texture_atlas_4","mkm_"+o.id+"_front.png");p.anchor.set(.5),c.add(p);var u=new Phaser.Group(o.game);u.scale.y=t.GameVars.scaleY,u.x=t.GameConstants.GAME_WIDTH/2,u.y=480,o.add(u);var g=new Phaser.Text(o.game,0,-85,"",{font:"24px Chewy",fontWeight:"400",fill:"#ff9c50",align:"center"});g.anchor.set(.5),u.add(g);var G=new Phaser.Text(o.game,0,-50,t.GameVars.bestiaryTexts[o.id],{font:"18px Chewy",fontWeight:"400",fill:"#ff9c50",align:"center"});return G.anchor.set(.5,0),G.wordWrap=!0,G.wordWrapWidth=450,u.add(G),s.class===t.GameConstants.ELEMENT_CLASSIC?(l.font="Pythia",l.fill="#5b473c",l.fontSize="18px",g.fill="#ff9c50",G.fill="#ff9c50",g.text=t.GameVars.names.CLASS+": "+t.GameVars.names.CLASSIC.replace("Á","A")):s.class===t.GameConstants.ELEMENT_SPECTRE?(l.font="Goonies",l.fill="#2a3147",l.fontSize="18px",g.fill="#b9a8ff",G.fill="#b9a8ff",g.text=t.GameVars.names.SPECTRE+": "+t.GameVars.names.SPECTRE):(l.font="Adineue",l.fill="#ffffff",l.fontSize="22px",g.fill="#00dfa9",G.fill="#00dfa9",g.text=t.GameVars.names.TECH+": "+t.GameVars.names.TECH),o}return __extends(e,a),e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),a.scale.set(1.1)},e.prototype.onClickBack=function(t){t.scale.set(1),t.clearFrames(),this.visible=!1,this.destroy(),this.bestiary.remove(this)},e.prototype.onClickDarkLayer=function(){},e.prototype.onOut=function(t){t.scale.set(1)},e.prototype.onOver=function(t){t.scale.set(1.05)},e}(Phaser.Group);t.BestiaryMkm=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"background-splash")||this,n=t.GameVars.slotData.mapName;s.scale.y=t.GameVars.scaleY,s.initialPosition={x:t.GameConstants.TILES_SIZE*t.GameVars.slotData.mapsData[n].heroPosition.x+t.GameConstants.TILES_SIZE_HALF,y:t.GameConstants.TILES_SIZE*t.GameVars.slotData.mapsData[n].heroPosition.y+t.GameConstants.TILES_SIZE_HALF},s.chargeMap(t.GameVars.slotData.mapsData[n].tilemapName,t.GameVars.slotData.mapsData[n].imageName);var i=new Phaser.Sprite(s.game,s.initialPosition.x,s.initialPosition.y,"texture_atlas_1","down_03.png");return i.anchor.set(.5,.75),s.add(i),s.createAnimations(),s.game.world.setBounds(0,0,t.GameVars.slotData.mapsData[n].dimensions.x*t.GameConstants.TILES_SIZE,t.GameVars.slotData.mapsData[n].dimensions.y*t.GameConstants.TILES_SIZE*t.GameVars.scaleY),s.game.camera.follow(i,Phaser.Camera.FOLLOW_LOCKON),s}return __extends(e,a),e.prototype.chargeMap=function(a,e){this.stamp=new Phaser.Sprite(this.game,0,0,"tiles"),this.stamp.anchor.set(.5),this.add(this.stamp),this.map=this.game.add.tilemap(a),this.map.addTilesetImage(e,e),this.objects=this.map.objects,this.objects=this.objects.objects,t.MapManager.initObjects(this.objects),this.background=this.map.createLayer("background"),this.background.renderable=!1;var s=this.game.cache.getRenderTexture(this.background.layer.name+t.GameVars.slotData.mapName);if(s)this.backgroundImage=new Phaser.Sprite(this.game,0,0,s.texture),this.add(this.backgroundImage);else{var n=new Phaser.RenderTexture(this.game,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.x*t.GameConstants.TILES_SIZE,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.y*t.GameConstants.TILES_SIZE);this.backgroundImage=new Phaser.Sprite(this.game,0,0,n),this.add(this.backgroundImage),this.renderTexture(this.background,n)}this.animationsBot=this.map.createLayer("animationsBot"),this.animationsBot.renderable=!1,this.animationsBotGroup=new Phaser.Group(this.game),this.add(this.animationsBotGroup);for(var i=0,o=0;o<this.map.layers.length;o++)this.map.layers[o].name.search("collisions")||i++;this.collisions=new Array,this.collisionsImages=new Array;for(o=1;o<=i;o++){var r="collisions"+o,m=this.map.createLayer(r);m.renderable=!1,this.collisions.push(m);var h=void 0;if(s=this.game.cache.getRenderTexture(m.layer.name+t.GameVars.slotData.mapName))h=new Phaser.Sprite(this.game,0,0,s.texture),this.add(h),this.collisionsImages.push(h);else{var l=new Phaser.RenderTexture(this.game,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.x*t.GameConstants.TILES_SIZE,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.y*t.GameConstants.TILES_SIZE);h=new Phaser.Sprite(this.game,0,0,l),this.add(h),this.collisionsImages.push(h),this.renderTexture(m,l)}}if(this.bridges=this.map.createLayer("bridges"),this.bridges.renderable=!1,s=this.game.cache.getRenderTexture(this.bridges.layer.name+t.GameVars.slotData.mapName))this.bridgesImage=new Phaser.Sprite(this.game,0,0,s.texture),this.add(this.bridgesImage);else{var c=new Phaser.RenderTexture(this.game,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.x*t.GameConstants.TILES_SIZE,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].dimensions.y*t.GameConstants.TILES_SIZE);this.bridgesImage=new Phaser.Sprite(this.game,0,0,c),this.add(this.bridgesImage),this.renderTexture(this.bridges,c)}this.trainers=new Array;for(o=0;o<t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].trainers.length;o++){var d=new t.Trainer(this.game,t.GameVars.slotData.mapsData[t.GameVars.slotData.mapName].trainers[o],!0);this.add(d),this.trainers.push(d)}this.animationsTop=this.map.createLayer("animationsTop"),this.animationsTop.renderable=!1,this.animationsTopGroup=new Phaser.Group(this.game),this.add(this.animationsTopGroup)},e.prototype.renderTexture=function(a,e){for(var s=0;s<a.layer.data.length;s++)for(var n=0;n<a.layer.data[0].length;n++)this.stamp.scale.set(1),this.stamp.rotation=0,a.layer.data[s][n].flipped&&(2===a.layer.data[s][n].flippedVal?this.stamp.scale.y=-1:4===a.layer.data[s][n].flippedVal&&(this.stamp.scale.x=-1)),a.layer.data[s][n].rotation&&(this.stamp.rotation=a.layer.data[s][n].rotation),-1!==a.layer.data[s][n].index&&(this.stamp.frame=a.layer.data[s][n].index-1,e.renderXY(this.stamp,n*t.GameConstants.TILES_SIZE+t.GameConstants.TILES_SIZE/2,s*t.GameConstants.TILES_SIZE+t.GameConstants.TILES_SIZE/2));this.game.cache.addRenderTexture(a.layer.name+t.GameVars.slotData.mapName,e)},e.prototype.createAnimations=function(){for(var a=0;a<this.animationsTop.layer.data.length;a++)for(var e=0;e<this.animationsTop.layer.data[0].length;e++)for(var s=0;s<t.GameVars.animations.length;s++){var n=t.GameVars.animations[s];if(this.animationsTop.layer.data[a][e].index===n.tile){var i=new Phaser.Sprite(this.game,e*t.GameConstants.TILES_SIZE,a*t.GameConstants.TILES_SIZE,"texture_atlas_1",n.name+"_01.png");this.animationsTopGroup.add(i)}if(this.animationsBot.layer.data[a][e].index===n.tile){i=new Phaser.Sprite(this.game,e*t.GameConstants.TILES_SIZE,a*t.GameConstants.TILES_SIZE,"texture_atlas_1",n.name+"_01.png");this.animationsBotGroup.add(i)}}},e}(Phaser.Group);t.BackgroundSplash=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"credits-layer")||this;s.fixedToCamera=!0;var n=s.create(0,0,s.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_1));n.inputEnabled=!0,n.events.onInputDown.add(s.onClickDarkLayer,s),n.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),s.add(n);var i=s.create(0,320,s.game.cache.getBitmapData(t.GameConstants.GRADIENT_ITEMS_2));i.inputEnabled=!0,i.events.onInputDown.add(s.onClickDarkLayer,s),i.scale.set(t.GameConstants.GAME_WIDTH/16,2.5),s.add(i);var o=new Phaser.Group(s.game);o.scale.y=t.GameVars.scaleY,s.add(o),s.backButton=new Phaser.Button(s.game,10,10,"texture_atlas_1",s.onClickBack,s),s.backButton.events.onInputDown.add(s.onButtonDown,s),s.backButton.events.onInputOut.add(s.onOut,s),s.backButton.events.onInputOver.add(s.onOver,s),s.backButton.setFrames("btn_back.png","btn_back.png","btn_back.png"),s.backButton.anchor.set(.5),s.backButton.x+=s.backButton.width/2,s.backButton.y+=s.backButton.height/2,o.add(s.backButton);var r=new Phaser.Image(s.game,t.GameConstants.GAME_WIDTH-5,5,"texture_atlas_1","tab_area_big.png");r.anchor.set(1,0),o.add(r);var m=new Phaser.Text(s.game,t.GameConstants.GAME_WIDTH-100,40,t.GameVars.names.CREDITS,{font:"22px Chewy",fontWeight:"400",fill:"#ffb63b"});m.anchor.set(.5),o.add(m);var h=new Phaser.Group(s.game);h.scale.y=t.GameVars.scaleY,h.x=t.GameConstants.GAME_WIDTH/2,h.y=140,s.add(h);var l=new Phaser.Text(s.game,0,0,"ANIA BECERRA - "+t.GameVars.names.ART,{font:"22px Chewy",fontWeight:"400",fill:"#ffffff"});l.anchor.set(.5),h.add(l);var c=new Phaser.Text(s.game,0,50,"DAVID ESCRICHE - "+t.GameVars.names.PROGRAMATION,{font:"22px Chewy",fontWeight:"400",fill:"#ffffff"});c.anchor.set(.5),h.add(c);var d=new Phaser.Text(s.game,0,100,"ENRIQUE GARCÍA - "+t.GameVars.names.CONCEPT,{font:"22px Chewy",fontWeight:"400",fill:"#ffffff"});d.anchor.set(.5),h.add(d);var p=new Phaser.Text(s.game,0,150,"CHENT SANCHEZ - "+t.GameVars.names["ART 2"],{font:"22px Chewy",fontWeight:"400",fill:"#ffffff"});p.anchor.set(.5),h.add(p);var u=new Phaser.Text(s.game,0,200,"JAVIER SANZ - "+t.GameVars.names.UI,{font:"22px Chewy",fontWeight:"400",fill:"#ffffff"});u.anchor.set(.5),h.add(u);var g=new Phaser.Group(s.game);g.scale.y=t.GameVars.scaleY,g.x=t.GameConstants.GAME_WIDTH/2,g.y=400,s.add(g);var G=new Phaser.Image(s.game,0,0,"texture_atlas_1","ravalmatic_logo.png");G.anchor.set(.5),g.add(G);var f=new Phaser.Text(s.game,0,40,t.GameVars.names.RAVALMATIC,{font:"22px Chewy",fontWeight:"400",fill:"#43bcf1"});f.anchor.set(.5),g.add(f);var C=new Phaser.Text(s.game,0,70,t.GameVars.names.HTML,{font:"22px Chewy",fontWeight:"400",fill:"#43bcf1"});C.anchor.set(.5),g.add(C);var _=new Phaser.Text(s.game,0,100,t.GameVars.names.DEVELOPMENT,{font:"22px Chewy",fontWeight:"400",fill:"#43bcf1"});_.anchor.set(.5),g.add(_);var E=new Phaser.Image(s.game,t.GameConstants.GAME_WIDTH/2,t.GameConstants.GAME_HEIGHT-20,"texture_atlas_1","logo_generalitat.png");return E.anchor.set(.5,1),E.scale.y=t.GameVars.scaleY,s.add(E),s}return __extends(e,a),e.prototype.show=function(){this.visible=!0},e.prototype.onClickDarkLayer=function(){},e.prototype.onButtonDown=function(a){t.AudioManager.playSound("click_btn"),a.scale.set(1.1)},e.prototype.onClickBack=function(t){t.scale.set(1),this.destroy()},e.prototype.onOut=function(t){t.scale.set(1)},e.prototype.onOver=function(t){t.scale.set(1.05)},e}(Phaser.Group);t.CreditsLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e){var s=a.call(this,e,null,"languages-layer")||this;s.fixedToCamera=!0,s.scale.y=t.GameVars.scaleY;var n="btn_language_"+t.GameVars.gameData.language+".png";s.languageButton=new Phaser.Button(s.game,t.GameConstants.GAME_WIDTH-5,60,"texture_atlas_1",s.onLanguageButtonClicked,s),s.languageButton.name=t.GameVars.gameData.language,s.languageButton.setFrames(n,n,n),s.languageButton.events.onInputOut.add(s.onOut,s),s.languageButton.events.onInputOver.add(s.onOver,s),s.languageButton.anchor.set(1,0),s.add(s.languageButton),s.arrow=new Phaser.Image(s.game,t.GameConstants.GAME_WIDTH-5,110,"texture_atlas_1","arrow_language_btn.png"),s.arrow.anchor.set(1,0),s.add(s.arrow),s.otherButton1=new Phaser.Button(s.game,t.GameConstants.GAME_WIDTH-5,120,"texture_atlas_1",s.onOtherButtonClicked,s),s.otherButton1.visible=!1,s.otherButton1.anchor.set(1,0),s.otherButton1.events.onInputOut.add(s.onOut,s),s.otherButton1.events.onInputOver.add(s.onOver,s),s.add(s.otherButton1),s.otherButton2=new Phaser.Button(s.game,t.GameConstants.GAME_WIDTH-5,180,"texture_atlas_1",s.onOtherButtonClicked,s),s.otherButton2.visible=!1,s.otherButton2.anchor.set(1,0),s.otherButton2.events.onInputOut.add(s.onOut,s),s.otherButton2.events.onInputOver.add(s.onOver,s),s.add(s.otherButton2);var i="",o="";return t.GameVars.gameData.language===t.GameConstants.ENGLISH?(i="btn_language_"+t.GameConstants.SPANISH+".png",o="btn_language_"+t.GameConstants.CATALAN+".png",s.otherButton1.name=t.GameConstants.SPANISH,s.otherButton2.name=t.GameConstants.CATALAN):t.GameVars.gameData.language===t.GameConstants.SPANISH?(i="btn_language_"+t.GameConstants.ENGLISH+".png",o="btn_language_"+t.GameConstants.CATALAN+".png",s.otherButton1.name=t.GameConstants.ENGLISH,s.otherButton2.name=t.GameConstants.CATALAN):t.GameVars.gameData.language===t.GameConstants.CATALAN&&(i="btn_language_"+t.GameConstants.SPANISH+".png",o="btn_language_"+t.GameConstants.ENGLISH+".png",s.otherButton1.name=t.GameConstants.SPANISH,s.otherButton2.name=t.GameConstants.ENGLISH),s.otherButton1.setFrames(i,i,i),s.otherButton2.setFrames(o,o,o),s}return __extends(e,a),e.prototype.onLanguageButtonClicked=function(){t.AudioManager.playSound("click_btn"),this.otherButton1.visible?(this.otherButton1.visible=!1,this.otherButton2.visible=!1,this.arrow.visible=!0):(this.otherButton1.visible=!0,this.otherButton2.visible=!0,this.arrow.visible=!1)},e.prototype.onOtherButtonClicked=function(a){t.AudioManager.playSound("click_btn"),t.GameManager.setLanguage(a.name),t.SplashState.currentInstance.resetSlots(),this.languageButton.name=a.name,this.languageButton.setFrames("btn_language_"+a.name+".png","btn_language_"+a.name+".png","btn_language_"+a.name+".png");var e="",s="";a.name===t.GameConstants.ENGLISH?(e="btn_language_"+t.GameConstants.SPANISH+".png",s="btn_language_"+t.GameConstants.CATALAN+".png",this.otherButton1.name=t.GameConstants.SPANISH,this.otherButton2.name=t.GameConstants.CATALAN):a.name===t.GameConstants.SPANISH?(e="btn_language_"+t.GameConstants.ENGLISH+".png",s="btn_language_"+t.GameConstants.CATALAN+".png",this.otherButton1.name=t.GameConstants.ENGLISH,this.otherButton2.name=t.GameConstants.CATALAN):a.name===t.GameConstants.CATALAN&&(e="btn_language_"+t.GameConstants.SPANISH+".png",s="btn_language_"+t.GameConstants.ENGLISH+".png",this.otherButton1.name=t.GameConstants.SPANISH,this.otherButton2.name=t.GameConstants.ENGLISH),this.otherButton1.setFrames(e,e,e),this.otherButton2.setFrames(s,s,s),this.otherButton1.visible=!1,this.otherButton2.visible=!1,this.arrow.visible=!0},e.prototype.onOut=function(t){t.scale.set(1)},e.prototype.onOver=function(t){t.scale.set(1.05)},e}(Phaser.Group);t.LanguagesLayer=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(e,s,n,i){var o=a.call(this,e,null,"slot")||this;return o.id=i,o.leavingScene=!1,o.erasing=!1,o.fixedToCamera=!0,o.scale.y=t.GameVars.scaleY,o.slotContainer=new Phaser.Group(o.game),o.slotContainer.x=s,o.slotContainer.y=n,o.add(o.slotContainer),o.image=new Phaser.Image(o.game,0,0,"texture_atlas_1","btn_slot_save.png"),o.image.inputEnabled=!0,o.image.input.pixelPerfectClick=!0,o.image.input.pixelPerfectOver=!0,o.image.input.useHandCursor=!0,o.image.events.onInputDown.add(o.onClickImage,o),o.image.events.onInputOut.add(o.onOut,o),o.image.events.onInputOver.add(o.onOver,o),o.image.anchor.set(.5),o.slotContainer.add(o.image),t.GameVars.gameData.currentSlot===i&&t.GameVars.gameData.slotsData[i].state!==t.GameConstants.INITIAL_BUS&&(o.image.frameName="btn_slot_save_on.png"),o.erase=new Phaser.Image(o.game,0,0,"texture_atlas_1","btn_slot_erase.png"),o.erase.anchor.set(.5),o.erase.inputEnabled=!0,o.erase.input.pixelPerfectClick=!0,o.erase.input.pixelPerfectOver=!0,o.erase.input.useHandCursor=!0,o.erase.events.onInputDown.add(o.onClickErase,o),o.erase.events.onInputOut.add(o.onOutErase,o),o.erase.events.onInputOver.add(o.onOverErase,o),o.slotContainer.add(o.erase),o.text=new Phaser.Text(o.game,0,5,t.GameVars.names["NEW GAME"],{font:"15px Chewy",fill:"#022c3b",align:"center"}),o.text.lineSpacing=-5,o.text.anchor.set(.5),o.slotContainer.add(o.text),t.GameVars.gameData.slotsData[i].state===t.GameConstants.INITIAL_BUS?o.erase.visible=!1:(o.text.fill="#ffffff",o.text.fontSize="13px",o.text.text=t.GameVars.names.CONTINUE+"\n"+t.GameVars.chaptersTexts[t.GameVars.gameData.slotsData[i].mapName+" title"]),o}return __extends(e,a),e.prototype.onClickImage=function(){var a=this;this.leavingScene||(t.AudioManager.playSound("click_btn"),this.leavingScene=!0,t.GameConstants.SPONSOR===t.GameConstants.POKI?PokiSDK.commercialBreak().then((function(){t.GameManager.slotSelected(a.id)})):t.GameManager.slotSelected(this.id))},e.prototype.onClickErase=function(){this.erasing||(t.AudioManager.playSound("click_btn"),this.erasing=!0,t.GameManager.eraseSlot(this.id))},e.prototype.onOut=function(){this.slotContainer.scale.set(1)},e.prototype.onOver=function(){this.slotContainer.scale.set(1.05),t.SplashState.currentInstance.world.bringToTop(this)},e.prototype.onOutErase=function(){this.erase.scale.set(1)},e.prototype.onOverErase=function(){this.erase.scale.set(1.05),t.SplashState.currentInstance.world.bringToTop(this)},e}(Phaser.Group);t.Slot=a}(MagikMons||(MagikMons={})),function(t){var a=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return __extends(e,a),e.prototype.init=function(){e.currentInstance=this,t.GameManager.resetMapVars()},e.prototype.create=function(){this.count=0;var a=new t.BackgroundSplash(this.game);this.add.existing(a),this.backgroundSprite=new Phaser.Sprite(this.game,0,0,this.game.cache.getBitmapData(t.GameConstants.DARK_BLUE_SQUARE)),this.backgroundSprite.fixedToCamera=!0,this.backgroundSprite.scale.set(t.GameConstants.GAME_WIDTH/t.GameConstants.BITMAPDATA_SIZE,t.GameConstants.GAME_HEIGHT/t.GameConstants.BITMAPDATA_SIZE),this.backgroundSprite.alpha=.6,this.add.existing(this.backgroundSprite),this.creditsButton=new Phaser.Button(this.game,5,5,"texture_atlas_1",this.onCreditsButtonClicked,this),this.creditsButton.setFrames("btn_credits.png","btn_credits.png","btn_credits.png"),this.creditsButton.forceOut=!0,this.creditsButton.fixedToCamera=!0,this.creditsButton.scale.y=t.GameVars.scaleY,this.creditsButton.events.onInputOut.add(this.onOut,this),this.creditsButton.events.onInputOver.add(this.onOver,this),this.add.existing(this.creditsButton);var e=new Phaser.Group(this.game);e.fixedToCamera=!0,e.scale.y=t.GameVars.scaleY,this.add.existing(e),this.gameImage=new Phaser.Image(this.game,t.GameConstants.GAME_WIDTH/2,(t.GameConstants.GAME_HEIGHT/2-20)/t.GameVars.scaleY,"texture_atlas_2","splash_image.png"),this.gameImage.anchor.set(.5),e.add(this.gameImage),this.titleContainer=new Phaser.Group(this.game),this.titleContainer.x=t.GameConstants.GAME_WIDTH/2,this.titleContainer.y=this.gameImage.y-this.gameImage.height/2+40,this.titleContainer.scale.set(0),e.add(this.titleContainer),this.gameTitle2=new Phaser.Image(this.game,0,0,"texture_atlas_1","title_on.png"),this.gameTitle2.anchor.set(.5),this.gameTitle2.tint=11266813,this.titleContainer.add(this.gameTitle2);var s=new Phaser.Group(this.game);s.x=105,s.y=-10,s.scale.x=.75,this.titleContainer.add(s),this.titleLogo=new Phaser.Image(this.game,0,0,"texture_atlas_1","title_logo.png"),this.titleLogo.anchor.set(.5),s.add(this.titleLogo),this.gameTitle1=new Phaser.Image(this.game,0,0,"texture_atlas_1","title_magikm.png"),this.gameTitle1.anchor.set(.5),this.gameTitle1.tint=11266813,this.titleContainer.add(this.gameTitle1),this.languagesLayer=new t.LanguagesLayer(this.game),this.add.existing(this.languagesLayer),this.audioButton=new Phaser.Button(this.game,t.GameConstants.GAME_WIDTH-5,5,"texture_atlas_1",this.onAudioButtonClicked,this),this.audioButton.anchor.set(1,0),this.audioButton.forceOut=!0,this.audioButton.fixedToCamera=!0,this.audioButton.scale.y=t.GameVars.scaleY,this.audioButton.events.onInputOut.add(this.onOut,this),this.audioButton.events.onInputOver.add(this.onOver,this),this.add.existing(this.audioButton),t.GameVars.gameData.muted?this.audioButton.setFrames("btn_sound_off.png","btn_sound_off.png","btn_sound_off.png"):this.audioButton.setFrames("btn_sound_on.png","btn_sound_on.png","btn_sound_on.png"),this.slot1=new t.Slot(this.game,t.GameConstants.GAME_WIDTH/2-155,(t.GameConstants.GAME_HEIGHT-50)/t.GameVars.scaleY,0),this.add.existing(this.slot1),this.slot2=new t.Slot(this.game,t.GameConstants.GAME_WIDTH/2,(t.GameConstants.GAME_HEIGHT-50)/t.GameVars.scaleY,1),this.add.existing(this.slot2),this.slot3=new t.Slot(this.game,t.GameConstants.GAME_WIDTH/2+155,(t.GameConstants.GAME_HEIGHT-50)/t.GameVars.scaleY,2),this.add.existing(this.slot3),t.AudioManager.playSound("music_map",!0,1,!0),this.titleAnimation()},e.prototype.shutdown=function(){e.currentInstance=null,a.prototype.shutdown.call(this)},e.prototype.resetSlots=function(){this.stage.removeChild(this.slot1),this.stage.removeChild(this.slot2),this.stage.removeChild(this.slot3),this.slot1.destroy(),this.slot2.destroy(),this.slot3.destroy(),this.slot1=new t.Slot(this.game,t.GameConstants.GAME_WIDTH/2-155,(t.GameConstants.GAME_HEIGHT-50)/t.GameVars.scaleY,0),this.add.existing(this.slot1),this.slot2=new t.Slot(this.game,t.GameConstants.GAME_WIDTH/2,(t.GameConstants.GAME_HEIGHT-50)/t.GameVars.scaleY,1),this.add.existing(this.slot2),this.slot3=new t.Slot(this.game,t.GameConstants.GAME_WIDTH/2+155,(t.GameConstants.GAME_HEIGHT-50)/t.GameVars.scaleY,2),this.add.existing(this.slot3)},e.prototype.titleAnimation=function(){this.game.add.tween(this.titleContainer.scale).to({x:1,y:1},1e3,Phaser.Easing.Back.Out,!0,2e3).onStart.add((function(){}),this),this.game.time.events.add(2e3,(function(){this.game.time.events.loop(1300,(function(){this.game.add.tween(this.titleContainer.scale).to({x:.97,y:.97},200,Phaser.Easing.Cubic.Out,!0).onComplete.add((function(){0===this.count?(this.count++,this.gameTitle1.tint=11887358,this.gameTitle2.tint=11887358):1===this.count?(this.count++,this.gameTitle1.tint=16681729,this.gameTitle2.tint=16681729):2===this.count&&(this.count=0,this.gameTitle1.tint=127192,this.gameTitle2.tint=127192),this.game.add.tween(this.titleContainer.scale).to({x:1,y:1},400,Phaser.Easing.Back.Out,!0)}),this),this.game.add.tween(this.titleLogo).to({angle:this.titleLogo.angle+120},600,Phaser.Easing.Back.Out,!0).onComplete.add((function(){}),this)}),this)}),this)},e.prototype.hide=function(a){t.GameConstants.SPONSOR===t.GameConstants.POKI&&PokiSDK.gameplayStart(),this.game.add.tween(this.backgroundSprite).to({alpha:0},1e3,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.audioButton).to({alpha:0},1e3,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.creditsButton).to({alpha:0},1e3,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.titleContainer).to({alpha:0},1e3,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.gameImage).to({alpha:0},1e3,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.slot1).to({alpha:0},1e3,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.slot2).to({alpha:0},1e3,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.slot3).to({alpha:0},1e3,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this.languagesLayer).to({alpha:0},1e3,Phaser.Easing.Cubic.In,!0).onComplete.add((function(){this.game.state.start("MapState",!0,!1)}),this)},e.prototype.onAudioButtonClicked=function(){t.GameVars.gameData.muted?(t.AudioManager.unmute(),this.audioButton.setFrames("btn_sound_on.png","btn_sound_on.png","btn_sound_on.png")):(t.AudioManager.mute(),this.audioButton.setFrames("btn_sound_off.png","btn_sound_off.png","btn_sound_off.png")),t.AudioManager.playSound("click_btn"),t.GameManager.writeGameData()},e.prototype.onCreditsButtonClicked=function(){this.creditsLayer=new t.CreditsLayer(this.game),this.add.existing(this.creditsLayer),this.world.bringToTop(this.creditsLayer)},e.prototype.onOut=function(a){a.scale.set(1,t.GameVars.scaleY)},e.prototype.onOver=function(a){a.scale.set(1.05,1.05*t.GameVars.scaleY)},e}(Phaser.State);t.SplashState=a}(MagikMons||(MagikMons={}));